// JavaScript Document PC端发布页
var _postApi = {
  _movie: "/post/api:70",
  _picUpload: "/post/api:img",
  _vote: "/post/api:33",
  _votePreview: "/post/api:89",
  _party: "/post/api:25",
  _partyPreview: "/post/api:88",
  _article: "/post/api:30",
  _articlePreview: "/post/api:87",
  _recruit: "/post/api:39",
  _job: "/post/api:27",
  _checkBind: "/post/api:58",
  _maxMoney: "/post/api:63",
  _noAudit: "/attest/fail",
  _auditing: "/attest/auditing",
  _attest: "/attest",
  _attestYes: "/post/api:65"
};

/**值缓存*/
var _postTemp = {
  _set: function(key, value) {
    _post._id == "" ? _t._set(key, value) : _t._set(key + "_m", value);
  },
  _get: function(key) {
    return _post._id == "" ? _t._get(key) : _t._get(key + "_m");
  }
};

/**是否登录判断*/
var _postBeforeLogin = {
  _mark: function(kind, id) {
    _t._set("post_before_login_" + kind, id);
  },
  _continue: function(kind, fun) {
    var _id = _t._get("post_before_login_" + kind);
    if (_id != "") {
      (fun)(_id == "0" ? "" : _id);
    }
  }
};

/**文本框*/
var _textArea = {
  _update: function(o) {
    $(o).val($(o).val()
      .replace(/[\x20]+\n/g, "\n")
      .replace(/[\x20]+($)/g, "$1")
      .replace(/(\n(\r*))*([\x20]{20,})/g, "\n"));
  },
  _onPaste: function(o) {
    setTimeout(function() {
      _textArea._update(o);
    }, 200);
  },
  _onBlur: function(o, temp) {
    _textArea._update(o);
    _postTemp._set(temp, $(o).val());
  }
};

/*富文本*/
var _richText = {
  _id: "",
  _file_id: "",
  _black: function() {
    if ('undefined' != typeof(editor)) {
      var editorText = editor.text();
      var placeholder = $("#" + _richText._id).attr("placeholder");
      if (editorText != placeholder) {
        _richText._gray('');
      }
    }
  },
  _gray: function(gray) {
	  var _iframeBody = $("#hdb_frame").contents().find("body");
    _iframeBody.attr("class", "ke-content " + gray);
  },
  _init: function(id, tmpId, contentval) {
    _richText._id = id + tmpId;
    _richText._file_id = id;
    $("#" + _richText._id + "_richtext_bar").show();
    if(_post._type=="party"){
    	_richText._id = id + tmpId + _post._sceneId;
    }
    _richText._setValue(true, contentval);
    _upload._ok = _richText._uploadOk;

  },
  _maxPic: function() {
    var _img = $("#f").html().match(/<img[^>]*class\=["']?post_pic["']?[^>]*>|<embed[^>]*\/?>/gi);
    if (_img != null) {
      return _img.length > 30;
    }
    return false;
  },
  _isEmpty: function() {
    return editor.text().replace(/(<br>)/ig, "").replace(/(&nbsp;)/ig, "").replace(/ /ig, "") == "" && !_HdbToolbar._img;
  },
  _getValue: function() {
    if ($("#" + _richText._id + "_2").attr("id") != undefined) {
      return _._htmlencode($("#" + _richText._id + "_2").val());
    } else {
      var value = appTxt("");
      if (value == "") {
        _richText._onBlur();
      }
      return value;
    }
  },
  _showEmo: function() {
    _emo._show(_richText._id + "_emo", _richText._inserEmo);
  },
  _inserEmo: function(num) {
    _richText._setNull();
    editor.insertHtml("<img class=\"dt_emo\" src=\"" + _imgCdn + "/images/emo/" + (num + 1) + ".png\"  />");
  },
  _setValue: function(flag, val) {
    var _html = "";
    if (flag) {
      if (navigator.userAgent.indexOf("MSIE") > 0) { //是否是IE浏览器  ：navigator.userAgent是描述用户代理信息。ie11已经不支持了，ie11不在包含MSIE字段
        _html = val;
      } else {
        _html = _t._get("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id) != "" ? _t._get("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id) : _richText._default();
      }

    } else {
      _html = val;
    }
    if ('undefined' != typeof(editor)) {
      editor.html(_html);
    } else {
      $("#" + _richText._id).html(_html);
    }
    if (_html != $("#" + _richText._id).attr("placeholder")) {
      _richText._black();
    }
  },
  _onBlur: function() {
    if (editor.html() != "" && editor.html() != $("#" + _richText._id).attr("placeholder")) {
      if (editor.text() == "" && editor.html().indexOf("<embed") == -1) {
        editor.html($("#" + _richText._id).attr("placeholder"));
        _t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
      }else{
    	_t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id,editor.html());
      }
    } else {
      editor.html(_richText._default());
    }

    $("#" + _richText._id).html(editor.html());

  },
  _onFocus: function() {
    _richText._setNull();
  },
  _setNull: function() {
    var editorText = editor.text();
    var placeholder = $("#" + _richText._id).attr("placeholder");

    if (editorText != "" && editorText == placeholder) {
      if (editor.html().indexOf("<embed") == -1) {
        editor.html("");
      }

    }
    _richText._black();
  },
  _default: function() {
    var _d = "";
    if ('undefined' != typeof(editor)) {
      _d = editor.html();
    } else {
      _d = $("#" + _richText._id).html();
    }
    if (_d == "") {
      _d = $("#" + _richText._id).attr("placeholder");
      _t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
    } else {
      if (_d == $("#" + _richText._id).attr("placeholder")) {
        _d = "";
      }
    }
    return _d;
  },
  _insertMaxPic: function() {
    var _img = editor.html().match(/<img[^>]*class\=["']?post_pic["']?[^>]*>|<embed[^>]*\/?>/gi);
    if (_img != null) {
      return _img.length > 30;
    }
    return false;
  },
  _upload: function() {
    var _img = editor.html().split('class="post_pic"').length - 1;
    var _video = editor.html().split('class="embed_mov"').length - 1;
    if ((_img + _video) > 29) {
      _toast._show("视频和图片的总数不能超过30");
    } else {
      if (_upload._limit($("#" + _richText._file_id + "_upload_file").val())) {
        _toast._show("只能选择图片文件");
        _upload._clearFile($(_richText._file_id + "_upload"));
        return;
      }
      if (_richText._insertMaxPic()) {
        _toast._show("图片太多了，最多只能上传30张图片");
        _upload._clearFile($("#" + _richText._file_id + "_upload"));
        return;
      }
      _loading._show("上传中");
      _upload._ok = _richText._uploadOk;
      $("#" + _richText._file_id + "_upload").submit();
    }
  },
  _uploadOk: function(state, error, saveUrl) {
    _loading._hide();
    _upload._clearFile($("#" + _richText._file_id + "_upload"));
    if (state != "0") {
      _toast._show(error);
      return;
    }
    _richText._setNull();
    editor.cmd.insertimage(saveUrl, "", "", "", "", "");
  },
  _mov: function() {
    var _movUrl = _._trim($("#media_input").val());
    if (_movUrl == "") {
      _toast._show("请输入视频地址");
      return;
    }
    if (!/^http:\/\/[a-zA-Z]+(.qq.com|.youku.com)(\/[a-zA-Z0-9\?%=&#;_\.\-\+\/]+)?$/.test(_movUrl)) {
      _toast._show("暂不支持你输入的视频");
      return;
    }
    _loading._show("插入中");
    _$(_postApi._movie, "videoUrl=" + _movUrl, _richText._movOk);
  },
  _movOk: function(json, code) {
    _loading._hide();
    if (code != 200) {
      return;
    }
    $("#media_input").val("");
    var _imgUrl = json.thumbnail;
    var _videoUrl = json.video;
    var _swfUrl = json.swf;
    _richText._setNull();
    var _html = '<p><embed id="' + _videoUrl + '" class="embed_mov" imgsrc="' + _imgUrl + '" wmode="transparent"   src="' + _swfUrl + '" width="450" height="372"/></p><br>';
    editor.insertHtml(_html);
    _videoTc._hide();
  },
  _ifNull:function(){
    if(editor.html()==""&&_post._type=="article"){
      $("#hdb_frame").contents().find("body").attr("class", "ke-content null_Article");
    }else if(editor.html()==""&&_post._type=="party"){
      $("#hdb_frame").contents().find("body").attr("class", "ke-content null_Party");
    }else if(editor.html()==""&&_post._type=="vote"){
      $("#hdb_frame").contents().find("body").attr("class", "ke-content null_Vote");
    }else{
      $("#hdb_frame").contents().find("body").attr("class", "ke-content");
    }
  }
};
/*视频框*/
var _videoTc = {
  _center: function() {
    var _top = _._zero(_._client().bh - $("#tc_video").outerHeight()) / 2 + "px";
    var _left = _._zero(_._client().bw - $("#tc_video").outerWidth()) / 2 + "px";
    $("#tc_video").css({
      "left": _left,
      "top": _top,
      "z-index": "3000",
      "position": "fixed"
    });
  },
  _show: function() {
    var _img = editor.html().split('class="post_pic"').length - 1;
    var _video = editor.html().split('class="embed_mov"').length - 1;
    if ((_img + _video) > 29) {
      _toast._show("视频和图片的总数不能超过30");
    } else {
      _cover._show("cover2");
      _videoTc._center();
      $("#tc_video").show();
      $(window).bind("resize", _videoTc._center);
      $("#cover2").bind("click", _videoTc._hide);
    }
  },
  _hide: function() {
    $("#tc_video").hide();
    _cover._hide("cover2");
  }
};

/**上传*/
var _upload = {
  _limit: function(path) {
    return path.match(/\.(gif|jpg|jpeg|png)$/i) == null;
  },
  _clearFile: function(o) {
    var _id = $(o).attr("id");
    var _type = $("#" + _id + "_type").val();
    $(o).html("");
    $(o).html("<input name=\"file\" id=\"" + _id + "_file\" type=\"file\" onchange=\"_richText._upload()\" title=\"上传图片\"><input name=\"infoType\" id=\"" + _id + "_type\" value=\"" + _type + "\" type=\"hidden\">");
  },
  _ok: null
};

/**日期*/
var _datePicker = {
  _id: "",
  _interval: null,
  _timeout: null,
  _showDay: ["日", "一", "二", "三", "四", "五", "六"],
  _showDate: function(t) {
    var _d = new Date(t);
    return (_d.getMonth() + 1) + "月" + _d.getDate() + " 周" + _datePicker._showDay[_d.getDay()];
  },
  _showHour: function(t) {
    return t + "时";
  },
  _showMinute: function(t) {
    return t + "分";
  },
  _getCurrent: function(id) {
    return $("#" + id + " div")[2];
  },
  _current: function(id, cur) {
    var _div = _datePicker._getCurrent(id);
    $(_div).css({
      "color": (cur ? "#0099e9" : "#999999")
    });
  },
  _minStart: function(o, fun) {
    _datePicker._timeout = setTimeout(function() {
      _datePicker._interval = setInterval(fun, 100);
    }, 500);
    _datePicker._stopEvent(o);
  },
  _addStart: function(o, fun) {
    _datePicker._timeout = setTimeout(function() {
      _datePicker._interval = setInterval(fun, 100);
    }, 500);
    _datePicker._stopEvent(o);
  },
  _stopEvent: function(o) {
    o.onmouseup = _datePicker._stop;
    o.onmouseout = _datePicker._stop;
  },
  _stop: function() {
    clearTimeout(_datePicker._timeout);
    clearInterval(_datePicker._interval);
  },
  _min: function(id, fun1, fun2) {
    _datePicker._current(id, false);
    $("#" + id).children().first().css({
      "margin-top": "0px"
    });
    $("#" + id).children().last().insertBefore($("#" + id).children().first());
    var _t = parseInt($("#" + id).children().first().next().attr("time"));
    _t = (fun1)(_t);
    $("#" + id).children().first().html((fun2)(_t));
    $("#" + id).children().first().attr("time", _t);
    $("#" + id).children().first().css({
      "margin-top": "-50px"
    });
    _datePicker._current(id, true);
  },
  _add: function(id, fun1, fun2) {
    _datePicker._current(id, false);

    $("#" + id).children().first().css({
      "magin-top": "-100px"
    });
    $("#" + id).children().first().insertAfter($("#" + id).children().last());
    var _t = parseInt($("#" + id).children().last().prev().attr("time"));
    _t = (fun1)(_t);
    $("#" + id).children().last().html((fun2)(_t));
    $("#" + id).children().last().attr("time", _t);
    $("#" + id).children().last().css({
      "margin-top": "0px"
    });
    $("#" + id).children().first().css({
      "margin-top": "-50px"
    });

    _datePicker._current(id, true);
  },
  _dateMin: function() {
    _datePicker._min("datepicker_date", function(t) {
      return new Date(t - 86400000 * 1).getTime();
    }, _datePicker._showDate);
  },
  _dateAdd: function() {
    _datePicker._add("datepicker_date", function(t) {
      return new Date(t + 86400000 * 1).getTime();
    }, _datePicker._showDate);
  },
  _hourMin: function() {
    _datePicker._min("datepicker_hour", function(t) {
      return t == 0 ? 23 : t - 1;
    }, _datePicker._showHour);
  },
  _hourAdd: function() {
    _datePicker._add("datepicker_hour", function(t) {
      return t == 23 ? 0 : t + 1;
    }, _datePicker._showHour);
  },
  _minuteMin: function() {
    _datePicker._min("datepicker_minute", function(t) {
      return t == 0 ? 59 : t - 1;
    }, _datePicker._showMinute);
  },
  _minuteAdd: function() {
    _datePicker._add("datepicker_minute", function(t) {
      return t == 59 ? 0 : t + 1;
    }, _datePicker._showMinute);
  },
  _itemInit: function(id, time, fun1, fun2) {
    $("#" + id).html("");
    var _html = "";
    for (var i = 0; i < 5; i++) {
      var _item = "<div class='datepicker_item' time='" + time + "'>" + (fun1)(time) + "</div>";
      if (i == 0) {
        _item = "<div class='datepicker_item' time='" + time + "' style='margin-top: -50px'>" + (fun1)(time) + "</div>";
      }
      time = (fun2)(time);
      _html += _item;
    }
    $("#" + id).html(_html);
    _datePicker._current(id, true);
  },
  _notSupport: function(id) {
    $("#" + id + "_input").show();
  },
  _init: function(id, date) {
    _datePicker._id = id;
    date = date ? date.replace(/-/g, "/") : "";
    var _d = Date.parse(date) ? new Date(date) : new Date(),
      _hour = _d.getHours() - 2,
      _minute = _d.getMinutes() - 2,
      _date = _d.getTime() - 86400000 * 2;
    _hour = _hour < 0 ? _hour + 24 : _hour;
    _minute = _minute < 0 ? _minute + 60 : _minute;
    _datePicker._itemInit("datepicker_date", _date, _datePicker._showDate, function(t) {
      return new Date(t + 86400000 * 1).getTime();
    });
    _datePicker._itemInit("datepicker_hour", _hour, _datePicker._showHour, function(t) {
      return t == 23 ? 0 : t + 1;
    });
    _datePicker._itemInit("datepicker_minute", _minute, _datePicker._showMinute, function(t) {
      return t == 59 ? 0 : t + 1;
    });
  },
  _getValue: function() {
    var _current_date = _datePicker._getCurrent("datepicker_date");
    var _current_hour = _datePicker._getCurrent("datepicker_hour");
    var _current_minute = _datePicker._getCurrent("datepicker_minute");

    var _d = new Date(parseInt($(_current_date).attr("time")));
    var _month = (_d.getMonth() + 1) < 10 ? "0" + (_d.getMonth() + 1) : (_d.getMonth() + 1);
    var _day = _d.getDate() < 10 ? "0" + _d.getDate() : _d.getDate();
    var _date = _d.getFullYear() + "-" + _month + "-" + _day;

    var _hour = $(_current_hour).attr("time");
    var _minute = $(_current_minute).attr("time");
    if (_minute < 10) {
      _minute = "0" + _minute;
    }
    if (_hour < 10) {
      _hour = "0" + _hour;
    }
    return _date + " " + _hour + ":" + _minute;
  },
  _onBlur: function() {
    _postTemp._set(_datePicker._id, $("#" + _datePicker._id).val());
  },
  _earilier: function(date) {
    date = date.replace(/-/g, "/");
    if (!Date.parse(date)) {
      return true;
    }
    return new Date(date).getTime() < new Date().getTime();
  },
  _show: function(id) {
    _cover._show("cover2");
    $("#post_datepicker").show();
    _datePicker._init(id, $("#" + id).val());
    $("#cover2").bind("click", "", _datePicker._hide);
    setTimeout(function() {
      $("#post_datepicker").css({
        "margin-bottom": "0"
      });
    }, 50);
  },
  _hide: function() {
    $("#post_datepicker").css({
      "margin-bottom": "-200px"
    });
    setTimeout(function() {
      _cover._hide("cover2");
      $("#post_datepicker").hide();
    }, 300);
  },
  _ok: function() {
    $("#" + _datePicker._id).val(_datePicker._getValue());
    _datePicker._onBlur();
    _datePicker._hide();
  }
};

/**选择框*/
var _checkbox = {
  _check: function(id) {
    _checkbox._setValue(id, (parseInt(_checkbox._getValue(id)) + 1) % 2);
  },
  _getValue: function(id) {
    //return $("#"+id).attr("src").indexOf("checkbox-no2x")==-1?0:1;
    if ($("#" + id).children(".select_0").attr("checked")) {
      return 1;
    } else {
      return 0;
    }
  },
  _setValue: function(id, value, auto) {
    /*with($("#"+id)){
        var _src = $("#"+id).attr("src");
        $("#"+id).attr("src",(value==0?_src.replace(/checkbox-no2x/,"checkbox2x"):_src.replace(/checkbox2x/,"checkbox-no2x")));
    }*/
    value == 0 ? $("#" + id).children(".select_1").attr("checked") : $("#" + id).children(".select_0").attr("checked");
    if (!auto) {
      _postTemp._set(id, value);
    }
  }
};

/**报名项*/
var _postJoin = {
  _id: "",
  _tempId: "",
  _joinItemKey: "",
  _joinValueKey: "",
  _joinOrderKey: "",
  _initJoinArr: {
    1: "姓名",
    2: "手机",
    3: "单位",
    4: "职位",
    5: "行业",
    6: "备注"
  },
  _initJoinArr2: {
    1: "姓名",
    2: "手机",
    7: "性别"
  },
  _item: function(item) {
    $("#post_" + _postJoin._id + "_join_item_" + item).attr("class", "join_item_" + (_postJoin._selected(item) ? "no" : "static"));
    var _val = _postJoin._getValue();
    _postTemp._set(_postJoin._joinItemKey, _val);
    if (item == 2) {
      var _phoneClass = $("#post_" + _postJoin._id + "_join_item_" + item).attr("class");
      if (_phoneClass == "join_item_static") {
        $("#form_phone_recom div input").removeAttr("disabled");
        $("#form_phone_recom p").css("color", "#000000");
      } else {
        $("#form_phone_recom div input").attr("disabled", "disabled");
        $("#form_phone_recom p").css("color", "#cccccc");
      }
    }
    _hdbDragge._setValue();
  },
  _selected: function(item) {
    var _itme_class = $("#post_" + _postJoin._id + "_join_item_" + item).attr("class");
    if (_itme_class != undefined) {
      return _itme_class.indexOf("_static") != -1;
    }
    return true;
  },
  _getValue: function() {
    var _value = "1";
    for (var i = 2; i <= 7; i++) {
      if (_postJoin._selected(i)) {
        if (_postJoin._tempId == "104" && (i < 3 || i == 7)) {
          _value += "," + i;
        } else {
          _value += "," + i;
        }
      }
    }
    return _value;
  },
  _getNewValue: function() {
    var _newValue = "";
    $("li[id^='li_post_join_item_new_']").each(function() {
      if ($(this).attr("class").indexOf("or") > -1) {
        _newValue += $(this).text() + "^";
      }
    });
    return _newValue;
  },
  _setValue: function(value, joinValue) {
    var _joinItemOrder = _postTemp._get(_postJoin._joinOrderKey);
    if (_joinItemOrder != "") {
      $(".post_form_join_item").html("");
      var _liNew = 1;
      var _joinArr = _joinItemOrder.split("^");
      for (var i = 0, _len = _joinArr.length; i < _len; i++) {
        var _joinHtml = '';
        if (_joinArr[i] == "") {
          break;
        }
        var _item = _joinArr[i].split("#");
        var _item01 = _item[0];
        if (_item01.indexOf("lid_") > -1) {
          var _lid = _item01.substring(4, _item01.length);
          if (_lid == 1) {
            _joinHtml = '<li class="join_item_static" lid="1"><div class="xuanX">姓名</div></li>';
          } else {
            var _appendJoinHtml = "";
            if (_postJoin._tempId == "104") {
              _appendJoinHtml = "<div class=\"xuanX\">" + _postJoin._initJoinArr2[_lid] + "</div>";
            } else {
              _appendJoinHtml = "<div class=\"xuanX\">" + _postJoin._initJoinArr[_lid] + "</div>";
            }
            _joinHtml = "<li id=\"post_" + _postJoin._id + "_join_item_" + _lid + "\" class=\"join_item_" + (_item[1] == 1 ? "static" : "no") + "\" onclick=\"_postJoin._item(" + _lid + ")\" ontouchstart=\"\" lid=\"" + _lid + "\">" + _appendJoinHtml + "</li>";
          }
          $(".post_form_join_item").append(_joinHtml);
        } else {
          _joinHtml = _postJoin._initNewItem(_item[1], _liNew, _item[0]);
          $(".post_form_join_item").append(_joinHtml);
          $("#li_post_join_item_new_" + _liNew).bind("click", function() {
            var _index = $(this).attr("id").match(/\d+/g);
            _postJoin._clickNew(_postJoin._id + "_join_property_value", _index);
          });
          _liNew++;
        }
      }
      $(".post_form_join_item").append('<li title="增加填写项" id="post_join_item_add" class="join_item_no"><p id="post_itemAdd_p" onclick="_postJoin._newItem(this);">+添加</p></li>');
      var _clan = $('#post_' + _postJoin._id + '_join_item_2').attr("class");
      if (_clan.indexOf("static") == -1) {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").attr("disabled", "disabled");
        $("#form_phone_recom p").css("color", "#cccccc");
      } else {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").removeAttr("disabled");
        $("#form_phone_recom p").css("color", "#000000");
      }
      return;
    }

    if (value != "") {
      for (var i = 2; i <= 6; i++) {
        $("#post_" + _postJoin._id + "_join_item_" + i).attr("class", "join_item_" + (("," + value + ",").indexOf("," + i + ",") != -1 ? "static" : "no"));
      }
      if ($("#post_" + _postJoin._id + "_join_item_2").attr("class") == "join_item_static") {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").removeAttr("disabled");
        $("#form_phone_recom p").css("color", "#000000");
      } else {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").attr("disabled", "disabled");
        $("#form_phone_recom p").css("color", "#cccccc");
      }
    }
    if (joinValue == "") {
      return;
    }
    var _joinValueArr = joinValue.substring(0, joinValue.length - 1).split("\^");

    var _len = _joinValueArr.length;
    for (var i = 0; i < _len; i++) {
      var _ii = _joinValueArr[i].split("#");
      var _new_len = i + 1;
      $("#post_join_item_add").before(_postJoin._initNewItem(_ii[1], _new_len, _ii[0]));
      $("#li_post_join_item_new_" + _new_len).bind("click", function() {
        var _index = $(this).attr("id").match(/\d+/g);
        _postJoin._clickNew(_postJoin._id + "_join_property_value", _index);
      });
      $("#li_post_join_item_new_" + _new_len + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    }

    if (_len == 10) {
      $("#post_join_item_add").hide();
    }
  },
  _initNewItem: function(sel, newLen, val) {
    var _html = "<li lid=\"0\" class=\"join_item_no post_item_7 " + (sel == 1 ? "or" : "") + "\" id=\"li_post_join_item_new_" + newLen + "\"><p>" + val + "</p><img src=\"" + _imgCdn + "/images/post/post_join_item_7@2x.png\" onclick=\"_postJoin._delNewItem(" + newLen + ")\">" + "</li>";
    return _html;
  },
  _init: function(id, tempId) {
    _postJoin._id = id;
    _postJoin._tempId = tempId;
    _postJoin._joinItemKey = id + "_post_join_item";
    _postJoin._joinValueKey = id + "_join_property_value";
    _postJoin._joinOrderKey = id + "_join_property_order";
    _postJoin._setValue(_postTemp._get(_postJoin._joinItemKey), _postTemp._get(_postJoin._joinValueKey));
  },
  _newItem: function(o) {
    $("#post_itemAdd_p").hide();
    //$("#post_queR_p").show();
    var _new_len = $("li[id^='li_post_join_item_new_']").length + 1;
    var _html0 = "<p id=\"post_queR_p\" onclick=\"_postJoin._setNewValue('" + _postJoin._id + "_join_property_value',$('.post_join_item_7_text').val()," + _new_len + ")\">确定</p>";
    var _html = "<li lid=\"0\" class=\"join_item_no post_item_7\" id=\"li_post_join_item_new_" + _new_len + "\">" + "<input type=\"text\"  id=\"post_join_item_new_" + _new_len + "\" placeholder=\"请输入项目\" maxlength=\"10\" class=\"post_join_item_7_text\"/>" + "</li>";
    $(o).parent().before(_html);
    $(o).parent().append(_html0);
    $(".post_join_item_7_text").width(171);
    $(".post_join_item_7_text").parent().width(171);
    $("#post_join_item_new_" + _new_len).focus();
    $("#post_join_item_new_" + _new_len).keyup(function() { //禁止输入英文字符<>"'
      var str = $(this).val();
      if (_._trim(str) == "")
        return;
      if (/[<>"']/g.test(str)) {
        $(this).val(str.substr(0, str.length - 1));
      }
    });
  },
  _clickNew: function(key, index) {
    var _sel = 0;
    var _class = $("#li_post_join_item_new_" + index).attr("class");
    $("#li_post_join_item_new_" + index).attr("class", _class.indexOf("or") > -1 ? _class.replace("or", "") : _class + " or");
    _sel = _class.indexOf("or") > -1 ? 0 : 1;
    _postJoin._tempValue(key, $("#li_post_join_item_new_" + index).text(), index, _sel);
  },
  _setNewValue: function(key, value, index) {
    if (value == "") {
      $("#post_itemAdd_p").show();
      $("#li_post_join_item_new_" + index).remove();
      $("#post_queR_p").remove();
      $(".post_item_7").width(78);
      return;
    } else {
      if (index < 10) {
        $("#post_itemAdd_p").show();
        $("#post_queR_p").remove();
        $(".post_item_7").width(78);
      }
      $("#li_post_join_item_new_" + index).attr("class", "join_item_no post_item_7 or");
      $("#li_post_join_item_new_" + index).html("<p>" + value + "</p><img src=\"" + _imgCdn + "/images/post/post_join_item_7@2x.png\" onclick=\"_postJoin._delNewItem(" + index + ")\">");
      $("#li_post_join_item_new_" + index + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    }
    _postJoin._tempValue(key, value, index, 1);
  },
  _tempValue: function(key, value, index, sel) {
    var _value = _postTemp._get(key);
    if (_value != "") {
      var _valueArr = _value.substring(0, _value.length - 1).split("\^");
      var _arrIndex = index - 1;
      _value = "";
      var _insert = true;
      for (var i = 0, len = _valueArr.length; i < len; i++) {
        if (i == _arrIndex) {
          if (value != "") {
            _value += value + "#" + sel + "^";
          }
          _insert = false;
        } else {
          _value += _valueArr[i] + "^";
        }
      }
      if (_insert) {
        _value += value + "#" + sel + "^";
      }
    } else {
      if (value != "") {
        _value = value + "#" + sel + "^";
      }
    }
    _postTemp._set(key, _value);
    _hdbDragge._setValue();
  },
  _delNewItem: function(index) {

    var _value = _postTemp._get(_postJoin._joinValueKey);

    var _valueArr = _value.substring(0, _value.length - 1).split("\^");
    var _arrIndex = index - 1;
    _value = "";
    for (var i = 0, len = _valueArr.length; i < len; i++) {
      if (i != _arrIndex) {
        _value += _valueArr[i] + "^";
      }
    }
    _postTemp._set(_postJoin._joinValueKey, _value);
    $("#li_post_join_item_new_" + index).remove();
    $("li[id^='li_post_join_item_new_']").each(function(i) {
      $(this).attr("id", "li_post_join_item_new_" + (i + 1));
      $("#" + $(this).attr("id") + " img").unbind("click");
      $("#" + $(this).attr("id") + " img").attr("onclick", "").click(eval(function() {
        _postJoin._delNewItem(i + 1);
      }));
      $(this).unbind("click");
      $(this).bind("click", function() {
        var _index = $(this).attr("id").match(/\d+/g);
        _postJoin._clickNew(_postJoin._id + "_join_property_value", _index);
      });
      $("#" + $(this).attr("id") + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    });

    $("#post_join_item_add").show();
    _hdbDragge._setValue();
  }
};

var _hdbDragge = {
  _flag: true,
  _init: function() {
    $("li[id^='post_" + _postJoin._id + "_join_item_']").attr("onclick", "");
    $("li[id^='li_post_join_item_new_']").unbind();
    $("li[id^='li_post_join_item_new_'] img").hide();
    $("#a_post_order").html("完成");
    $("#a_post_order").unbind("click");
    $("#a_post_order").attr("onclick", "").click(eval(function() {
      _hdbDragge._end();
    }));
    $("#post_join_item_add").remove();
    $(".post_form_join_item").dragsort({
      dragBetween: true
    });
  },
  _end: function() {
    $("#a_post_order").html("排序");
    $(".post_form_join_item").dragsort("destroy");
    $("#a_post_order").unbind("click");
    $("#a_post_order").attr("onclick", "").click(eval(function() {
      _hdbDragge._init();
    }));
    $("li[id^='post_" + _postJoin._id + "_join_item_']").each(function() {
      $(this).unbind("click");
      $(this).attr("onclick", "").click(eval(function() {
        _postJoin._item($(this).attr("lid"));
      }));
      $(this).attr("id", "post_" + _post._type + "_join_item_" + $(this).attr("lid"));
    });
    $("li[id^='li_post_join_item_new_']").each(function(i) {
      $(this).attr("id", "li_post_join_item_new_" + (i + 1));
      $("#" + $(this).attr("id") + " img").unbind("click");
      $("#" + $(this).attr("id") + " img").attr("onclick", "").click(eval(function() {
        _postJoin._delNewItem(i + 1);
      }));
      $(this).bind("click", function() {
        var _index = $(this).attr("id").match(/\d+/g);
        _postJoin._clickNew(_postJoin._id + "_join_property_value", _index);
      });
      $("#" + $(this).attr("id") + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    });
    $(".post_form_join_item").append('<li title="增加填写项" onclick="_postJoin._newItem(this);" id="post_join_item_add" class="join_item_no" ontouchstart=""><p><img src="' + _imgCdn + '/images3/post/join_item_add2x.png"></p></li>');
    $("li[id^='li_post_join_item_new_'] img").show();
    _hdbDragge._setValue();
  },
  _setValue: function() {
    var _joinOrder = "";
    $(".post_form_join_item li").each(function() {
      if ($(this).attr("id") !== "post_join_item_add") {
        if ($(this).attr("lid") != "0") {
          var _sel = $(this).attr("class").indexOf("static") > -1 ? "1" : "0";
          _joinOrder += "lid_" + $(this).attr("lid") + "#" + _sel + "^";
        } else {
          var _sel = $(this).attr("class").indexOf("or") > -1 ? "1" : "0";
          _joinOrder += $(this).text() + "#" + _sel + "^";
        }
      }
    });
    _postTemp._set(_postJoin._joinOrderKey, _joinOrder);
  },
  _getValue: function() {
    var _joinOrderVal = "";
    $(".post_form_join_item li").each(function() {
      if ($(this).attr("id") !== "post_join_item_add") {
        if ($(this).attr("class").indexOf("static") > -1 || $(this).attr("class").indexOf("or") > -1) {
          _joinOrderVal += $(this).text() + "^";
        }
      }
    });
    _hdbDragge._setValue();
    return _joinOrderVal;
  }
};

/**绑定银行卡相关*/
var _bindBank = {
  _id: "",
  _center: function() {
    var _top = _._zero(_._client().bh - $("#" + _bindBank._id).outerHeight()) / 2 + "px";
    var _left = _._zero(_._client().bw - $("#" + _bindBank._id).outerWidth()) / 2 + "px";
    $("#" + _bindBank._id).css({
      "left": _left,
      "bottom": _top,
      "z-index": "3000",
      "position": "fixed"
    });
  },
  _bdCard: function(id) {
    _bindBank._id = id;
    _cover._show("cover2");
    _bindBank._center();
    $("#" + id).show();
    $("#cover2").bind("click", _bindBank._hide);
  },
  _hide: function() {
    $("#" + _bindBank._id).hide();
    _cover._hide("cover2");
  }
};

/**支付项*/
var _payItem = {
  _id: "",
  _show: function(isupdate) {
    var _thisNext = _post._type.replace(_post._type, function($1) {
      return $1 ? ($1.substring(0, 1).toUpperCase() + $1.substring(1)) : '';
    });

    var _name = _postTemp._get(_payItem._id + "_pay_item_name");
    if (_name.length > 1) {
      var _src = $("#post_pay_more_img").attr("src");
      //$("#post_pay_more_img").attr("src",_src.replace("cost2x.png","cost2x-click.png"));
      if (isupdate) {
        $(".form_input_cost input").attr("readonly", "");
      }
      $("div[id^='" + _payItem._id + "_pay_item_']").show();
      $("#" + _payItem._id + "_post_option_cost_add").show();
    }

    if (_postTemp._get(_payItem._id + "_pay_show") == "1") {
      _payItem._bankAfter();
      return;
    }
    if (!_user._login()) {
      _user._toLogin(_thisNext);
      return;
    }

  },
  _bankAfter: function() {
    var _src = $("#post_pay_more_img").attr("src");
    $("#post_pay_more_img").attr("src", _src.indexOf("cost2x-click.png") > -1 ? _src.replace("cost2x-click.png", "cost2x.png") : _src.replace("cost2x.png", "cost2x-click.png"));
    if (_src.indexOf("cost2x-click.png") > -1) {
      $("div[id^='" + _payItem._id + "_pay_item_']").hide();
      $("#" + _payItem._id + "_post_option_cost_add").hide();
    } else {
      $("div[id^='" + _payItem._id + "_pay_item_']").show();
      $("#" + _payItem._id + "_post_option_cost_add").show();
    }

    if (_maxMoney._max == 0) {
      _maxMoney._init();
    }
    if (_post._id != "") {
      $("#" + _payItem._id + "_post_option_cost_add").hide();
    }
  },
  _checkBindOk: function(json, code) {
    if (code != 200) {
      return;
    }
    if (json.is_pay == 1 && json.status == "2") {
      if (json.first == 1) {
        $("#post_audit").html("");
        _attestOk._bankCard = json.bankCard;
        $("#span_max_money").html(json.max_money);
        _attestOk._show();
      } else {
        _payItem._toBindBank(json, code);
      }
    } else if (json.is_pay == 1) {
      _payItem._toBindBank(json, code);
      return;
    } else {
      if (json.status == "-1") {
        _g(_postApi._attest + "/" + _payItem._id);
      }
      //待审核
      else if (json.status == "1") {
        _g(_postApi._auditing + "/" + _payItem._id);
      }
      //未通过可审请
      else if (json.status == "3" || json.status == "4") {
        _g(_postApi._noAudit + "/" + _payItem._id);
      }
    }
  },
  _toBindBank: function(json, code) {
    $("#post_audit").html("");
    //未绑定银行卡
    if (json.bankCard == 1) {
      _bindBank._bdCard("tc_bdCard");
    } else {
      _payItem._bankAfter();
    }
  },
  _setValue: function(key, value, index) {

    var _name = "",
      _price = "",
      _num = "";
    $("input[id^='" + _payItem._id + "_pay_item_name_']").each(function() {
      //_name+= _._trim($(this).val().replace(/[%^\']+/gi,""))+"^";
      _name += _._trim($(this).val().replace(/[\^]+/gi, "")) + "^";
    });
    $("input[id^='" + _payItem._id + "_pay_item_price_']").each(function(i) {
      _price += _._trim($(this).val()) + "^";
    });
    $("input[id^='" + _payItem._id + "_pay_item_num_']").each(function(i) {
      var _val = _._trim($(this).val());
      _num = _val == "" ? _num += "0^" : _num += _val + "^";
    });
    var _name_arr = _name.split("^"),
      _price_arr = _price.split("^"),
      _num_arr = _num.split("^");
    var _name_true = "",
      _price_true = "",
      _num_true = "";
    if (_name_arr.length > 0) {
      for (var i = 0; i < _name_arr.length; i++) {
        var nv = _name_arr[i];
        var pv = _price_arr[i];
        var nmv = _num_arr[i];
        if (nv != "") {
          _name_true += "^" + nv;
          _price_true += "^" + pv;
          _num_true += "^" + nmv;
        }
      }
      _name_true = _name_true.substring(1);
      _price_true = _price_true.substring(1);
      _num_true = _num_true.substring(1);
    }
    _postTemp._set(_payItem._id + "_pay_item_name", _name_true);
    _postTemp._set(_payItem._id + "_pay_item_price", _price_true);
    _postTemp._set(_payItem._id + "_pay_item_num", _num_true);
    _joinLimit._show();
  },
  _addItem: function(isHide, isPla) {
    var _len = $("div[id^='" + _payItem._id + "_pay_item_']").length;
    var _index = _len + 1;
    if (_index >= 6) {
      $("#" + _payItem._id + "_post_option_cost_add a").hide();
      return;
    }
    var _dis = "";
    if (isHide) {
      _dis = "style=\"display: none\"";
    }
    var _html = " <div class=\"cost_content\" id=\"" + _payItem._id + "_pay_item_" + _index + "\" busId=\"\">" + " <div class=\"form_input_number\"></div>" + " <div class=\"form_input_cost form_input_cost_type\">" + "  <input type=\"text\" onblur=\"_payItem._setValue('" + _payItem._id + "_pay_item_name',$(this).val()," + _index + ");\" placeholder=\"费用名称" + _index + "\" maxlength=\"30\" class=\"input cost_name\" id=\"" + _payItem._id + "_pay_item_name_" + _index + "\"> " + " </div>"

    +" <div class=\"form_input_cost form_input_cost_money\">" + "  <input type=\"text\" onblur=\"_payItem._setValue('" + _payItem._id + "_pay_item_price',$(this).val()," + _index + ");\" placeholder=\"金额，免费请填0\" maxlength=\"30\" class=\"input\" id=\"" + _payItem._id + "_pay_item_price_" + _index + "\">" + " </div>"

    + " <div class=\"form_input_cost form_input_cost_people\">" + "  <input type=\"text\" onblur=\"_payItem._setValue('" + _payItem._id + "_pay_item_num',$(this).val()," + _index + ");\" placeholder=\"人数，不填则无限制\" maxlength=\"30\" class=\"input\" id=\"" + _payItem._id + "_pay_item_num_" + _index + "\">" + " </div><a title=\"删除\" class=\"controlClear\" onclick=\"_partyPostPC._delItem(" + _index + ")\"></a>" + "</div>";

    $("#" + _payItem._id + "_post_option_cost_add").before(_html);
    if (isPla) {
      _placeholder._init(_payItem._id + "_pay_item_" + _index);
    }
    $(".cost_content").each(function() {
        var it = $(this).index();
        $(this).attr("id",'party_' + _post._tempId + '_pay_item_'+it);
        $(this).children(".form_input_number").html(it);
        $(this).find(".form_input_cost_type").children("input").attr({"id": 'party_' + _post._tempId + '_pay_item_name_'+it,"placeholder":"费用名称"+it});
        $(this).find(".form_input_cost_money").children("input").attr({"id": 'party_' + _post._tempId + '_pay_item_price_'+it});
        $(this).find(".form_input_cost_people").children(".input").attr({"id": 'party_' + _post._tempId + '_pay_item_num_'+it});
        if($(this).children(".controlClear").length!=0){
        	$(this).children(".controlClear").attr('onclick','_partyPostPC._delItem('+it+')');
        }
      });
    _payItem._keyup();
  },
  _check: function() {
    var _wrong = false;
    var isfree = $('input:radio[name="fee"]:checked').val();
    if (isfree != undefined && isfree == "0") {
      return _wrong;
    }
    $("input[id^='" + _payItem._id + "_pay_item_name_']").each(function(i) {
      if (_payItem._checkName(i + 1, true)) {
        _wrong = true;
        return false;
      }
    });

    if (_wrong) {
      return true;
    }
    $("input[id^='" + _payItem._id + "_pay_item_price_']").each(function(i) {
      var _value = _._trim($(this).val());
      if (_payItem._checkPrice(i + 1, true)) {
        _wrong = true;
        return false;
      }
      if (_value != "" && !_value.match(/^((\d*)(\.\d{1,2})?)$/)) {
        $(this).focus();
        _toast._show("支付金额只能输入数字");
        _wrong = true;
        return false;
      }
    });

    if (_wrong) {
      return true;
    }

    $("input[id^='" + _payItem._id + "_pay_item_num_']").each(function() {
      if ($(this).val() != "" && !$(this).val().match(/[1-9]/)) {
        $(this).focus();
        _toast._show("人数限制只能输入大于0的数字");
        _wrong = true;
        return false;
      }
    });

    if (_wrong) {
      return _wrong;
    }

    return _wrong;
  },
  _checkName: function(index, flag) {
    var _obj = $("#" + _payItem._id + "_pay_item_name_" + index);
    var _p = _._trim($("#" + _payItem._id + "_pay_item_price_" + index).val());
    var _n = _._trim($("#" + _payItem._id + "_pay_item_num_" + index).val());

    var _value = _._trim(_obj.val());
    if (_value == "") {
      if (_p != "" || _n != "") {
        if (flag) {
          _obj.focus();
        }
        _toast._show("请填写费用名称");
        return true;
      }
    } else {
      if (_._len(_value) > 40) {
        if (flag) {
          _obj.focus();
        }
        _toast._show("费用名称请在20个字以内");
        return true;
      }
      var _wrong = false;
      $("input[id^='" + _payItem._id + "_pay_item_name_']").each(function(i) {
        var _v = _._trim($(this).val());
        if (index != (i + 1) && _v == _value) {
          if (flag) {
            _obj.focus();
          }
          _toast._show("第" + index + "项和第" + (i + 1) + "项费用名称不能重复");
          _wrong = true;
          return false;
        }
      });
      if (_wrong) {
        return true;
      }
    }
    return false;
  },
  _checkPrice: function(index, flag) {
    var _obj = $("#" + _payItem._id + "_pay_item_price_" + index);
    var _na = _._trim($("#" + _payItem._id + "_pay_item_name_" + index).val());
    var _nu = _._trim($("#" + _payItem._id + "_pay_item_num_" + index).val());

    var _value = _._trim(_obj.val());
    if (_value == "") {
      if (_na != "" || _nu != "") {
        if (flag) {
          _obj.focus();
        }
        _toast._show("请输入金额");
        return true;
      }
    }
    return false;
  },
  _keyup: function() {
    $("input[id^='" + _payItem._id + "_pay_item_price_']").keyup(function() {
      $(this).val($(this).val().replace(/[^(\d,\.)]/g, ''));
      var _p = $(this).val();
      if (_p == "00") {
        $(this).val("0");
        return;
      }
      var _dlen = (parseInt(_maxMoney._max) + "").length;

      var _a = new RegExp("^\\d{1," + _dlen + "}((\\.)|(\\.\\d{1,2}))?$");
      var _aa = new RegExp("\\d{1," + _dlen + "}(\\.\\d{1,2})?");

      if (_a.test(_p)) {
        $(this).val(_p);
      } else {
        if (parseInt(_p) >= _maxMoney._max) {
          $(this).val(_maxMoney._max);
        } else {
          $(this).val(_p.match(_aa)[0]);
        }
      }
    });
    $("input[id^='" + _payItem._id + "_pay_item_num_']").keyup(function() {
      $(this).val($(this).val().replace(/[^(\d)]/g, ''));
      var _p = $(this).val();
      if (parseInt(_p) > 100000) {
        $(this).val(100000);
      }
    });
  },
  _getValue: function() {
    var _payItemArr = ["", "", ""];
    var _name = "",
      _price = "",
      _num = "";
    $("input[id^='" + _payItem._id + "_pay_item_name_']").each(function() {
      _name += _._trim($(this).val().replace(/[\^]+/gi, "")) + "^";
    });
    $("input[id^='" + _payItem._id + "_pay_item_price_']").each(function(i) {
      _price += _._trim($(this).val()) + "^";
    });
    $("input[id^='" + _payItem._id + "_pay_item_num_']").each(function(i) {
      var _val = _._trim($(this).val());
      _num = _val == "" ? _num += "0^" : _num += _val + "^";
    });
    var _name_arr = _name.split("^");
    var _price_arr = _price.split("^");
    var _num_arr = _num.split("^");
    var _name_true = "",
      _price_true = "",
      _num_true = "";
    if (_name_arr.length > 0) {
      for (var i = 0; i < _name_arr.length; i++) {
        var nv = _name_arr[i];
        var pv = _price_arr[i];
        var nmv = _num_arr[i];
        if (nv != "") {
          _name_true += "^" + nv;
          _price_true += "^" + pv;
          _num_true += "^" + nmv;
        }
      }
      _name_true = _name_true.substring(1);
      _price_true = _price_true.substring(1);
      _num_true = _num_true.substring(1);
    }
    _payItemArr[0] = _name_true;
    _payItemArr[1] = _price_true;
    _payItemArr[2] = _num_true;
    return _payItemArr;
  },
  _isPayItem: function() {
    var _nameArr = _postTemp._get(_payItem._id + "_pay_item_name").split("^");
    var _priceArr = _postTemp._get(_payItem._id + "_pay_item_price").split("^");
    var _flag = false;
    for (var i = 0, _len = _nameArr.length; i < _len; i++) {
      if (i < _nameArr.length && _nameArr[i] != "" && i < _priceArr.length && _priceArr[i] != "") {
        _flag = true;
        break;
      }
    }
    return _flag;
  },
  _init: function(id) {
    _payItem._id = id;
    var _name = _postTemp._get(_payItem._id + "_pay_item_name");
    var _price = _postTemp._get(_payItem._id + "_pay_item_price");
    var _num = _postTemp._get(_payItem._id + "_pay_item_num");

    var _audit = _t._get(_user._id + "_auditing");
    if (_audit == 1) {
      $("#post_audit").html("待审核");
    } else if (_audit == 2) {
      $("#post_audit").html("审核未通过");
    }
    _t._set(_user._id + "_auditing", "");

    if (_name != "" && _price != "") {
      _name = _name.lastIndexOf("\^") == (_name.length - 1) ? _name.substring(0, _name.length - 1) : _name;
      _price = _price.lastIndexOf("\^") == (_price.length - 1) ? _price.substring(0, _price.length - 1) : _price;
      var _nameArr = _name.split("\^");
      var _priceArr = _price.split("\^");
      var _numArr = _num.split("\^");

      if (_payItem._isPayItem()) {
        for (var i = 0, len = _nameArr.length; i < len; i++) {
          if (_nameArr[i] != "" || (i < _priceArr.length && _priceArr[i] != "")) {
            _payItem._addItem(false, false);
            $("#" + _payItem._id + "_pay_item_name_" + (i + 1)).val(_nameArr[i]);
            $("#" + _payItem._id + "_pay_item_price_" + (i + 1)).val(_priceArr[i]);
            if (_numArr[i] != "0") {
              $("#" + _payItem._id + "_pay_item_num_" + (i + 1)).val(_numArr[i]);
            }
          }
        }
        var isupdatem = _post._id != "";
        _payItem._show(isupdatem);
      }
    } else {
      _payItem._addItem(true, false);
    }
    _payItem._keyup();
  }
};
var _attestOk = {
  _bankCard: 0,
  _center: function() {
    var _top = _._zero(_._client().bh - $("#tc_checkOk").outerHeight()) / 2 + "px";
    var _left = _._zero(_._client().bw - $("#tc_checkOk").outerWidth()) / 2 + "px";
    $("#tc_checkOk").css({
      "left": _left,
      "top": _top,
      "z-index": "3000",
      "position": "fixed"
    });
  },
  _show: function() {
    _cover._show("cover2");
    _attestOk._center();
    $("#tc_checkOk").show();
    $(window).bind("resize", _attestOk._center);
    $("#cover2").bind("click", _attestOk._hide);
  },
  _hide: function() {
    $("#tc_checkOk").hide();
    _cover._hide("cover2");
  },
  _yes: function() {
    _$(_postApi._attestYes, "", _attestOk._ok);
  },
  _ok: function(josn, code) {
    if (code != 200) {
      return;
    }
    _attestOk._hide();
    if (_attestOk._bankCard == 1) {
      _bindBank._bdCard("tc_bdCard");
    } else {
      _payItem._bankAfter();
    }
  }
};

/*报名人数限制*/
var _joinLimit = {
  _id: "",
  _init: function(id) {
    _joinLimit._id = id;

    $(".limitNum .limit_L input").keyup(function() {
      $(this).val($(this).val().replace(/[^(\d)]/g, ''));
      $(this).val($(this).val().replace(/^0/g, ''));
    });
    $(".limitNum .limit_L input").blur(function() {
      if ($(this).val() != '') {
        thisNum = $(this).val();
        if (thisNum <= 500000) {
          $(this).next("p").html("允许" + thisNum + "人报名").show();
          $(this).hide();
          _postTemp._set("post_" + _joinLimit._id + "_limit", thisNum);
        }
      } else {
        _postTemp._set("post_" + _joinLimit._id + "_limit", "");
      }
    });
    $(".limitNum .limit_L input").focus(function() {
      if ($(this).val() != '') {
        $(this).next("p").hide();
        $(this).show();
      }
    });
    $(".limitNum .limit_L p").click(function() {
      if (_payItem._isPayItem() && $("#fee_1").attr("checked")) {
        return;
      };
      $(this).hide();
      var tNr = $(this).prev("input").val();
      $(this).prev("input").val('').show().focus().val(tNr);
    });
    _joinLimit._show();
  },
  _show: function() {
    if (_payItem._isPayItem()) {
      var _limitPay = "";
      var _nameArr = _postTemp._get(_joinLimit._id + "_pay_item_name").split("^");
      var _priceArr = _postTemp._get(_joinLimit._id + "_pay_item_price").split("^");
      var _numArr = _postTemp._get(_joinLimit._id + "_pay_item_num").split("^");

      for (var i = 0, _len = _nameArr.length; i < _len; i++) {
        if (i < _nameArr.length && _nameArr[i] != "" && i < _priceArr.length && _priceArr[i] != "") {
          if (i < _numArr.length) {
            if (_numArr[i] == "0" || _numArr[i] == "") {
              _limitPay += "无限制/";
            } else {
              _limitPay += _numArr[i] + "/";
            }
          } else {
            _limitPay += "无限制/";
          }
        }
      }

      if (_limitPay != "") {
        $(".limitNum .limit_L input").hide();
        $(".limitNum .limit_L p").show();
        $(".limitNum .limit_L p").html("允许" + _limitPay.substring(0, _limitPay.length - 1) + "人报名");
      }

    } else {
      var _getTempId = _post._tempId;
      var _cacheTempId = _getTempId,
        _pjstr = "";
      if (_post._id != "") {
        _cacheTempId += "_m";
        _pjstr + "_m";
      }
      var _limit = _postTemp._get("post_party_limit_" + _cacheTempId);
      if (_limit != "" && _limit != "0") {
        $("#person_limit").val(_limit);
        thisNum = $(".limitNum .limit_L input").val();
        $(".limitNum .limit_L p").html("允许" + thisNum + "人报名").show();
        $(".limitNum .limit_L input").hide();
      } else {
        $(".limitNum .limit_L input").show();
        $(".limitNum .limit_L p").hide();
      }
      if (_limit > 500000) {
        $(".limitNum .limit_L input").show();
        $(".limitNum .limit_L input").val('');
        $(".limitNum .limit_L p").hide();
      }
    }
  }

};

/**最大金额*/
var _maxMoney = {
  _max: 0,
  _init: function() {
    //_$(_postApi._maxMoney,"",_maxMoney._ok);
    _maxMoney._max = 10000;
  },
  _ok: function(json, code) {
    if (code != 200) {
      return;
    }
    _maxMoney._max = json.max_money;
  }
};
var _postDetail = function(url) {
  var _aa = $("<a href=\"" + url + "\"></a>");
  $("body").append(_aa);
  _aa[0].click();
};


/*公众号二维码*/
var _moreGn = {
  _center: function() {
    var _top = _._zero(_._client().bh - $("#moreGn").outerHeight()) / 2 + "px";
    var _left = _._zero(_._client().bw - $("#moreGn").outerWidth()) / 2 + "px";
    $("#moreGn").css({
      "left": _left,
      "top": _top,
      "z-index": "3000",
      "position": "fixed"
    });
  },
  _show: function() {
    _cover._show("cover2");
    _moreGn._center();
    $("#moregn_ol_" + _post._type).show();
    $("#moreGn").show();
    $(window).bind("resize", _moreGn._center);
    $("#cover2").bind("click", _moreGn._hide);
  },
  _hide: function() {
    $("#moreGn").hide();
    _cover._hide("cover2");
  }
};

var _qkInput = {
  _id: "",
  _hide: function(id, qk) {
    $(id).val("");
    $(qk).css("display", "none");
  },
  _hide2: function(d, h, qk) {
    $(d, h).val("");
    $(qk).css("display", "none");
  },
  _show: function() {
    $(".post_d_t_input").each(function() {
      if ($(this).val() != "") {
        $(this).parent().children(".qK").css("display", "block");
      }
    });
  },
  _show2: function() {
    if ($(".post_siTe").val() != "") {
      $(".k_site input").removeClass("jiao");
      $("#qK4").css("display", "block");
    }
  },
  _show3: function() {
	  if ($(".k_style input").val() != "") {
		  $("#qK6").css("display", "block");
		  $(".k_style input").attr("class","");
	  }
	  if ($(".post_style_K input").val() != "") {
		  $("#qK7").css("display", "block");
		  $(".post_style_K input").attr("class","");
	  }
  }
};


var _map_set = {
  _left: function() {
    $(".post_map_site").hide();
    $(".post_map_btn").html('<a href="javascript:void(0);" id="map_set" onclick="_map_set._right();" class="thisOver"></a>');
    $(".post_map").width(838);
    $("#map_set").css("left", 0);
  },
  _right: function() {
    $(".post_map_site").show();
    $(".post_map_btn").html('<a href="javascript:void(0);" id="map_set" onclick="_map_set._left();"></a>');
    $(".post_map").width(558);
    $("#map_set").css("left", 279 + "px");
  },
  _h: function() {
    var _hot = $(".post_site_hot").height();
    $(".example1 .scrollbar,.example1 .sly").height(385 - _hot);
    _qkInput._show2();
  },
  _abc: function(id) {
    var _h = $(".sly_h").height(),
      _hli = 0,
      _i = $("#" + id).index();
    for (var i = 0; i < _i; i++) {
      var thisD = $(".post_site_wz")[i];
      _hli = _hli + $(thisD).height() + 10;
    }
    if (_hli > (_h - 325)) {
      _hli = _h - 325;
    }
    $(".sly_h").animate({
      "top": (0 - _hli) + "px"
    }, 500);
    var h2 = $(".handle").height();
    $(".handle").css('top', (325 - h2) * _hli / (_h - 325) + 'px').unbind("click");
  }
};

var _partyJoinItem = {
  _id: "",
  _tempId: "",
  _joinItemKey: "",
  _joinValueKey: "",
  _joinOrderKey: "",
  _initJoinArr: {
    1: "姓名",
    2: "手机",
    3: "单位",
    4: "职位",
    5: "行业",
    6: "备注",
    30: "性别"
  },
  _init: function(id, tempId) {
    _partyJoinItem._id = id;
    _partyJoinItem._tempId = tempId;
    _partyJoinItem._joinItemKey = id + "_post_join_item";
    _partyJoinItem._joinValueKey = id + "_join_property_value";
    _partyJoinItem._joinOrderKey = id + "_join_property_order";
    _partyJoinItem._setValue(_postTemp._get(_partyJoinItem._joinItemKey), _postTemp._get(_partyJoinItem._joinValueKey));
  },
  _setValue: function(value, joinValue) {
    var _joinItemOrder = _postTemp._get(_partyJoinItem._joinOrderKey);
    if (_joinItemOrder != "") {
      $(".post_form_join_item").html(""); //清空报名选项信息
      var _liNew = 1;
      var _joinArr = _joinItemOrder.split("^");
      for (var i = 0, _len = _joinArr.length; i < _len; i++) {
        var _joinHtml = '';
        if (_joinArr[i] == "") {
          break;
        }
        var _item = _joinArr[i].split("#");
        var _item01 = _item[0];
        if (_item01.indexOf("lid_") > -1) {
          var _lid = _item01.substring(4, _item01.length);
          if (_lid == 1) {
            _joinHtml = "<li class=\"join_item_static\" lid=\"1\" ><div class=\"xuanX\">姓名</div></li>";
          } else {
            _joinHtml = "<li id=\"post_" + _partyJoinItem._id + "_join_item_" + _lid + "\" class=\"join_item_" + (_item[1] == 1 ? "static" : "no") + "\" " +
              "onclick=\"_partyJoinItem._item(" + _lid + ")\" ontouchstart=\"\" lid=\"" + _lid + "\">" +
              "<div class=\"xuanX\">" + _partyJoinItem._initJoinArr[_lid] + "</div></li>";
          }
          $(".post_form_join_item").append(_joinHtml);
        } else {
          _joinHtml = _partyJoinItem._initNewItem(_item[1], _liNew, _item[0]);
          $(".post_form_join_item").append(_joinHtml);

          _partyJoinItem._newItemClick(_liNew);
          _liNew++;
        }
      }
      $(".post_form_join_item").append("<li title=\"增加填写项\" id=\"post_join_item_add\" class=\"join_item_no\"><p id=\"post_itemAdd_p\" " +
        "onclick=\"_partyJoinItem._newItem(this)\">+添加</p></li>");
      return;
    }

    if (value != "") {
      for (var i = 2; i <= 6; i++) {
        $("#post_" + _partyJoinItem._id + "_join_item_" + i).attr("class", "join_item_" + (("," + value + ",").indexOf("," + i + ",") != -1 ? "static" : "no"));
      }
      if ($("#post_" + _partyJoinItem._id + "_join_item_2").attr("class") == "join_item_static") {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").removeAttr("disabled");
        $("#form_phone_recom p").css("color", "#000000");
      } else {
        $("#form_phone_recom").show();
        $("#form_phone_recom div input").attr("disabled", "disabled");
        $("#form_phone_recom p").css("color", "#cccccc");
      }
    }
    if (joinValue == "") {
      return;
    }
    var _joinValueArr = joinValue.substring(0, joinValue.length - 1).split("\^");

    var _len = _joinValueArr.length;
    for (var i = 0; i < _len; i++) {
      var _ii = _joinValueArr[i].split("#");
      var _new_len = i + 1;
      $("#post_join_item_add").before(_partyJoinItem._initNewItem(_ii[1], _new_len, _ii[0]));
      /*$("#li_post_join_item_new_" + _new_len).bind("click", function(){
       var _index = $(this).attr("id").match(/\d+/g);
       _partyJoinItem._clickNew(_partyJoinItem._id+ "_join_property_value", _index);
       }) ;*/
      _partyJoinItem._newItemClick(_new_len);
      $("#li_post_join_item_new_" + _new_len + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    }

    if (_len == 10) {
      $("#post_join_item_add").hide();
    }
  },
  _newItemClick: function(new_len) {
    $("#li_post_join_item_new_" + new_len).bind("click", function() {
      var _index = $(this).attr("id").match(/\d+/g);
      _partyJoinItem._clickNew(_partyJoinItem._id + "_join_property_value", _index);
    });
  },
  _item: function(item) {
    $("#post_" + _partyJoinItem._id + "_join_item_" + item).attr("class", "join_item_" + (_partyJoinItem._selected(item) ? "no" : "static"));
    var _val = _partyJoinItem._getValue();
    _postTemp._set(_partyJoinItem._joinItemKey, _val);
    if (item == 2) {
      var _phoneClass = $("#post_" + _partyJoinItem._id + "_join_item_" + item).attr("class");
      if (_phoneClass == "join_item_static") {
        $("#form_phone_recom div input").removeAttr("disabled");
        $("#form_phone_recom p").css("color", "#000000");
      } else {
        $("#form_phone_recom div input").attr("disabled", "disabled");
        $("#form_phone_recom p").css("color", "#cccccc");
      }
    }
    _hdbDragge._setValue();
  },
  _initNewItem: function(sel, newLen, val) {
    var _html = "<li lid=\"0\" class=\"join_item_no post_item_7 " + (sel == 1 ? "or" : "") + "\" id=\"li_post_join_item_new_" + newLen + "\">" + "<p>" + val + "</p><img src=\"" + _imgCdn + "/static_v4/images/post/post_join_item_7@2x.png\" onclick=\"+_partyJoinItem._delNewItem(" + newLen + ")\">" + "</li>";
    return _html;
  },
  _clickNew: function(key, index) {
    var _sel = 0;
    var _class = $("#li_post_join_item_new_" + index).attr("class");
    $("#li_post_join_item_new_" + index).attr("class", _class.indexOf("or") > -1 ? _class.replace("or", "") : _class + " or");
    _sel = _class.indexOf("or") > -1 ? 0 : 1;
    _partyJoinItem._tempValue(key, $("#li_post_join_item_new_" + index).text(), index, _sel);
  },
  _newItem: function(o) {
    $("#post_itemAdd_p").hide();
    var _new_len = $("li[id^='li_post_join_item_new_']").length + 1;
    var _html0 = "<p id=\"post_queR_p\" " +
      " onclick=\"_partyJoinItem._setNewValue('" + _partyJoinItem._id + "_join_property_value', $('.post_join_item_7_text').val()," + _new_len + ")\">确定</p>";
    var _html = "<li lid=\"0\" class=\"join_item_no post_item_7\" id=\"li_post_join_item_new_" + _new_len + "\" >" + "<input type=\"text\"  id=\"post_join_item_new_" + _new_len + "\" placeholder=\"请输入项目\" maxlength=\"10\" class=\"post_join_item_7_text\"/> </li>";
    $(o).parent().before(_html);
    $(o).parent().append(_html0);
    $(".post_join_item_7_text").width(171);
    $(".post_join_item_7_text").parent().width(171);
    $("#post_join_item_new_" + _new_len).focus();
    $("#post_join_item_new_" + _new_len).keyup(function() { //禁止输入英文字符<>"'
      var str = $(this).val();
      if (_._trim(str) == "")
        return;
      if (/[<>"']/g.test(str)) {
        $(this).val(str.substr(0, str.length - 1));
      }
    });
  },
  _getValue: function() {
    var _value = "1";
    for (var i = 2; i < 31; i++) {
      if ((i < 7 || i == 30) && _partyJoinItem._selected(i)) {
        _value += "," + i;
      }
    }
    return _value;
  },
  _delNewItem: function(index) {
    var _value = _postTemp._get(_partyJoinItem._joinValueKey);
    var _valueArr = _value.substring(0, _value.length - 1).split("\^");
    var _arrIndex = index - 1;
    _value = "";
    for (var i = 0, len = _valueArr.length; i < len; i++) {
      if (i != _arrIndex) {
        _value += _valueArr[i] + "^";
      }
    }
    _postTemp._set(_partyJoinItem._joinValueKey, _value);
    $("#li_post_join_item_new_" + index).remove();
    $("li[id^='li_post_join_item_new_']").each(function(i) {
      $(this).attr("id", "li_post_join_item_new_" + (i + 1));
      $("#" + $(this).attr("id") + " img").unbind("click");
      $("#" + $(this).attr("id") + " img").attr("onclick", "").click(
        eval(function() {
          _partyJoinItem._delNewItem(i + 1);
        })
      );
      $(this).unbind("click");
      $(this).bind("click", function() {
        var _index = $(this).attr("id").match(/\d+/g);
        _partyJoinItem._clickNew(_partyJoinItem._id + "_join_property_value", _index);
      });
      $("#" + $(this).attr("id") + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    });

    $("#post_join_item_add").show();
    _hdbDragge._setValue();
  },
  _tempValue: function(key, value, index, sel) {
    var _value = _postTemp._get(key);
    if (_value != "") {
      var _valueArr = _value.substring(0, _value.length - 1).split("\^");
      var _arrIndex = index - 1;
      _value = "";
      var _insert = true;
      for (var i = 0, len = _valueArr.length; i < len; i++) {
        if (i == _arrIndex) {
          if (value != "") {
            _value += value + "#" + sel + "^";
          }
          _insert = false;
        } else {
          _value += _valueArr[i] + "^";
        }
      }
      if (_insert) {
        _value += value + "#" + sel + "^";
      }
    } else {
      if (value != "") {
        _value = value + "#" + sel + "^";
      }
    }
    _postTemp._set(key, _value);
    _hdbDragge._setValue();
  },
  _selected: function(item) {
    var _itme_class = $("#post_" + _partyJoinItem._id + "_join_item_" + item).attr("class");
    if (_itme_class != undefined) {
      return _itme_class.indexOf("_static") != -1;
    } else {
      return false;
    }
  },
  _getNewValue: function() {
    var _newValue = "";
    $("li[id^='li_post_join_item_new_']").each(function() {
      if ($(this).attr("class").indexOf("or") > -1) {
        _newValue += $(this).text() + "^";
      }
    });
    return _newValue;
  },
  _setNewValue: function(key, value, index) {

    if (value == "") {
      $("#post_itemAdd_p").show();
      $("#li_post_join_item_new_" + index).remove();
      $("#post_queR_p").remove();
      $(".post_item_7").width(78);
      return;
    } else {

      value = $.trim(value);
      //判断值是否重复
      var _joinInfoObjs = $("#post_form_join_items").find("li").find("div.xuanX");
      var flag = false;
      if (null != _joinInfoObjs && _joinInfoObjs != undefined) {
        _joinInfoObjs.each(function(index, element) {
          var _joinZhi = $(this).text();
          if (value == _joinZhi) {
            flag = true;
            return false;
          }
        });
      }
      var _joinInfoAddObjs = $("#post_form_join_items").find("li").find("p");
      if (null != _joinInfoAddObjs && _joinInfoAddObjs != undefined) {
        _joinInfoAddObjs.each(function(index, element) {
          var _joinZhi = $(this).text();
          if (_joinZhi != "+添加" && value == _joinZhi) {
            flag = true;
            return false;
          }
        });
      }
      if (flag) {
        _toast._show("不能填写重复的报名信息！");
        return;
      }
      $("#post_itemAdd_p").show();
      $("#post_queR_p").remove();
      $(".post_item_7").width(78);
      $("#li_post_join_item_new_" + index).attr("class", "join_item_no post_item_7 or");
      $("#li_post_join_item_new_" + index).html("<p>" + value + "</p><img src=\"" + _imgCdn + "/static_v4/images/post/post_join_item_7@2x.png\" " + " onclick=\"_partyJoinItem._delNewItem(" + index + ")\">");
      _partyJoinItem._newItemClick(index);
      $("#li_post_join_item_new_" + index + " img").bind("click", function(event) {
        event.stopPropagation();
      });
    }
    _partyJoinItem._tempValue(key, value, index, 1);
    if (index == 10) {
      $("#post_join_item_add").hide();
    }
  }
};

var _addFill = {
  _id: "",
  _sort: '2',
  _num: function() {
    var m = $(".joinxx_px_list li").length;
    if (m < 17) {
      return true;
    }
  },
  _init: function(flag) {
    $(".wek_gray").focus(function() {
      $(this).addClass("thisOver");
      $(".xuan_Li_P").attr("class", "xuan_Li_P");
      $(".joinxx_px_item").removeClass("thisOver");
      $(this).parent().parent().parent().parent().parent().addClass("thisOver");
      $(".xuan_Li_P_A").css("display", "none");
    });
    $(".wek_gray").blur(function() {
      $(".wek_gray").removeClass("thisOver");
      $(this).parent().parent().parent().parent().parent().removeClass("thisOver");
    });
    $(".xuan_Li_P").click(function() {
      $(".xuan_Li_P").removeClass("thisOver");
      $(".joinxx_px_item").removeClass("thisOver");
      $(this).addClass("thisOver");
      $(this).parent().parent().parent().parent().parent().addClass("thisOver");
      $(".xuan_Li_P_A").css("display", "none");
      if ($(this).parent().children("p").length > 2) {
        $(this).children(".xuan_Li_P_A").css("display", "block");
      }
    });
    $(".xuan_Li").each(function() {
      var n = $(this).children(".xuan_Li_P").length;
      if (n == 10) {
        $(this).parent().children(".addBtn").hide();
      }
    });
    var joinMaxCount = $("#joinxx_px_sort_" + _post._tempId).val();
    if (flag) {
      if (joinMaxCount != "") {
        _addFill._sort = joinMaxCount;
      } else {
        _t._set('joinxx_px_sort_' + _post._tempId, 2);
      }
    }
    _addFill._blue();
  },
  _danH: function(busid, sortid) { //添加单行文本
    if (_addFill._num()) {
      var cursort = 1,
        showsort = "";
      if (sortid != undefined && sortid != "") {
        cursort = sortid;
        showsort = cursort;
      } else {
    	_addFill._sort = $("#join_ol li").length;
        _addFill._sort = parseInt(_addFill._sort) + 1;
        cursort = _addFill._sort;
      }
      if (busid == undefined) {
        busid = "";
      }
      _t._set('joinxx_px_sort_' + _post._tempId, cursort);
      var _html = '<li class="joinxx_px_item danH" id="' + _post._tempId + 'pary_sort_' + cursort + '" businessid="' + busid + '" dataType="text" sortid="' + ($("#join_ol li").length+1) + '">'
      	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span>'
  		+ '<div class="bdNr"><div class="xuanTit"><input name="" type="text" placeholder="单行文本标题" class="wek_gray" dataTitle="" maxlength="20" onchange="_setJoinobj._init()"/></div></div><div class="tsIe" >单行文本标题</div></div>'
		+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="删除"></a></div></div></li>';
      $(".joinxx_px_list").append(_html);
      _addFill._init();
    } else {
      _toast._show("最多可添加15个自定义填写项");
    }
  },
  _duoH: function(busid, sortid) { //添加多行文本
    if (_addFill._num()) {
      var cursort = 1,
        showsort = "";
      if (sortid != undefined && sortid != "") {
        cursort = sortid;
        showsort = cursort;
      } else {
    	_addFill._sort = $("#join_ol li").length;
        _addFill._sort = parseInt(_addFill._sort) + 1;
        cursort = _addFill._sort;
      }
      if (busid == undefined) {
        busid = "";
      }
      _t._set('joinxx_px_sort_' + _post._tempId, cursort);
      var _html = '<li class="joinxx_px_item duoH" id="' + _post._tempId + 'pary_sort_' + cursort + '" businessid="' + busid + '" dataType="text_long" sortid="' + ($("#join_ol li").length+1) + '">'
		+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span>'
		+ '<div class="bdNr"><div class="xuanTit"><input name="" type="text" placeholder="这是一个多行文本框" class="wek_gray" dataTitle=""  maxlength="20" onchange="_setJoinobj._init()"/></div></div><div class="tsIe" >这是一个多行文本框</div></div>'
		+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="删除"></a></div></div></li>';
      $(".joinxx_px_list").append(_html);
      _addFill._init();
    } else {
      _toast._show("最多可添加15个自定义填写项");
    }
  },
  _danX: function(busid, sortid) { //添加单选问题
    if (_addFill._num()) {
      var cursort = 1,
        showsort = "";
      if (sortid != undefined && sortid != "") {
        cursort = sortid;
        showsort = cursort;
      } else {
    	_addFill._sort = $("#join_ol li").length;
        _addFill._sort = parseInt(_addFill._sort) + 1;
        cursort = _addFill._sort;
      }
      if (busid == undefined) {
        busid = "";
      }
      _t._set('joinxx_px_sort_' + _post._tempId, cursort);
      var _html = '<li class="joinxx_px_item danX" id="' + _post._tempId + 'pary_sort_' + cursort + '" businessid="' + busid + '" dataType="single_vote" sortid="' + ($("#join_ol li").length+1) + '">'
		+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span>'
		+ '<div class="bdNr"><div class="xuanTit"><input name="" type="text" placeholder="这是一个单选问题" class="wek_gray" dataTitle=""  maxlength="30" onchange="_setJoinobj._init()"/></div>'
		+ '<div class="xuan_Li"><p class="xuan_Li_P"><span>选项1</span><input id="pary_sort_' + cursort + '_dan_1" name="" type="text" placeholder="这是一个单选问题" class="wek_gray2" maxlength="50" onchange="_setJoinobj._init()"/>'
		+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'pary_sort_' + cursort + '_dan_1\')"><img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>'
		+ '<p class="xuan_Li_P"><span>选项2</span><input id="pary_sort_' + cursort + '_dan_2" name="" type="text" placeholder="这是一个单选问题" class="wek_gray2" maxlength="50" onchange="_setJoinobj._init()"/>'
		+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'pary_sort_' + cursort + '_dan_2\')"><img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p></div>'
		+ '<div class="addBtn"><a href="javascript:void(0)" onclick="_addFill._addXxdan(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="添加选项"></a></div></div><div class="tsIe">这是一个单选问题</div></div>'
		+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="删除"></a></div></div></li>';
      $(".joinxx_px_list").append(_html);
      _addFill._init();
    } else {
      _toast._show("最多可添加15个自定义填写项");
    }
  },
  _duoX: function(busid, sortid) { //添加多选问题
    if (_addFill._num()) {
      var cursort = 1,
        showsort = "";
      if (sortid != undefined && sortid != "") {
        cursort = sortid;
        showsort = cursort;
      } else {
    	_addFill._sort = $("#join_ol li").length;
        _addFill._sort = parseInt(_addFill._sort) + 1;
        cursort = _addFill._sort;
      }
      if (busid == undefined) {
        busid = "";
      }
      _t._set('joinxx_px_sort_' + _post._tempId, cursort);
      var _html = '<li class="joinxx_px_item duoX" id="' + _post._tempId + 'pary_sort_' + cursort + '" businessid="' + busid + '" dataType="multi_vote" sortid="' + ($("#join_ol li").length+1) + '">'
		+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span>'
		+ '<div class="bdNr"><div class="xuanTit"><input name="" type="text" placeholder="这是一个多选问题" class="wek_gray" dataTitle="" maxlength="30" onchange="_setJoinobj._init()"/></div>'
		+ '<div class="xuan_Li"><p class="xuan_Li_P"><span>选项1</span>'
		+ '<input id="pary_sort_' + cursort + '_duo_1" name="" type="text" placeholder="这是一个多选问题" class="wek_gray2" maxlength="50" onchange="_setJoinobj._init()"/>'
		+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'pary_sort_' + cursort + '_duo_1\')">'
		+ '<img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>'
		+ '<p class="xuan_Li_P"><span>选项2</span><input id="pary_sort_' + cursort + '_duo_2" name="" type="text" placeholder="这是一个多选问题" class="wek_gray2" maxlength="50" onchange="_setJoinobj._init()"/>'
		+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'pary_sort_' + cursort + '_duo_2\')"http://img1.hudongba.com{img1_url!}/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p></div>'
		+ '<div class="addBtn"><a href="javascript:void(0)" onclick="_addFill._addXxduo(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="添加选项"></a></div></div><div class="tsIe">这是一个多选问题</div></div>'
		+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="删除"></a></div></div></li>';
      $(".joinxx_px_list").append(_html);
      _addFill._init();
    } else {
      _toast._show("最多可添加15个自定义填写项");
    }
  },
  _pic: function(busid, sortid) { //添加图片
    if (_addFill._num()) {
      var cursort = 1,
        showsort = "";
      if (sortid != undefined && sortid != "") {
        cursort = sortid;
        showsort = cursort;
      } else {
    	_addFill._sort = $("#join_ol li").length;
        _addFill._sort = parseInt(_addFill._sort) + 1;
        cursort = _addFill._sort;
      }
      if (busid == undefined) {
        busid = "";
      }
      _t._set('joinxx_px_sort_' + _post._tempId, cursort);
      var _html = '<li class="joinxx_px_item pic" id="' + _post._tempId + 'pary_sort_' + cursort + '" businessid="' + busid + '" dataType="image" sortid="' + ($("#join_ol li").length+1) + '">'
+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span>'
+ '<div class="bdNr"><div class="xuanTit"><input name="" type="text" placeholder="图片标题" class="wek_gray" dataTitle="" maxlength="20"/></div></div><div class="tsIe">图片标题</div></div>'
+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _post._tempId + 'pary_sort_' + cursort + '\')" title="删除"></a></div></div></li>';
      $(".joinxx_px_list").append(_html);
      _addFill._init();
    } else {
      _toast._show("最多可添加15个自定义填写项");
    }
  },
  _del: function(id) { //删除自定义填写项
    _addFill._id = id;
    $("#" + _addFill._id).remove();
    _addFill._init();
    _setJoinobj._init();
    _addFill._setId();
  },
  _addXxdan: function(id) { //增加一条单选问题选项
    _addFill._id = id;
    var m = $("#" + _addFill._id).find(".xuan_Li_P").length;
    if(m>9){return false;}
    _html = '<p class="xuan_Li_P"><span>选项' + (m + 1) + '</span>'
    	+ '<input id="' + _addFill._id + '_dan_' + (m + 1) + '" name="" type="text" placeholder="这是一个单选问题" class="wek_gray2" onchange="_setJoinobj._init()" />'
    	+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'' + _addFill._id + '_dan_' + (m + 1) + '\')">'
    	+ '<img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>';
    if (m == 9) {
      $("#" + _addFill._id).find(".xuan_Li").append(_html);
      $("#" + _addFill._id).find(".addBtn").hide();
    } else {
      $("#" + _addFill._id).find(".xuan_Li").append(_html);
    }
    $(".xuan_Li_P").attr("class", "xuan_Li_P");
    _addFill._init();
    $("#" + _addFill._id).find("p:last-child").children(".wek_gray2").click().focus();
  },
  _addXxduo: function(id) { //增加一条多选问题选项
    _addFill._id = id;
    var m = $("#" + _addFill._id).find(".xuan_Li_P").length;
    if(m>9){return false;}
    _html = '<p class="xuan_Li_P"><span>选项' + (m + 1) + '</span>'
	    + '<input id="' + _addFill._id + '_duo_' + (m + 1) + '" name="" type="text" placeholder="这是一个多选问题" class="wek_gray2" onchange="_setJoinobj._init()" />'
	    + '<a href="javascript:void(0)" class="xuan_Li_P_A"  onclick="_addFill._delxuanLi(\'' + _addFill._id + '_duo_' + (m + 1) + '\')">'
	    + '<img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>';
    if (m == 9) {
      $("#" + _addFill._id).find(".xuan_Li").append(_html);
      $("#" + _addFill._id).find(".addBtn").hide();
    } else {
      $("#" + _addFill._id).find(".xuan_Li").append(_html);
    }
    $(".xuan_Li_P").attr("class", "xuan_Li_P");
    _addFill._init();
    $("#" + _addFill._id).find("p:last-child").children(".wek_gray2").click().focus();
  },
  _delxuanLi: function(id) { //删除问题选项
    _addFill._id = id;
    var a = _addFill._id;
    var b = "";
    var c = "";
    for (i = 0; i < a.length; i++) {
      b = a.substring(i, i + 1);
      if (b == 'd') {
        c = i * 1 - 1;
      }
    }
    var pid = a.substring(0, c);
    var pcl = $("#" + pid).find(".xuan_Li");
    if (pid.indexOf("dan") != -1) {
      var clan = '_dan_';
    } else {
      var clan = '_duo_';
    }
    $("#" + _addFill._id).parent().remove();
    pcl.children("p").each(function() {
      $(this).children("span").html("选项" + ($(this).index() + 1));
      $(this).children("input").attr("id", pid + clan + ($(this).index() + 1));
      $(this).children("a").remove();
      $(this).append('<a href="javascript:void(0)" class="xuan_Li_P_A"  onclick="_addFill._delxuanLi(\'' + pid + clan + ($(this).index() + 1) + '\')"><img src="http://cdn.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a>');
    });
    if (pcl.children("p").length == 2) {
      pcl.children("p").children(".xuan_Li_P_A").css("display", "none");
    }
    $(".addBtn").show();
    _addFill._init();
    _setJoinobj._init();
    clickBtn2(event);
  },
  _setId:function(){
	$("#joinxx_px li").each(function(){
	  $(this).attr({'id':_post._tempId + 'pary_sort_' + ($(this).index()+1),'sortid':$(this).index()+1});
	  if($(this).attr("class").indexOf('phone')=="-1" && $(this).attr("class").indexOf('name')=="-1"){
		$(this).find(".czQu").html('<a href="javascript:void(0)" class="del" title="删除" onclick="_addFill._del(\''+_post._tempId + 'pary_sort_' + ($(this).index()+1)+'\')"></a>');
	  }
	  if($(this).attr("class").indexOf('danX')!="-1"){
		var _cid = _post._tempId + 'pary_sort_' + ($(this).index()+1);
		for(i=0;i<$(this).find(".xuan_Li_P").length;i++){
		  $(this).find(".xuan_Li_P").eq(i).children(".wek_gray2").attr('id',_cid+'_dan_'+(i+1));
		  $(this).find(".xuan_Li_P").eq(i).children(".xuan_Li_P_A").attr('onclick','_addFill._delxuanLi(\''+_cid+'_dan_'+(i+1)+'\')');
		}
	  }
	  if($(this).attr("class").indexOf('duoX')!="-1"){
		var _cid = _post._tempId + 'pary_sort_' + ($(this).index()+1);
		for(i=0;i<$(this).find(".xuan_Li_P").length;i++){
		  $(this).find(".xuan_Li_P").eq(i).children(".wek_gray2").attr('id',_cid+'_duo_'+(i+1));
		  $(this).find(".xuan_Li_P").eq(i).children(".xuan_Li_P_A").attr('onclick','_addFill._delxuanLi(\''+_cid+'_duo_'+(i+1)+'\')');
		}
	  }
	});
  },
  _blue:function(){
      $(".wek_gray").focus(function(){
    	  $(this).addClass("blue");
      }).blur(function(){
    	  $(this).removeClass("blue");
      });
      $(".wek_gray2").focus(function(){
    	  $(".xuan_Li_P").removeClass("blue");
    	  $(".xuan_Li_P").removeClass("thisOver");
    	  $(this).parent().addClass("blue thisOver");
    	  $(this).parent().parent().parent().parent().parent().parent().addClass("thisOver");
          $(".xuan_Li_P_A").css("display", "none");
          if ($(this).parent().parent().children("p").length > 2) {
            $(this).parent().children(".xuan_Li_P_A").css("display", "block");
          }
      }).blur(function(){
    	  $(".xuan_Li_P").removeClass("blue");
    	  $(".xuan_Li_P").removeClass("thisOver");
    	  $(".xuan_Li_P_A").css("display", "none");
      });
  }
};

function areaFetch(obj) {
  _tabid = $(obj).attr("tabId");
  _qu = $(obj).children("a").html();
  $(".k_site_K_qu").hide();
  //缓存选择的城市
  var showname = "";
  if (_tabid == _qu) {
    showname = _tabid;
  } else {
    showname = _tabid + " " + _qu;
  }
  //_t._set("post_party_place_city_" + _post._tempId, showname);
  _t._set("post_party_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id, showname);
  $(".post_siTe").val(showname);
  _placeSearch._init();
  setTimeout(function() {
    $(".k_site_K").hide();
    $(".post_siTe").removeClass("jiao");
    $("#qK4").css("display", "block");
    $(".k_site").removeClass("blue");
  }, 200);

    //检查当前城市是否支持会务支持
    checkIsPartySupport();
    _checkRed._partyAddress();
    
    if($(".post_siTe").val()=="线上活动"){
    	$(".post_siTe2").attr({"readonly":true,"placeholder":"这是一个线上活动"}).val("");
    	_placeSearch._up();
    	$("#mapMark").hide();
    }else{
    	$(".post_siTe2").attr({"readonly":false,"placeholder":"活动地址"});
    }
    
}

function isFetchJoinOpt(obj) {
  //$(obj).toggleClass("thisOver");

  var _phoneId = "post_party_phone_" + _post._tempId;
  if ($(obj).attr("class").indexOf("thisOver") > 0) {
    $(obj).removeClass("thisOver");
    //$("#" + _phoneId).removeAttr("checked");
    $("#" + _phoneId).attr("disabled", "disabled");

  } else {
    $(obj).addClass("thisOver");
    //$("#" + _phoneId).attr("checked", "checked");
    $("#" + _phoneId).removeAttr("disabled");
  }
}

function clickBtn(event) {
  event = event ? event : window.event;
  event.cancelBubble = true;
  $(".k_site_K").show();
  $(".k_site").addClass("blue");
  $(".k_site_K3,.k_site_K7,.date_selector").hide();
  $(".k_style,.post_style_K,.k_time_date").removeClass("blue");
  $("#sDateYMD,#eDateYMD,#endtimeYMD,#vote_end_ymd").parent().children(".date_selector").remove();
  $('.post_tiMe1,.post_tiMe2,.post_tiMe3').date_input();
}

function clickBtn2(event) {
  event = event ? event : window.event;
  event.cancelBubble = true;
  $(".k_site_K").hide();
  $(".k_site").removeClass("blue");
}

function clickBtn3(event) {
  event = event ? event : window.event;
  event.cancelBubble = true;
  $(".k_site_K3").show();
  $(".k_site_K,.k_site_K7,.date_selector").hide();
  $(".k_style").addClass("blue");
  $(".post_siTe,.post_style_K,.k_time_date").removeClass("blue");
  $(document).click(function() {
    $(".k_site_K3,.k_site_K7").hide();
    $(".k_style,.post_style_K").removeClass("blue");
  });
  $("#sDateYMD,#eDateYMD,#endtimeYMD,#vote_end_ymd").parent().children(".date_selector").remove();
  $('.post_tiMe1,.post_tiMe2,.post_tiMe3').date_input();
}

function clickBtn4(event) {
  $(".k_style input,.post_style_K input").val('').attr("category_id","");;
  $(".k_site_K3,#qK6,#qK7").hide();
  $(".k_style input,.post_style_K input").attr("class","jiao");
  $("#post_main_r_K_hdstyle").attr("class","red_outK");
  _t._set("post_" + _post._type + "_bigCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
  _t._set("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
  _t._set("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
  _t._set("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
}

function clickBtn5(event) {
  event = event ? event : window.event;
  event.cancelBubble = true;
  $(".k_site_K3").hide();
}

function clickBtn6(event) {
	if($(".k_style input").attr("category_id")!=""){
		event = event ? event : window.event;
		event.cancelBubble = true;
		$("#k_site_K7").show();
		$("#child_category_" + $(".k_style input").attr("category_id")).show();
		$(".post_style_K").addClass("blue");
		$(".k_site_K,.k_site_K3,.date_selector").hide();
		$(".k_style,.post_siTe,.k_time_date").removeClass("blue");
		$(document).click(function() {
		  $(".k_site_K3,.k_site_K7").hide();
		  $(".k_style,.post_style_K").removeClass("blue");
		});
		$("#sDateYMD,#eDateYMD,#endtimeYMD,#vote_end_ymd").parent().children(".date_selector").remove();
	    $('.post_tiMe1,.post_tiMe2,.post_tiMe3').date_input();
	}
}

function clickBtn7(event) {
  $(".post_style_K input").val('').attr("category_id","");
  $(".k_site_K7,#qK7").hide();
  $(".post_style_K input").attr("class","jiao");
  _t._set("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
  _t._set("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
}

var _placeSearch = {
  _txt: "",
  _h: "",
  _init: function() {
    _placeSearch._txt = $(".post_siTe2").val();
    _placeSearch._h = $(".hdAddress").height();
    if (_placeSearch._txt && _placeSearch._h == 68) {
      _placeSearch._down();
    } else if (_placeSearch._txt && _placeSearch._h != 68) {
      _placeSearch._search();
    } else if (_placeSearch._txt == "" && _placeSearch._h == 600) {
      _placeSearch._up();
    }
    if (_placeSearch._txt) {
      $("#mapMark").show();
    } else {
      $("#mapMark").hide();
    }
  },
  _up: function() {
    $(".hdAddress").animate({
      "height": 68 + "px"
    }, 500);
    $(".post_site_set").animate({
      "height": 1 + "px"
    }, 500, function() {
      $(".post_site_set").hide();
    });
  },
  _down: function() {
    $(".hdAddress").animate({
      "height": 600 + "px"
    }, 500, function() {
      _placeSearch._h = 600;
    });
    $(".post_site_set").show().animate({
      "height": 512 + "px"
    }, 500, function() {
      _placeSearch._h = 600;
    });
    _placeSearch._search();
  },
  _search: function() {
    var MSearch;
    AMap.service(["AMap.PlaceSearch"], function() {
      MSearch = new AMap.PlaceSearch({ //构造地点查询类
        pageSize: 10,
        pageIndex: 1
          //city: "北京" //城市
      });
      //关键字查询
      var address = $(".post_siTe").val() + $(".post_site_K").find("input").val();
      MSearch.search(address, function(status, result) {
        if (status === 'complete' && result.info === 'OK') {
          _gaode._keywordSearch_CallBack(result, address);
        }
      });
    });
  },
  _mark: function() {
    _placeSearch._h = $(".hdAddress").height();
    if (_placeSearch._txt && _placeSearch._h == 68) {
      _placeSearch._down();
    } else if (_placeSearch._txt && _placeSearch._h != 68) {
      _placeSearch._up();
    }
  }
};
var _gaode = {
  _map: "",
  _lnglatXY: "",
  _init: function() {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "http://webapi.amap.com/maps?v=1.3&key=dcb1fc135d3e1940d7d2105a97201d89&callback=initMap";
    document.body.appendChild(script);
  },
  _findCenter: function() { //定位到地图大头针
    _gaode._map.setCenter(_gaode._lnglatXY);
    _gaode._map.setFitView();
  },
  _addmarker: function(lnglatXY) { //地图打点
    var maker;
    $("#lngX").val(lnglatXY.getLng());
    $("#latY").val(lnglatXY.getLat());
    marker = new AMap.Marker({
      draggable: true, //点标记可拖拽
      cursor: 'move', //鼠标悬停点标记时的鼠标样式
      //raiseOnDrag:true,//鼠标拖拽点标记时开启点标记离开地图的效果
      icon: "http://webapi.amap.com/images/marker_sprite.png",
      position: lnglatXY
    });
    //设置地图中心点为标记点
    //map.setZoomAndCenter(13, lnglatXY);//将地图缩放到指定级别并设置中心点为指定坐标
    _gaode._map.setCenter(lnglatXY);
    _gaode._map.clearMap(); //清除地图的其他覆盖物
    marker.setMap(_gaode._map); //在地图上添加点
    AMap.event.addListener(marker, "dragend", function() { //拖拽标记点完成是出发记录位置
      _gaode._lnglatXY = marker.getPosition();
      $("#lngX").val(_gaode._lnglatXY.getLng());
      $("#latY").val(_gaode._lnglatXY.getLat());
      //map.setZoomAndCenter(15, lnglatXY);//将地图缩放到指定级别并设置中心点为指定坐标
      _gaode._map.setCenter(_gaode._lnglatXY);
    });
  },
  _geocoderFan: function(address) { //根据地址信息反射成经纬度
    var MGeocoder;
    //加载地理编码插件
    AMap.service(["AMap.Geocoder"], function() {
      MGeocoder = new AMap.Geocoder({
        city: "", //城市，默认：“全国”
        radius: 1000 //范围，默认：500
      });
      //返回地理编码结果
      //地理编码
      MGeocoder.getLocation(address, function(status, result) {
        if (status === 'complete' && result.info === 'OK') {
          var geocode = result.geocodes;
          if (geocode.length >= 1) {
            _gaode._lnglatXY = geocode[0].location;
            _gaode._addmarker(_gaode._lnglatXY);
          }
        }
      });
    });
  },
  _choiceCity: function(cityName) { //根据城市选择地图
    var MGeocoder;
    //加载地理编码插件
    AMap.service(["AMap.Geocoder"], function() {
      MGeocoder = new AMap.Geocoder({
        //city:cityName, //城市
        radius: 1000 //范围，默认：500
      });
      //返回地理编码结果
      //地理编码
      MGeocoder.getLocation(cityName, function(status, result) {
        if (status === 'complete' && result.info === 'OK') {
          _gaode._lnglatXY = result.geocodes[0].location;
          _gaode._addmarker(_gaode._lnglatXY);
        }
      });
    });
  },
  _keywordSearch_CallBack: function(data, address) {
    var poiArr = data.poiList.pois;
    var resultCount = poiArr.length;
    if (resultCount >= 1) {
      _gaode._lnglatXY = poiArr[0].location;
      _gaode._map.setZoom(14);
      _gaode._addmarker(_gaode._lnglatXY);
    }
  }
};

function initMap() {
  _gaode._map = new AMap.Map("mapContainer", {
    keyboardEnable: false, //键盘不能缩放
    doubleClickZoom: false,
    resizeEnable: true,
    zooms: [3, 18], //缩放级别限制
    zoom: 14 //地图显示的缩放级别
  });
  //为地图注册加载完成事件获取经纬度加载地图
  var clickEventListener = AMap.event.addListener(_gaode._map, 'complete', function(e) {
    /*************清除高德地图的logo和版本号*******************/
    $(".amap-logo").hide();
    $(".amap-copyright").hide();
    var lngX = _post._lng;
    var latY = _post._lat;
    if (lngX != null && latY != null && lngX != "" && latY != "") { //如果经纬度不为空则定位
      _gaode._lnglatXY = new AMap.LngLat(lngX, latY);
      _gaode._map.setCenter(_gaode._lnglatXY); //将地图的中心设置为定位的点
      _gaode._addmarker(_gaode._lnglatXY); //增加地图标记点
    } else {
      var address = $(".post_site_K").find("input").val();
      _gaode._geocoderFan(address);
    }
  });
  //为地图注册dblclick事件获取鼠标点击出的经纬度坐标
  var clickEventListener = AMap.event.addListener(_gaode._map, 'click', function(e) {
    _gaode._lnglatXY = e.lnglat; //初始化经纬度坐标类
    _gaode._map.setZoomAndCenter(15, _gaode._lnglatXY); //将地图缩放到指定级别并设置中心点为指定坐标
    _gaode._addmarker(_gaode._lnglatXY); //增加地图标记点
  });
}

var _modifyRecords = {
	_party:function(){
		var _detailAddr = $("#post_party_place_site_"+ _post._tempId).val(),
			_detailCity = $("#post_party_place_city_"+ _post._tempId).val(),
			_startymd = $("#sDateYMD").val(),
			_starthm = $("#sDateHM").val(),
			_overymd = $("#eDateYMD").val(),
			_overhm = $("#eDateHM").val(),
			_endymd = $("#endtimeYMD").val(),
			_endhm = $("#endtimeHM").val(),
			_addressSummary = _detailAddr + _detailCity,
			_timeSummary = _startymd + _starthm + _overymd + _overhm +_endymd + _endhm;
		_t._set("_addressSummary",_addressSummary);
		_t._set("_timeSummary",_timeSummary);
	},
	_vote:function(){
		var _voteYmd = $("#vote_end_ymd").val(),
			_voteHm = $("#vote_end_hm").val(),
			_timeSummary = _voteYmd + _voteHm;
		_t._set("_timeSummary",_timeSummary);
	}
};

function postJs() {
  //var y = $(window).height();
 // $("#post_form").css("min-height", y + "px");
  $(".textarea").width($("#post_form").width() - 20);
}

$(".k_time_date .qK").click(function() { //时间控件清空事件
  $(this).parent().children("input").val("");
  $(this).parent().next("div").children("input").val("");
  $(this).hide();
});
$("#qK4").click(function() {
  $(".k_site input").val("");
  $(this).hide();
  $(".k_site input").addClass("jiao");
  $("#k_site_K").css("display", "none");
  _t._set("post_party_place_site_" + _post._tempId, "");
  _t._set("post_party_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
  $(".post_siTe2").attr({"readonly":false,"placeholder":"活动地址"});
});
$(".sly_h a").click(function() {
  $(".sly_h a").removeClass("thisOver");
  $(this).addClass("thisOver");
});

$(".k_site input").click(function(e) {
  $(".k_site_K").show();
});
$(".k_site_K_top ul li").click(function() {
  $(this).addClass("thisOver").siblings().removeClass("thisOver");
  var it = $(this).index();
  $("#K_city_style" + it).show().siblings().hide();
});

/*发布活动PC*************************************************/
var _partyPostPC = {
  _id: "",
  _isprev: "",
  _ifTitle: false,//活动标题验证
  _ifTime1: false,//活动时间验证1
  _ifTime2: false,//活动时间验证2
  _ifAddress: false,//活动地点验证
  _ifrichText: false,//活动详情验证
  _ifpleLimit: false,
  _ifStyle: false,
  _ifContactTel: false,//主办方联系方式验证
  _winOpen: null,
  _title: "",
  _content: "",
  _joinItems: "",
  _joinValues: "",
  _payName: "",
  _payPrice: "",
  _payItemArr: "",
  _endtime: "",
  _startdate: "",
  _overdate: "",
  _isRecomm: "",
  _phone: "",
  _perlim: "",
  _joinOrde: "",
  _getTempId: "",
  _detailAddr: "",
  _locarea: "",
  sceneId: "",
  _joinOptions: "",
  _payItemInfo: "",
  _latx: "",
  _laty: "",
  _bigCategoryId: "",
  _smallCategoryId: "",
  _needPartySupport: "",
  _partySupportMobile: "",
  _partyPosterImage:"",
  _partyContactMobile:"",
  //_partyContactTelephone:"",
  _postFront: function(id, isprev) {
	//$('#joinTime_control .time_txt').hide();
    var _detailAddr = $("#post_party_place_site_" + _post._tempId).val(),
      _detailCity = $("#post_party_place_city_" + _post._tempId).val(),
      _startymd = $("#sDateYMD").val(),
      _starthm = $("#sDateHM").val(),
      _overymd = $("#eDateYMD").val(),
      _overhm = $("#eDateHM").val(),
      _endymd = $("#endtimeYMD").val(),
      _endhm = $("#endtimeHM").val(),
      _addressSummaryEnd = _detailAddr + _detailCity,
      _addressSummary = _t._get("_addressSummary"),
      _timeSummary = _t._get("_timeSummary");
    if(_startymd!=""){
    	_startymd = _startymd.split('-');
        _startymd = _startymd[0] + '-' + (_startymd[1].length > 1 ? '' : '0') + _startymd[1] + '-' + (_startymd[2].length > 1 ? '' : '0') + _startymd[2];    
    };
    if (_overymd!="") {
    	_overymd = _overymd.split('-');
        _overymd = _overymd[0] + '-' + (_overymd[1].length > 1 ? '' : '0') + _overymd[1] + '-' + (_overymd[2].length > 1 ? '' : '0') + _overymd[2];
    
    };
    if (_endymd!="") {
    	_endymd = _endymd.split('-');
        _endymd = _endymd[0] + '-' + (_endymd[1].length > 1 ? '' : '0') + _endymd[1] + '-' + (_endymd[2].length > 1 ? '' : '0') + _endymd[2];
    };
    var _timeSummaryEnd = _startymd + _starthm + _overymd + _overhm + _endymd + _endhm;
    _partyPostPC._id = id;
    _partyPostPC._isprev = isprev;
    _t._set("login_Way", 5);
    if (!_user._login()) {
      _login4._show('tc_login', _partyPostPC._id, _partyPostPC._isprev);
      return;
    }
    if($(".time_txt").length==1){
    	$("body,html").animate({
            scrollTop: '90px'
        }, 300);
    	return;
    }
    var _getTempId = _post._tempId;
    var _title = _._trim($("#post_party_title_" + _getTempId).val()),
      _content = _richText._getValue(),
      _detailAddr = $("#post_party_place_site_" + _getTempId).val(),
      _detailCity = $("#post_party_place_city_" + _getTempId).val(),
      _singlePrice = $("#party_pay_item_price_" + _getTempId).val(),
      _startymd = $("#sDateYMD").val(),
      _starthm = $("#sDateHM").val(),
      _overymd = $("#eDateYMD").val(),
      _overhm = $("#eDateHM").val(),
      _endymd = $("#endtimeYMD").val(),
      _endhm = $("#endtimeHM").val(),
      _joinItems = _partyJoinItem._getValue(),
      _joinValues = _partyJoinItem._getNewValue(),
      _joinOrder = _hdbDragge._getValue(),
      _payItemArr = _payItem._getValue(),
      _bigCategoryId = $(".k_style input").attr("category_id"),
      _smallCategoryId = $(".post_style_K input").attr("category_id"),
      _needPartySupport = $("#meetInput").val(),
      _partySupportMobile = $("#post_party_meet_tel").val() || "",
      _partyPosterImage = $(".post_poster_pic").val(),//海报图片
      _partyContactMobile  = $("#post_party_postContact_" + _getTempId).val()//主办方联系方式-手机
      //_partyContactTelephone = $("#post_party_postContact2_" + _getTempId).val()//主办方联系方式-座机
    //当前城市不支持的话 默认取消会务支持选项
    if (!$("#partySupportLi").is(":visible")) {
      _needPartySupport = "1";
    }
    if (_t._get("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id) != "1") {
      _endymd = "";
      _endhm = "";
    }
    var _latx = $("#lngX").val();
    var _laty = $("#latY").val();
    var _isRecomm = $('input:radio[name="recommend"]:checked').val();
    var _isPay = $('input:radio[name="fee"]:checked').val();
    var sceneId = _post._sceneId;
    var _perlim = "";
    var partyThem = "";
    if (_getTempId == "103") {
      partyThem = "会议";
    } else if (_getTempId == "104") {
      partyThem = "聚会";
    } else {
      partyThem = "活动";
    }
    var _startdate = "",
      _overdate = "",
      _endtime = "",
      _locarea = "";
    if (_title == "") {
      $("#post_main_r_K_title").attr("class", "red_outK thisOver");
      $("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('请填写' + partyThem + '主题');
      _partyPostPC._ifTitle = false;
    } else if (_._len(_title) > 70) {
      $("#post_main_r_K_title").attr("class", "red_outK thisOver");
      $("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('主题请在35个字以内');
      _partyPostPC._ifTitle = false;
    } else {
      _partyPostPC._ifTitle = true;
    }

    if (_startymd == "") {
      $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
      $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动开始时间');
      _partyPostPC._ifTime1 = false;
    } else if (_overymd == "") {
      $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
      $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动结束时间');
      _partyPostPC._ifTime1 = false;
    } else if (_starthm == "") {
      $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
      $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动开始的具体时间');
      _partyPostPC._ifTime1 = false;
    } else if (_overhm == "") {
      $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
      $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动结束的具体时间');
      _partyPostPC._ifTime1 = false;
    } else {
      _startdate = _startymd + " " + _starthm;
      _overdate = _overymd + " " + _overhm;
      var startDateCache = _post._startDate;
  	  if(_post._info_is_starting == '1'?(new Date(_startdate.replace(/-/g, "/")).getTime() < new Date().getTime() && new Date(_startdate.replace(/-/g, "/")).getTime()!=new Date(startDateCache.replace(/-/g, "/").replace(/,/g, " ")).getTime()):(new Date(_startdate.replace(/-/g, "/")).getTime() < new Date().getTime())) { 	
        $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('活动开始时间应大于当前时间');
        _partyPostPC._ifTime1 = false;
      } else if (new Date(_overdate.replace(/-/g, "/")).getTime() < new Date(_startdate.replace(/-/g, "/")).getTime()) {
        $("#post_main_r_K_partyTime1").attr("class", "red_outK thisOver");
        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('活动结束时间应大于活动开始时间');
        _partyPostPC._ifTime1 = false;
      } else {
        _partyPostPC._ifTime1 = true;
      }
    }

    if (_endymd == "") {
      _partyPostPC._ifTime2 = true;
    } else {
      if (_endhm == "") {
        $("#post_main_r_K_partyTime2").attr("class", "red_outK thisOver");
        $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('请设置报名截止的具体时间');
        _partyPostPC._ifTime2 = false;
      } else {
        _startdate = _startymd + " " + _starthm;
        _overdate = _overymd + " " + _overhm;
        _endtime = _endymd + " " + _endhm;
        if (new Date(_endtime.replace(/-/g, "/")).getTime() < new Date().getTime()) {
          $("#post_main_r_K_partyTime2").attr("class", "red_outK thisOver");
          $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('报名截止时间应大于当前时间');
          _partyPostPC._ifTime2 = false;
        } else if (new Date(_overdate.replace(/-/g, "/")).getTime() < new Date(_endtime.replace(/-/g, "/")).getTime()) {
          $("#post_main_r_K_partyTime2").attr("class", "red_outK thisOver");
          $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('报名截止时间应小于活动结束时间');
          _partyPostPC._ifTime2 = false;
        } else {
          _partyPostPC._ifTime2 = true;
        }
      }
    }

    if ($(".post_siTe").val() == "") {
      $("#post_main_r_K_address").attr("class", "red_outK thisOver");
      $("#post_main_r_K_address").find(".post_main_note").children("p").children("span").html('请设置活动举办的地点');
      _placeSearch._up();
      _partyPostPC._ifAddress = false;
    } else if ($(".post_siTe2").val() == "" && $(".post_siTe").val() != "线上活动") {
      $("#post_main_r_K_address").attr("class", "red_outK thisOver");
      $("#post_main_r_K_address").find(".post_main_note").children("p").children("span").html('请补充活动的具体位置');
      _partyPostPC._ifAddress = false;
    } else {
      _partyPostPC._ifAddress = true;
    }
    
    _partyPostPC._ifContactTel = true;
    
    if(_partyContactMobile != ""){
    	if(!_partyContactMobile.match(/^[0-9+-]{0,20}$/)){
    		$("#post_main_r_K_contactTel").attr("class", "red_outK thisOver");
    	    $("#post_main_r_K_contactTel").find(".post_main_note").children("p").children("span").html('号码格式不正确');
    	    _partyPostPC._ifContactTel = false;
    	}else{
    		_partyPostPC._ifContactTel = true;
    	}
    }else{
    	_partyPostPC._ifContactTel = true;
    }
    if (_richText._isEmpty()) {
      $("#post_main_r_K_richtext").attr("class", "red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('请输入活动详情');
      _partyPostPC._ifrichText = false;
      //_richText._onBlur();
    } else {
      var _len = _._len(_HdbToolbar._text);
      if (!_HdbToolbar._img && _len < 10) {
        //_toast._show(partyThem + "详情写得太少了");
        $("#post_main_r_K_richtext").attr("class", "red_outK thisOver");
        $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('详情写得太少了');
        _partyPostPC._ifrichText = false;
      } else if (!_HdbToolbar._img && _len > 20000) {
        //_toast._show(partyThem + "详情写得有点多了");
        $("#post_main_r_K_richtext").attr("class", "red_outK thisOver");
        $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('详情写得有点多了');
        _partyPostPC._ifrichText = false;
      } else if (_richText._maxPic()) {
        //_toast._show("图片太多了，最多只能上传30张图片");
        $("#post_main_r_K_richtext").attr("class", "red_outK thisOver");
        $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('图片太多了，最多只能上传30张图片');
        _partyPostPC._ifrichText = false;
      } else {
        _partyPostPC._ifrichText = true;
      }
    }
    var _phone = "0";
    var _phoneattr = $("#post_party_phone_" + _getTempId).attr("disabled");
    if (_phoneattr == undefined || _phoneattr == "" || _phoneattr != "disabled") {
      var _checkphone = $("#post_party_phone_" + _getTempId).is(":checked");
      if (_checkphone) {
        _phone = "1";
      }
    }
    if (_detailCity != undefined && _detailCity != "") {
      var _cityarr = _detailCity.split(" ");
      if (_cityarr.length == 1) {
        _locarea = _cityarr + "|" + _cityarr;
      } else {
        _locarea = _cityarr.join("|");
      }
    }
    //调整费用提示位置
    var _joinzhi = _getJoinOpt();
    var _payzhi = _getPayItemInfo();
    if (_joinzhi == "false" || _payzhi == "false") {
      return;
    }
    var _errtip = $("#party_payerror_" + _post._tempId).val();
    if (_errtip != "" && _errtip != undefined) {
      _toast._show(_errtip);
      return;
    }
    var _joinOptions = JSON.stringify(_joinzhi);
    var _payItemInfo = JSON.stringify(_payzhi);
    var _payName = "",
      _payPrice = "",
      _payNum = "";
    _partyPostPC._isView = isprev;

    //选中的是免费按钮 校验personLimit限制人数字段
    if ($("#fee_0").is(":checked")) {

      if (_isPay == "0" || (_isPay == "1" && _payName == "")) {
        _perlim = $("#post_party_limit_" + _getTempId).val();
      }
      if (_perlim == "" || _perlim == undefined) {
        _perlim = "0";
      }
      if (_perlim != undefined && _perlim != "") {
        if (isNaN(_perlim)) {
          $("#post_main_r_K_limit").attr("class", "red_outK thisOver");
          $("#post_main_r_K_limit").find(".post_main_note").children("p").children("span").html('人数上限必须是数字');
          _partyPostPC._ifpleLimit = false;
        } else {
          if (parseInt(_perlim) < 0) {
            $("#post_main_r_K_limit").attr("class", "red_outK thisOver");
            $("#post_main_r_K_limit").find(".post_main_note").children("p").children("span").html('人数上限必须大于等于0');
            _partyPostPC._ifpleLimit = false;
          } else {
            _partyPostPC._ifpleLimit = true;
          }
        }
      }

    } else {
      //否则不需要该字段 置0即可
      _perlim = "0";
      _partyPostPC._ifpleLimit = true;
    }

    //判断值是否重复 
    var arr = new Array();
    var _joinInfoObjs = $("#post_form_join_items").find("li").find("div.xuanX");
    if (null != _joinInfoObjs && _joinInfoObjs != undefined) {
      _joinInfoObjs.each(function(index, element) {
        var _joinZhi = $(this).text();
        arr[index] = _joinZhi;
      });
    }
    var _joinInfoAddObjs = $("#post_form_join_items").find("li").find("p");
    if (null != _joinInfoAddObjs && _joinInfoAddObjs != undefined) {
      _joinInfoAddObjs.each(function(index, element) {
        var _joinZhi = $(this).text();
        if (_joinZhi != "+添加") {
          var _arrlen = arr.length;
          arr[_arrlen] = _joinZhi;
        }
      });
    }
    var flag = false;
    var _na = arr.sort();
    for (var i = 0; i < _na.length; i++) {
      if (_na[i] == _na[i + 1]) {
        flag = true;
        break;
      }
    }
    if (flag) {
      _toast._show("不能填写重复的报名信息！");
      return;
    }
    /**判断活动类型填选是否符合标准**/
    var _post_style_Bigname = $(".k_style input").val(),
      _post_style_Smallname = $(".post_style_K input").val();
    if (_post_style_Bigname != "" && _post_style_Smallname == "") {
      $("#post_main_r_K_hdstyle").attr("class", "red_outK thisOver");
      $("#post_main_r_K_hdstyle").find(".post_main_note").children("p").children("span").html('请设置活动类型的具体分类');
      _partyPostPC._ifStyle = false;
    } else {
      _partyPostPC._ifStyle = true;
    }

    if (_partyPostPC._ifTitle == false || _partyPostPC._ifrichText == false || _partyPostPC._ifTime1 == false || _partyPostPC._ifTime2 == false || _partyPostPC._ifAddress == false || _partyPostPC._ifpleLimit == false || _partyPostPC._ifStyle == false || _partyPostPC._ifContactTel == false) {
      $("body,html").animate({
        scrollTop: $(".red_outK.thisOver").eq(0).offset().top - 103 + "px"
      }, 200);
      if (editor.text() == "") {
        _richText._ifNull();
      }
      return;
    }

    _partyPostPC._title = _title;
    _partyPostPC._content = _content;
    _partyPostPC._joinItems = _joinItems;
    _partyPostPC._joinValues = _joinValues;
    _partyPostPC._payName = _payName;
    _partyPostPC._payPrice = _payPrice;
    _partyPostPC._payItemArr = _payItemArr;
    _partyPostPC._endtime = _endtime;
    _partyPostPC._startdate = _startdate;
    _partyPostPC._overdate = _overdate;
    _partyPostPC._isRecomm = _isRecomm;
    _partyPostPC._phone = _phone;
    _partyPostPC._perlim = _perlim;
    _partyPostPC._joinOrder = _joinOrder;
    _partyPostPC._getTempId = _getTempId;
    _partyPostPC._detailAddr = _detailAddr;
    _partyPostPC._locarea = _locarea;
    _partyPostPC.sceneId = sceneId;
    _partyPostPC._joinOptions = _joinOptions;
    _partyPostPC._payItemInfo = JSON.stringify(_getPayItemInfo());
    _partyPostPC._latx = _latx;
    _partyPostPC._laty = _laty;
    _partyPostPC._bigCategoryId = _bigCategoryId;
    _partyPostPC._smallCategoryId = _smallCategoryId;
    _partyPostPC._needPartySupport = _needPartySupport;
    _partyPostPC._partySupportMobile = _partySupportMobile;
    _partyPostPC._partyPosterImage = _partyPosterImage.replace('http://cdn.hudongba.com','').replace('http://img2.hudongba.com','').replace('http://img1.hudongba.com','');
    _partyPostPC._partyContactMobile = _partyContactMobile;
    //_partyPostPC._partyContactTelephone = _partyContactTelephone;

    if (isprev == '1') {
      _partyPostPC._post(_post._id, '1');
    } else {
      if ((_timeSummary == _timeSummaryEnd && _addressSummary == _addressSummaryEnd) || _post._id == '') {
        _partyPostPC._post(_post._id, '2');
      } else if (_timeSummary != _timeSummaryEnd && _addressSummary == _addressSummaryEnd && _post._id != '') {
        $("#tc_changeTimeAddr .bj_white .tc_delhd_P").html("确定修改活动时间？");
        _tc._show("tc_changeTimeAddr");
      } else if (_timeSummary == _timeSummaryEnd && _addressSummary != _addressSummaryEnd && _post._id != '') {
        $("#tc_changeTimeAddr .bj_white .tc_delhd_P").html("确定修改活动地点？");
        _tc._show("tc_changeTimeAddr");
      } else if (_timeSummary != _timeSummaryEnd && _addressSummary != _addressSummaryEnd && _post._id != '') {
        $("#tc_changeTimeAddr .bj_white .tc_delhd_P").html("确定修改活动时间、地点？");
        _tc._show("tc_changeTimeAddr");
      }
    }
  },
  _post: function(id, isprev) {
    _partyPostPC._id = id;
    _partyPostPC._isprev = isprev;
    _t._set("login_Way", 5);
    if (!_user._login()) {
      _login4._show('tc_login', _partyPostPC._id, _partyPostPC._isprev);
      return;
    }
    _partyPostPC._partyContactMobile = _partyPostPC._partyContactMobile;
    //4.1以前版本判断报名项重复结束
    _loading._show("请稍候");
    if (_partyPostPC._isprev == 1) {
      //预览
      if (_partyPostPC._winOpen != null) {
        _partyPostPC._winOpen.close();
        _partyPostPC._winOpen = null;
      }
      _partyPostPC._winOpen = window.open("/post", "show", "toolbar =no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no");
      _$(_postApi._partyPreview, "update_id=" + (_post._id || "") + "&title=" + _._htmlencode(_._encode(_partyPostPC._title)) + "&content=" + _._encode(_partyPostPC._content) + "&join_property_id=" +
        _._encode(_partyPostPC._joinItems) + "&join_property_value=" + _._encode(_partyPostPC._joinValues) + "&pay_item_name=" + _._encode(_partyPostPC._payName) + "&pay_item_price=" + _partyPostPC._payPrice +
        "&pay_item_num=" + _partyPostPC._payItemArr[2] + "&end_time=" + _._encode(_partyPostPC._endtime) + "&start_date=" + _._encode(_partyPostPC._startdate) + "&over_date=" + _._encode(_partyPostPC._overdate) +
        "&private=" + _partyPostPC._isRecomm + "&mobile_verify=0&person_limit=" + _partyPostPC._perlim + "&join_property_order=" + _partyPostPC._joinOrder + "&template_id=" + _partyPostPC._getTempId +
        "&location_text=" + _._encode(_partyPostPC._detailAddr) + "&location_area=" + _._encode(_partyPostPC._locarea) + "&scene_id=" + _partyPostPC.sceneId + "&join_property=" + _._encode(_partyPostPC._joinOptions) +
        "&pay_item=" + _._encode(_partyPostPC._payItemInfo) + "&location_lon=" + _partyPostPC._latx + "&location_lat=" + _partyPostPC._laty + "&big_category_id=" + _partyPostPC._bigCategoryId + "&small_category_id=" + _partyPostPC._smallCategoryId +
        "&need_party_support=" + _partyPostPC._needPartySupport + "&party_support_mobile=" + _partyPostPC._partySupportMobile+ "&poster_image=" + _partyPostPC._partyPosterImage+ "&contact_mobile=" + _._htmlencode(_._encode(_partyPostPC._partyContactMobile)), _partyPostPC._ok);
    } else {
      //发布
      var param = "update_id=" + (_post._id || "") + "&title=" + _._htmlencode(_._encode(_partyPostPC._title)) + "&content=" + _._encode(_partyPostPC._content) + "&join_property_id=" +
        _._encode(_partyPostPC._joinItems) + "&join_property_value=" + _._encode(_partyPostPC._joinValues) + "&pay_item_name=" + _._encode(_partyPostPC._payName) + "&pay_item_price=" + _partyPostPC._payPrice +
        "&pay_item_num=" + _partyPostPC._payItemArr[2] + "&end_time=" + _._encode(_partyPostPC._endtime) + "&start_date=" + _._encode(_partyPostPC._startdate) + "&over_date=" + _._encode(_partyPostPC._overdate) +
        "&private=" + _partyPostPC._isRecomm + "&mobile_verify=0&person_limit=" + _partyPostPC._perlim + "&join_property_order=" + _partyPostPC._joinOrder + "&template_id=" + _partyPostPC._getTempId +
        "&location_text=" + _._encode(_partyPostPC._detailAddr) + "&location_area=" + _._encode(_partyPostPC._locarea) + "&scene_id=" + _partyPostPC.sceneId + "&join_property=" + _._encode(_partyPostPC._joinOptions) +
        "&pay_item=" + _._encode(_partyPostPC._payItemInfo) + "&location_lon=" + _partyPostPC._latx + "&location_lat=" + _partyPostPC._laty + "&info_category_big=" + _partyPostPC._bigCategoryId + "&info_category_small=" + _partyPostPC._smallCategoryId +
        "&need_party_support=" + _partyPostPC._needPartySupport + "&party_support_mobile=" + _partyPostPC._partySupportMobile+ "&poster_image=" + _partyPostPC._partyPosterImage+ "&contact_mobile=" + _._htmlencode(_._encode(_partyPostPC._partyContactMobile));
      if (_post._isSelectGroup == "1") {
        //用户选群 添加上群信息参数
        var qqGroupParam = "&qq_group_num=" + _post._qqGroupNum +
          "&qq_group_name=" + _post._qqGroupName +
          "&qq_group_head_image=" + _post._qqGroupHeadImage +
          "&qq_group_join_url_pc=" + _._encode(_post._qqGroupJoinUrlPc) +
          "&qq_group_join_url_wap=" + _._encode(_post._qqGroupJoinUrlWap) +
          "&qq_num=" + _post._qqNum +
          "&qq_token=" + _post._qqToken +
          "&qq_code=" + _post._qqCode +
          "&qq_state=" + _post._qqState;
        param = param + qqGroupParam;
      }

      //移除发布点击事件，防止并发。
      $(".btn_Post").attr("onclick","");
      $(".confirm_update_time_addr").attr("onclick","");

      _$(_postApi._party, param, _partyPostPC._ok);
    }
  },
  _ok: function(json, code) {
    _loading._hide();
    if (code != 200) {
      //如果修改不成功，重新生成发布点击事件
      $(".btn_Post").attr("onclick","_partyPostPC._postFront(\'"+_post._id+"\',\'2\')");
      $(".confirm_update_time_addr").attr("onclick","_partyPostPC._postFront(\'"+_post._id+"\',\'2\')");
      if (_partyPostPC._winOpen != null) {
        _partyPostPC._winOpen.close();
      }
      if(code==4841){//删除失败
        var deletePayItemList = json.delete_pay_items;
        //$("#party_"+_post._tempId+"_post_option_cost_add").remove();
        for(var i=0;i<deletePayItemList.length;i++){
          var payItemId=deletePayItemList[i].id;
          var payItemName=deletePayItemList[i].name;
          var payItemPrice=deletePayItemList[i].price;
          var payItemInventory=deletePayItemList[i].inventory;
          var costLength = $(".cost_content",".post_pay_item").length;

          var recoveryHtml = "";//将删除的收费项再次拼回页面

          recoveryHtml+="<div class='cost_content' id='party_"+_post._tempId+"_pay_item_"+ (costLength+1)+"' busId='"+payItemId+"'>";
          recoveryHtml+="<div class='form_input_number'>"+(costLength+1)+"</div>";
          recoveryHtml+="<div class='form_input_cost form_input_cost_type'>";
          recoveryHtml+="<input type='text' value='"+payItemName+"' placeholder='费用名称"+(costLength+1)+"' maxlength='20' class='input cost_name' id='party_"
              +_post._tempId+"_pay_item_name_"+(costLength+1)+"' oninput='_setTicket._init()' onpropertychange='_setTicket._init()' onchange='_setTicket._init()'>";
          recoveryHtml+="</div>";
          recoveryHtml+="<div class='form_input_cost form_input_cost_money'>";
          recoveryHtml+="<input type='text' value='"+payItemPrice+"' placeholder='金额，免费请填0' maxlength='7' class='input' id='party_"+_post._tempId+"_pay_item_price_"
              +(costLength+1)+"' readOnly='true' onclick='editPrice()' oninput='_setTicket._init()' onpropertychange='_setTicket._init()' onchange='_setTicket._init()'>";
          recoveryHtml+="</div>";
          recoveryHtml+="<div class='form_input_cost form_input_cost_people'>";
          recoveryHtml+="<input type='text' value='"+payItemInventory+"' placeholder='人数，不填则无限制' maxlength='7' class='input' id='party_"+_post._tempId+"_pay_item_num_"
              +(costLength+1)+"' oninput='_setTicket._init()' onpropertychange='_setTicket._init()' onchange='_setTicket._init()'>";
          recoveryHtml+="</div>";
          recoveryHtml+="<span class='delError'>已有人报名!</span>";
          recoveryHtml+="</div>";

          $(".cost_add").before(recoveryHtml);
        }

        $(".cost_content").find("input").focus(function(){
          $(this).addClass("blue");
        }).blur(function(){
          $(this).removeClass("blue");
        });
        //$(".post_pay_item").append("<div class=\"cost_add\" id=\"party_"+_post._tempId+"_post_option_cost_add\" ><a href=\"javascript:void(0)\" class=\"cost_add_icon\" onclick=\"_addPayItem('party_"+_post._tempId+"',true)\" id=\"post_party_option_cost_add_icon\">+增加电子票</a></div>");
        //$("#delete_pay_item").html("");

      }else if(code==4837){//修改人数失败
        var updateInventoryList = json.update_inventory_pay_item;
        for(var i=0;i<updateInventoryList.length;i++){
          var payItemId=updateInventoryList[i].id;
          var payItemInventory=updateInventoryList[i].inventory;
          if(payItemId==""){
            $(".cost_content").each(function(){
              if($(this).attr("isAutoCreateFromFree")=="1"){
                $(this).find(".form_input_cost_people input").val(payItemInventory);
                $(this).find("a").remove();
                $(this).append("<span class='delError'>报名超限！</span>");
              }
            });
          }else{
            $(".cost_content").each(function(){
              if($(this).attr("busId")==payItemId){
                $(this).find(".form_input_cost_people input").val(payItemInventory);
                $(this).find("a").remove();
                $(this).append("<span class='delError'>报名超限！</span>");
              }
            });
          }
        }

      }else if(code==4842){//修改价格失败
        var updatePriceList = json.update_price_pay_item;
        for(var i=0;i<updatePriceList.length;i++){
          var payItemId=updatePriceList[i].id;
          var payItemPrice=updatePriceList[i].price;
          $(".cost_content").each(function(){
            if($(this).attr("busId")==payItemId){
              $(this).find(".form_input_cost_money input").val(payItemPrice);
              $(this).find(".form_input_cost_money input").attr("readOnly","true").attr("onclick","editPrice()");
              $(this).find("a").remove();
              $(this).append("<span class='delError'>已有人报名!</span>");
            }
          });
        }
      }else if(code==4844){//免费改收费的收费项有报名的不能修改价格
        var auCreatePayItem = json.autoCreate_pay_item;
        for(var i=0;i<auCreatePayItem.length;i++){
          var payItemId=auCreatePayItem[i].id;
          var payItemPrice=auCreatePayItem[i].price;
          $(".cost_content").each(function(){
            if($(this).attr("isAutoCreateFromFree")=="1"){
              $(this).find(".form_input_cost_money input").val(payItemPrice);
              $(this).find(".form_input_cost_money input").attr("readOnly","true").attr("onclick","editPrice()");
              $(this).find("a").remove();
              $(this).append("<span class='delError'>已有人报名!</span>");
            }
          });
        }
      }


      return;
    }
    if (json.state.toString() != "0") {
      _toast._show(json.error, function() {
        _user._error(json.state, "post_party");
      });
      if (_partyPostPC._winOpen != null) {
        _partyPostPC._winOpen.close();
      }
      return;
    }
    var isview = _partyPostPC._isView == "" ? "2" : _partyPostPC._isView;
    if (isview == 1) {
      _loading._hide();
      _post._id = json.party_id;
      var _sceneid = _post._sceneId;
      _partyPostPC._winOpen.location = "/party_preview/" + _post._sceneId + ".html";
      return;
    }
    _postBeforeLogin._mark("party", "");
    var _getTempId = _post._tempId;
    var _cacheTempId = _getTempId,
      _pjstr = "";
    if (_post._id != "") {
      _cacheTempId += "_m";
      _pjstr + "_m";
    }
    $("#post_party_title_" + _getTempId).val("");
    $("#post_party_date").val("");
    _partyJoinItem._setValue("1", "");
    _richText._setValue(true, "");
    _t._set("party_pay_item_price_" + _cacheTempId, "");
    _t._set("party_" + _getTempId + "_post_join_item" + _pjstr, "");
    _t._set("party_" + _getTempId + "_join_property_value" + _pjstr, "");
    _t._set("party_" + _getTempId + "_pay_item_name" + _pjstr, "");
    _t._set("party_" + _getTempId + "_pay_item_price" + _pjstr, "");
    _t._set("party_" + _getTempId + "_pay_item_num" + _pjstr, "");
    _t._set("party_" + _getTempId + "_join_property_order" + _pjstr, "");
    _t._set('joinxx_px_sort_' + _post._tempId, 2);

    history.pushState("", "", location.origin + "/post");

    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {
      _postDetail("/post_party_success/" + json.party_id + ".html");
    } else {
      _g("/post_party_success/" + json.party_id + ".html");
    }
    if (_partyPostPC._winOpen != null) {
      _partyPostPC._winOpen.close();
    }

    //TODO 活动发布成功后，发布页内容缓存清空 _post._tempId
    _t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    _t._set("post_party_title_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    _t._set("post_party_private_" + _post._tempId + "_" + _post._sceneId + _post._id, "");

    _t._set("post_party_sDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //开始日期
    _t._set("post_party_sDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //开始时间
    _t._set("post_party_eDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //结束日期
    _t._set("post_party_eDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //结束时间
    _t._set("post_party_endtimeYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //报名截止日期
    _t._set("post_party_endtimeHM_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //报名截止时间
    _t._set("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //是否显示报名截止时间

    _t._set("post_party_bigCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //活动类型id
    _t._set("post_party_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //活动类型名称
    _t._set("post_party_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //具体分类id
    _t._set("post_party_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //具体分类名称
    _t._set('post_party_pay_item_price_' + _post._tempId + '_' + _post._sceneId + _post._id, "") //单独费用
    _t._set("post_party_place_site_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //活动详细地址
    _t._set("post_party_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //活动城市
    _t._set("post_party_setTicket_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //收费活动的电子票列表
    _t._set("post_party_setJoinobj_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    _t._set("post_party_pay_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //是否收费
    _t._set("post_party_limit_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //人数上限
    _t._set("post_party_meet_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //是否需要会务支持
    _t._set("post_party_meet_tel_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //会务支持联系方式
    
    _t._set("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //活动海报
    _t._set("post_party_ContactMobile_" + _post._tempId + "_" + _post._sceneId + _post._id, ""); //主办方联系方式一
    
  },
  _btnYes: function() {
  },
  _btnNo: function() {
  },
  _btnShow: function() {
    var p1 = $('#post_party_title_' + _post._tempId).val();
    var p2 = editor.html();
    if (p1 != "" && p2 != "" && p2 != $("#" + _richText._id).attr("placeholder")) {
      _partyPostPC._btnYes();
    } else {
      _partyPostPC._btnNo();
    }
  },
  _delItem: function(id) {
    var busId=$("#party_"+_post._tempId+"_pay_item_"+id).attr("busId")
    $("#party_" + _post._tempId + "_pay_item_" + id).remove();
    $(".cost_content").each(function() {
      var it = $(this).index();
      $(this).attr("id", 'party_' + _post._tempId + '_pay_item_' + it);
      $(this).children(".form_input_number").html(it);
      $(this).find(".form_input_cost_type").children("input").attr({
        "id": 'party_' + _post._tempId + '_pay_item_name_' + it,
        "placeholder": "费用名称" + it
      });
      $(this).find(".form_input_cost_money").children("input").attr({
        "id": 'party_' + _post._tempId + '_pay_item_price_' + it
      });
      $(this).find(".form_input_cost_people").children(".input").attr({
        "id": 'party_' + _post._tempId + '_pay_item_num_' + it
      });
      if ($(this).children(".controlClear").length != 0) {
        $(this).children(".controlClear").attr('onclick', '_partyPostPC._delItem(' + it + ')');
      }
    });
    if (_post._id == "" && $(".cost_content").length == 1) {
      $(".cost_content .controlClear").hide();
    }
    _setTicket._init();
    $(".cost_add a").show();
  },
  _fetchPay: function(zhi) {
    if (_post._tempId == "102" || _post._tempId == "104") {
      if (zhi == "0") { //免费
        //$(".post_main_fee_K").hide();
      } else {
        //$(".post_main_fee_K").show();
        if (_post._id != "" && _post._isPay == "1") {
          //$("#party_pay_item_price_"+ _post._tempId).attr("disabled","disabled");
          //$("input:radio[name='fee']").attr("disabled", "disabled");
        } else {}
      }
    } else {
      if (zhi == "0") { //免费
        $("#post_party_limit_" + _post._tempId).show();
        $("#post_party_limit_" + _post._tempId).next().text("");
        $("#post_party_limit_" + _post._tempId).next().hide();
        //$("#payitemDiv").hide();
        $("input:radio[name='fee']").removeAttr("disabled");
      } else {
        //$("#payitemDiv").show();
        if (_post._id != "" && _post._isPay == "1") {
          //$(".controlClear").hide();
          $("input:radio[name='fee']").attr("disabled", "disabled");
        } else {
          $("input:radio[name='fee']").removeAttr("disabled");
        }
        if (_post._id != "") { //免费编辑成收费
          //添加默认的免费项
          //var _alreadyjoinperson = _post._joinPerson;
          //if(_alreadyjoinperson > 0 && _post._isautoPay == "false"){
          if (_post._isautoPay == "false") {
            var _paydiv = $("#party_" + _post._tempId + "_pay_item_1");
            _paydiv.attr("mrmfx", "mrmfx");
            _paydiv.find("a").hide();
            $("#party_" + _post._tempId + "_pay_item_name_1").val("免费参加");
            $("#party_" + _post._tempId + "_pay_item_price_1").val("0");
            if(_post._joinPerson>0){
              $("#party_" + _post._tempId + "_pay_item_price_1").attr("readonly", "readonly").attr("onclick","editPrice()");
            }
            if (_post._personLimit == "0") {
              $("#party_" + _post._tempId + "_pay_item_num_1").val("");
            } else {
              $("#party_" + _post._tempId + "_pay_item_num_1").val(_post._personLimit);
            }
            _paydiv.attr("isAutoCreateFromFree", "1"); //标识该收费项时由免费转收费时 自动生成的

            //_post._isautoPay = "true";
          }

        }
      }
      var _postli = $("#post_form").find("li[class]");
      if (null != _postli && _postli != undefined && _postli.length > 0) {
        _postli.each(function() {
          if ($(this).attr("class").indexOf("hdnumLimit") > 0) {
            if (zhi == "0") { //免费
              $(this).show();
            } else {
              $(this).hide();
            }
            return false;
          }
        });
      }
    }
    if (_post._id == "") {
      _t._set("post_" + _post._type + "_pay_" + _post._tempId + "_" + _post._sceneId + _post._id, zhi)
    }
  },
  _chaPhone: function() {},
  _fetchRecomm: function(zhi) {
    _t._set("post_" + _post._type + "_private_" + _post._tempId + "_" + _post._sceneId + _post._id, zhi);
  },
  _changeCity: function(pid, obj) {
    $(obj).parent().parent().parent().children("div").children("ul").children("li").removeClass("thisOver");
    $(obj).addClass("thisOver");
    var cityName = $(obj).children("a").html();
    $.ajax({
      type: "post",
      url: "/post/party?tempId=" + _post._tempId + "&cityid=" + pid + "&hdb_from=PCPost",
      async: false,
      data: {
        "getPartyPCArea": "getPartyPCArea"
      },
      cache: false,
      dataType: "json",
      success: function(data) {
        if (data != null) {
          _partyPostPC._initCityData(data, 200);
        }
      },
      error: function() {
        _loading._hide();
        _toast._show("网络错误，请重试");
      }
    });
    $(".k_site_K_qu").show();
    $(".k_site_K_qu ul li").attr("tabId", cityName);
    _checkRed._partyAddress();
  },
  _changeStyle: function(obj) {
    var styleName = $(obj).html();
    var styleId = $(obj).attr("id");

    //先把所有小分类隐藏 然后show当前分类的小分类
    $("#k_site_K7 ul").each(function() {
      $(this).hide();
    });
    $("#child_category_" + styleId).show();

    //清空之前的小分类的值
    $(".post_style_K input").val("").attr("category_id", "");

    $(".k_style input").val(styleName).attr("category_id", styleId);
    _t._set("post_" + _post._type + "_bigCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, styleId);
    _t._set("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, styleName);
    _t._set("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    _t._set("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    if (_post._bigCategoryName == "") {
      $(".k_style input").attr("class", "");
      $("#qK6").show();
    }
  },
  _changeStyle2: function(obj) {
    var styleName = $(obj).html();
    var styleId = $(obj).attr("id");
    $(".post_style_K input").val(styleName).attr("category_id", styleId);
    _t._set("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, styleId);
    _t._set("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, styleName);
    if (_post._bigCategoryName == "") {
      $(".post_style_K input").attr("class", "");
      $("#qK7").show();
    }
    $("#post_main_r_K_hdstyle").attr("class", "red_outK");
  },
  _initCityData: function(json, state) {
    var areaData = json.param;
    var areastr = "";
    if (null != areaData && areaData != undefined) {
      for (var o in areaData) {
        var id = areaData[o].id;
        var pid = areaData[o].pid;
        var name = areaData[o].name;
        areastr += "<li onclick=\"areaFetch(this)\"><a >" + name + "</a></li>";
      }
    }
    $("#cityAreaDiv").html(areastr);
  }
};

/*发布文章PC*****************************************************/
var _articlePostPC = {
  _id: "",
  _isprev: "",
  _winOpen: null,
  _ifTitle:false,
  _ifrichText:false,
  _post: function(id, isprev) {
    _articlePostPC._id = id;
    _articlePostPC._isprev = isprev;
    _t._set("login_Way", 4);
    var PCArticle = arguments[1];
    if (!_user._login()) {
      _postBeforeLogin._mark("article", id || "0");
      //_user._toLogin('Article');
      _login4._show('tc_login', _articlePostPC._id, _articlePostPC._isprev);
      return;
    }
    var _title = _._trim($("#post_article_title").val()),
      _content = _richText._getValue(),
      _private = $("input[name='recommend']:checked").val();
    if (_title == "") {
      $("#post_main_r_K_title").attr("class","red_outK thisOver");
      $("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('请填写文章标题');
      _articlePostPC._ifTitle=false;
    }else if (_._len(_title) > 70) {
    	$("#post_main_r_K_title").attr("class","red_outK thisOver");
    	$("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('标题请在35个字以内');
        _articlePostPC._ifTitle=false;
    }else{
    	_articlePostPC._ifTitle=true;
    }
    var _len = _._len(_HdbToolbar._text);
    if (_richText._isEmpty()) {
      $("#post_main_r_K_richtext").attr("class","red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('请填写文章内容');
      //_richText._onBlur();
      _articlePostPC._ifrichText=false;
    }else if (!_HdbToolbar._img && _len < 10) {
      $("#post_main_r_K_richtext").attr("class","red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('内容太短了');
      //_richText._onBlur();
      _articlePostPC._ifrichText=false;
    }else if (!_HdbToolbar._img && _len > 20000) {
      $("#post_main_r_K_richtext").attr("class","red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('内容过长了，建议分多篇发');
      //_richText._onBlur();
      _articlePostPC._ifrichText=false;
    }else if (_richText._maxPic()) {
      $("#post_main_r_K_richtext").attr("class","red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('图片太多了，最多只能上传30张图片');
      //_richText._onBlur();
      _articlePostPC._ifrichText=false;
    }else{
      _articlePostPC._ifrichText=true;
    }
    var _yzm = $("#post_article_yzm").val();
    if (_yzm == "" && _post._need_verify_code == 1) {
    	$("#post_main_r_K_yzm").attr("class","red_outK thisOver");
    	$("#post_main_r_K_yzm").find(".post_main_note").children("p").children("span").html('请填写验证码');
        _articlePostPC._ifTitle=false;
    }else{
      _articlePostPC._ifrichText=true;
    }
    _post._isView = isprev;
    if(_articlePostPC._ifTitle==false || _articlePostPC._ifrichText==false){
    	$("body,html").animate({
            scrollTop:$(".red_outK.thisOver").eq(0).offset().top - 103+"px"
          }, 200);
		if (editor.text() == "") {
			_richText._ifNull();
		}
        return;
    }
    _loading._show("请稍候");
    if (_articlePostPC._isprev == 1) {
      if (_articlePostPC._winOpen != null) {
        _articlePostPC._winOpen.close();
        _articlePostPC._winOpen = null;
      }
      _articlePostPC._winOpen = window.open("/post", "show", "toolbar =no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no");
      _$(_postApi._articlePreview, "update_id=" + (_post._id || "") + "&title=" + _._encode(_title) + "&content=" + _._encode(_content) + "&private=" + _private + "&scene_id=" + _post._defaultSceneId, _articlePostPC._ok);
    } else {
      _$(_postApi._article, "update_id=" + (id || "") + "&title=" + _._encode(_title) + "&content=" + _._encode(_content) + "&private=" + _private + "&scene_id=" + _post._sceneId + "&verify_code=" + _yzm, _articlePostPC._ok);
    }
  },
  _ok: function(json, code) {
    _loading._hide();
    if (code != 200) {
      if (_articlePostPC._winOpen != null) {
        _articlePostPC._winOpen.close();
      }
      return;
    }
    if(json.verify_status == 1){
    	if($('#post_article_yzm').is(":hidden")){
    		$('.post_main_li').show();
    	}
		$("#post_main_r_K_yzm").attr("class","red_outK thisOver");
    	$("#post_main_r_K_yzm").find(".post_main_note").children("p").children("span").html('请填写验证码');
    	return;
    }else if(json.verify_status == 2){
    	$("#post_main_r_K_yzm").attr("class","red_outK thisOver");
    	$("#post_main_r_K_yzm").find(".post_main_note").children("p").children("span").html('您输入的验证码错误');
    	return;
    }
    if (json.state.toString() != "0") {
      _toast._show(json.error, function() {
        _user._error(json.state, "post_article");
      });
      if (_articlePostPC._winOpen != null) {
        _articlePostPC._winOpen.close();
      }
      return;
    }
    _postBeforeLogin._mark("article", "");
    var isview = _post._isView == "" ? "2" : _post._isView;
    if (isview == 1) {
      _loading._hide();
      _post._id = json.article_id;
      _articlePostPC._winOpen.location = "/article_preview/" + _post._defaultSceneId + ".html";
      return;
    }
    _richText._setValue(false, "");

    //TODO 文章发布成功后，发布页内容缓存清空
    _t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id,"");
    _t._set("post_"+_post._type+"_title_"+_post._tempId+"_"+_post._sceneId + _post._id, "");
    _t._set("post_"+_post._type+"_private_"+_post._tempId+"_"+_post._sceneId + _post._id, "");
    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {
      _postDetail("/article/" + json.article_id + ".html");
    } else {
      _g("/article/" + json.article_id + ".html"); //跳转到文章详情页面
    }
    if (_articlePostPC._winOpen != null) {
      _articlePostPC._winOpen.close();
    }
  },
  _btnYes: function() {
//    $(".btnNo").hide();
//    $(".btnYes").show();
  },
  _btnNo: function() {
//    $(".btnYes").hide();
//    $(".btnNo").show();
  },
  _btnShow: function() {
    var p1 = $('#post_article_title').val();
    var p2 = editor.html();
    if (p1 != "" && p2 != "" && p2 != $("#" + _richText._id).attr("placeholder")) {
      _articlePostPC._btnYes();
    } else {
      _articlePostPC._btnNo();
    }
  },
  _yzmChange:function() {//切换验证码图片
	  var timestamp = Date.parse(new Date());
	  $("#post_article_yzm_pic").siblings('img').attr("src","/captcha?time="+timestamp+"&send_type=3");
	  $("#post_article_yzm").val("");
  },
  _yzmBlur:function() {//验证码输入框失去焦点
	if($("#post_article_yzm").val()!=""){
		$("#post_main_r_K_yzm").attr("class","red_outK");
	}  
  }
};

/*发布投票PC*****************************************************/
var _votePostPC = {
  _id: "",
  _isprev: "",
  _winOpen: null,
  _ifTitle:false,
  _ifrichText:false,
  _ifTime:false,
  _ifOption:false,
  _ifResult:false,
  _kind: function(type) {
    if (_post._id != "") {
      return;
    }
    var _kId = "1";
    if (type == 0) { //初始化
      if (_postTemp._get('post_vote_kind') != "") {
        _kId = _postTemp._get('post_vote_kind');
      }
      $("#post_vote_kind_select option[value='" + _kId + "']").attr("selected", "seleted");
    } else { //select选择值后
      _kId = $("#post_vote_kind_select option:selected").val();
    }
    var _k = 1;
    if (_kId != 1) {
      _k = 0;
    }
    $("#post_vote_kind").val(_k);
    $("#post_vote_count").val(_kId);
    _postTemp._set('post_vote_kind', _k);
    _postTemp._set('post_vote_count', _kId);
  },
  _kindPC: function(kId, type) {
    if (_post._id != "" && _post._id != undefined) {
      return;
    }
    var _kId = "1";
    if (type == 0) {
      if (_postTemp._get('post_vote_kind') != "") {
        _kId = _postTemp._get('post_vote_kind');
        if ($(".mnxlkPC a[value='" + _kId + "']").text() != '') {
          $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _kId + "']").text());
        }
      }
    } else {
      _kId = kId;
      $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _kId + "']").text());
    }
    var _k = 1;
    if (_kId != 1) {
      _k = 0;
    }
    $("#post_vote_kind").val(_k);
    $("#post_vote_count").val(_kId);
    _postTemp._set('post_vote_kind', _k);
    _postTemp._set('post_vote_count', _kId);
  },
  _post: function(id, isprev) {
    _votePostPC._id = id;
    _post._id = id;
    _votePostPC._isprev = isprev;
    _t._set("login_Way", 6);
    if (!_user._login()) {
      _postBeforeLogin._mark("vote", id || "0");
      _login4._show('tc_login', _votePostPC._id, _votePostPC._isprev);
      return;
    }
    var _title = _._trim($("#post_vote_title").val()),
      _content = _richText._getValue(),
      _kind = $("#post_vote_kind").val(),
      _count = $("#post_vote_count").val(),
      _options = "",
      _result = $("#post_vote_result").val(),
      _ifRegister = $("#ifRegister").text(),
      _voteYmd = $("#vote_end_ymd").val(),
      _voteHm = $("#vote_end_hm").val(),
      _private = $("input[name='recommend']:checked").val(),
      _votedate = "";
    if (_post._id == "" || isprev == '1') {
      _options = _optionPost._getOptions();
    }
    if (_title == "") {
      $("#post_main_r_K_title").attr("class","red_outK thisOver");
      $("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('请填写投票主题');
      _votePostPC._ifTitle=false;
    }else if (_._len(_title) > 70) {
      $("#post_main_r_K_title").attr("class","red_outK thisOver");
      $("#post_main_r_K_title").find(".post_main_note").children("p").children("span").html('标题请在35个字以内');
      _votePostPC._ifTitle=false;
    }else{
      _votePostPC._ifTitle=true;
    }
    
    if (_voteYmd == "") {
        $("#post_main_r_K_voteTime").attr("class","red_outK thisOver");
        $("#post_main_r_K_voteTime").find(".post_main_note").children("p").children("span").html('请设置投票截止时间');
        _votePostPC._ifTime=false;
     }else if(_voteHm == ""){
    	 $("#post_main_r_K_voteTime").attr("class","red_outK thisOver");
         $("#post_main_r_K_voteTime").find(".post_main_note").children("p").children("span").html('截止时间得精确到时分');
         _votePostPC._ifTime=false;
     }else{
    	 _votedate = _voteYmd;
    	 _votedate += " " + _voteHm;
    	 if (_datePicker._earilier(_votedate)) {
	        $("#post_main_r_K_voteTime").attr("class","red_outK thisOver");
	        $("#post_main_r_K_voteTime").find(".post_main_note").children("p").children("span").html('截止时间应大于当前时间');
	        _votePostPC._ifTime=false;
	     }else{
	    	 _votePostPC._ifTime=true; 
	     }
     }
    if (_._len(_HdbToolbar._text) > 20000) {
      $("#post_main_r_K_richtext").attr("class","red_outK thisOver");
      $("#post_main_r_K_richtext").find(".post_main_note").children("p").children("span").html('投票详情写得有点多了');
      _votePostPC._ifrichText=false;
    }else{
      _votePostPC._ifrichText=true;
    }
    
    if (_post._id == "") {
      if (_options.indexOf("^") == -1) {
    	$("#post_vote_option_add").attr("class","thisOver");
    	$("#post_vote_option").attr("class","red_outK thisOver");
        $("#post_vote_option_add").find(".post_main_note").children("p").children("span").html('至少需要输入2个投票选项');
        _votePostPC._ifOption=false;
      }else{
    	_votePostPC._ifOption=true;
      }
//      var _index = _optionPost._checkLength() + 1;
//      if (_index > 0) {
//        _toast._show("第" + _index + "选项写多了，请在25个字以内");
//        return;
//      }
    }else{
    	_votePostPC._ifOption=true;
    }
    
    
    if (_._len(_result) > 1500) {
      $("#post_main_r_K_result").attr("class","red_outK thisOver");
      $("#post_main_r_K_result").find(".post_main_note").children("p").children("span").html('投票结果说明写得有点多了');
      _votePostPC._ifResult=false;
    }else{
  	  _votePostPC._ifResult=true;
    }
    
    if (_ifRegister == "记名") { //不记名,记名
      _ifRegister = "1";
    } else {
      _ifRegister = "0";
    }
    _post._isView = isprev;
    if(_votePostPC._ifTitle==false || _votePostPC._ifrichText==false || _votePostPC._ifTime==false || _votePostPC._ifOption==false || _votePostPC._ifResult==false){
    	$("body,html").animate({
            scrollTop:$(".red_outK.thisOver").eq(0).offset().top - 103+"px"
          }, 200);
    	if (editor.text() == "") {
			_richText._ifNull();
		}
    	return;
    }
    _loading._show("请稍候");
    if (_votePostPC._isprev == 1) {
      //预览
      if (_votePostPC._winOpen != null) {
        _votePostPC._winOpen.close();
        _votePostPC._winOpen = null;
      }
      _votePostPC._winOpen = window.open("/post", "show", "toolbar =no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no");
      _$(_postApi._votePreview, "update_id=" + (_post._id || "") + "&kind=" + _kind + "&count=" + _count + "&title=" + _._encode(_title) + "&describe=" +
        _._encode(_content) + "&option=" + _._encode(_options) + "&result=" + _._encode(_result) + "&private=" + _private + "&end_time=" + _._encode(_votedate) +
        "&is_anonymous=" + _ifRegister + "&scene_id=" + _post._defaultSceneId, _votePostPC._ok);
    } else {
      //发布
      _$(_postApi._vote, "update_id=" + (_post._id || "") + "&kind=" + _kind + "&count=" + _count + "&title=" + _._encode(_title) + "&describe=" +
        _._encode(_content) + "&option=" + _._encode(_options) + "&result=" + _._encode(_result) + "&private=" + _private + "&end_time=" + _._encode(_votedate) +
        "&is_anonymous=" + _ifRegister + "&scene_id=" + _post._sceneId, _votePostPC._ok);
    }
  },
  _ok: function(json, code) {
    _loading._hide();
    if (code != 200) {
      if (_votePostPC._winOpen != null) {
        _votePostPC._winOpen.close();
      }
      return;
    }
    if (json.state.toString() != "0") {
      _toast._show(json.error, function() {
        _user._error(json.state, "post_vote");
      });
      if (_votePostPC._winOpen != null) {
        _votePostPC._winOpen.close();
      }
      return;
    }
    var isview = _post._isView == "" ? "2" : _post._isView;
    if (isview == 1) {
      _loading._hide();
      _post._id = json.vote_id;
      _votePostPC._winOpen.location = "/vote_preview/" + _post._defaultSceneId + ".html";
      return;
    }
    _postBeforeLogin._mark("vote", "");
    $("#post_vote_title").val("");
    _richText._setValue(false, "");
    _votePostPC._kind("1", true);
    _optionPost._clearOptions();
    $("#post_vote_result").val("");
    $(":radio").val("0");
    $("#ifRegister").text("不记名");
    var _editFlag = "";
    if (_post._id != "") {
      _editFlag += "_m";
    }
    _t._set("post_vote_kind" + _editFlag, "");
    _t._set("post_vote_option" + _editFlag, "");
    _t._set("post_vote_result" + _editFlag, "");
    _t._set("post_vote_anonymous" + _editFlag, "");
    _t._set("post_vote_count" + _editFlag, "");
    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)) {
      _postDetail("/vote/" + json.vote_id + ".html");
    } else {
      _g("/vote/" + json.vote_id + ".html");
    }
    if (_votePostPC._winOpen != null) {
      _votePostPC._winOpen.close();
    }

    //TODO 投票发布成功后，发布页内容缓存清空
      _t._set("post_"+_post._type+"_title_"+_post._tempId+"_"+_post._sceneId + _post._id, "");
      _t._set("post_vote_end_hmtime"+ _post._id,"");
      _t._set("post_vote_end_ymdtime"+ _post._id,"");
      _t._set("post_"+_post._type+"_private_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#post_"+_post._type+"_title_t").html());
      _t._set("post_vote_jiming","")
  },
  _delUnion: function(id) {
    $("#" + id).parent().remove();
    if ($(".form_input").length < 3) {
      $(".form_input a").hide();
      $(".form_input input").width(888);
    } else {
      $(".form_input a").show();
      $(".form_input input").width(850);
    }
    $(".form_input").each(function() {
      var it = $(this).index() + 1;
      $(this).children("span").html("选项" + it);
    });
    _optionPost._onBlur();
  },
  _delOption: function(id) {
    _votePostPC._delUnion(id);
    _optionPost._count--;
  },
  _btnYes: function() {
//    $(".btnNo").hide();
//    $(".btnYes").show();
  },
  _btnNo: function() {
//    $(".btnYes").hide();
//    $(".btnNo").show();
  },
  _btnShow: function() {
    var p1 = $('#post_vote_title').val();
    var _voteYmd = $("#vote_end_ymd").val();
    var _voteHm = $("#vote_end_hm").val();
    var p2 = "";
    var p3 = "true";
    if (_voteYmd != "" && _voteHm != "") {
      p2 = _voteYmd + " " + _voteHm;
    }
    if (_post._id == "") {
      var _options = _optionPost._getOptions();
      if (_options.indexOf("^") == -1) {
        p3 = "false";
      }
      var _index = _optionPost._checkLength() + 1;
      if (_index > 0) {
        p3 = "false";
      }
    }
    if (p1 != "" && p2 != "" && p3 == "true") {
      _votePostPC._btnYes();
    } else {
      _votePostPC._btnNo();
    }
  }
};

/*投票选项设置*/
var _optionPost = {
  _count: 0,
  _list: null,
  _addItem: function(value) {
    if (_optionPost._count == 50) {
      _toast._show("最多只能添加50项");
      return;
    }
    var _item_class = _optionPost._count == 0 ? "form_input" : "form_input  form_input_union";
    var _item = "<div class='" + _item_class + "'><span></span><input id='post_vote_option_" + _optionPost._count + "' type='text' class='input' oninput='_checkRed._voteOption()' onpropertychange='_checkRed._voteOption()' onblur='_optionPost._onBlur(" + _optionPost._count + ")' " + (_optionPost._count > 0 ? "noplaceholder='yes'" : "") + " placeholder='输入投票选项' maxlength='' value='" + (value == "^" ? "" : value) + "' " + (_post._id == "" || _post._id == undefined ? "" : "readonly") + "><a onclick=\"_votePostPC._delOption('post_vote_option_" + _optionPost._count + "')\"></a></div>";

    $("#post_vote_option").append(_item);
    if (value == "^") {
      $("#post_vote_option_" + (_optionPost._count + 1)).focus();
    }
    $("#post_vote_option_" + _optionPost._count).keyup(function() {
      var str = $(this).val();
      if (_._trim(str) == "")
        return;
      if (/[<>"']/g.test(str)) {
        $(this).val(str.substr(0, str.length - 1));
      }
    });
    _optionPost._count++;
    $(".form_input").each(function() {
      var it = $(this).index() + 1;
      $(this).children("span").html("选项" + it);
    });
    _votePostPC._delUnion("");
    $(".form_input input").focus(function(){
  	  $(this).addClass("blue");
    }).blur(function(){
  	  $(this).removeClass("blue");
    });
  },
  _add: function() {
    if (_post._id != "" && _post._id != undefined) {
      return;
    }
    _optionPost._addItem("^");
    var f = $(".form_input").length;
  },
  _getOptions: function() {
    var _result = "";
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      _result += $(_one).val().replace(/\^/g, "") + "^";
    }
    return _result.replace(/\^{2,}/g, "^").replace(/^\^*/g, "").replace(/\^*$/g, "");
  },
  _clearOptions: function() {
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      $(_one).val("");
    }
  },
  _onBlur: function(index) {
    _postTemp._set("post_vote_option", _optionPost._getOptions());
    _optionPost._selectItemPC();
  },
  _selectItem: function(index) {
    var _opLen = _optionPost._getOptions().split("^").length;
    var _html = '<option value="1">单选</option><option value="0">多选(无限制)</option><option value="2">多选(最多选2项)</option>';
    for (var i = 3; i <= _opLen; i++) {
      _html += '<option value="' + i + '">多选(最多选' + i + '项)</option>';
    }
    $("#post_vote_kind_select").html(_html);
    var _oCount = _postTemp._get('post_vote_count') == "" ? "1" : _postTemp._get('post_vote_count');
    $("#post_vote_kind_select option[value='" + _oCount + "']").attr("selected", "seleted");
  },
  _selectItemPC: function(index) {
    var _opLen = _optionPost._getOptions().split("^").length;
    var _html = '<span>单选</span><div><a href="javascript:void(0);" value="1" onclick="_votePostPC._kindPC(1,1);">单选</a><a href="javascript:void(0);" value="0" onclick="_votePostPC._kindPC(0,1);">多选(无限制)</a><a href="javascript:void(0);" value="2" onclick="_votePostPC._kindPC(2,1);">多选(最多选2项)</a></div>';
    $(".mnxlkPC").html(_html);
    for (var i = 3; i <= _opLen; i++) {
      var _html2 = '<a href="javascript:void(0);" value="' + i + '" onclick="_votePostPC._kindPC(' + i + ',1);">多选(最多选' + i + '项)</a>';
      $(".mnxlkPC div").append(_html2);
    }
    var _oCount = _postTemp._get('post_vote_count') == "" ? "1" : _postTemp._get('post_vote_count');
    $(".mnxlkPC span").text($(".mnxlkPC a[value='" + _oCount + "']").text());
  },
  _checkLength: function() {
    _optionPost._list = $("#post_vote_option input");
    for (var i = 0, _len = _optionPost._list.length; i < _len; i++) {
      var _one = _optionPost._list[i];
      if (_._len($(_one).val()) > 50) {
        return i;
      }
    }
    return -1;
  },
  _init: function(temp) {
    if (_post._id != "") {
      $("#post_vote_option_add").hide();
      $("#post_vote_kind_select").attr("disabled", "disabled");
    }
    $("#post_vote_option").html("");
    if (temp == "" || temp.indexOf("^") == -1) {
      temp += "^^";
    } else if (temp.match(/(.*\^.*){2,}/) == null) {
      temp += "^";
    };
    var _list = (temp.split("^"));
    for (var i = 0, _len = _list.length; i < _len; i++) {
      if (_post._id != "") {
        if (_list[i] != "") {
          _optionPost._addItem(_._htmlencode(_list[i]));
        }
      } else {
        _optionPost._addItem(_._htmlencode(_list[i]));
      }
    }
    _optionPost._list = $("#post_vote_option input");
    _optionPost._selectItemPC();
    if (window.location.href.indexOf('vote?id=') != -1) {
      if ($("#post_vote_option").children(':last').children('input').attr('value') == '') {
        $("#post_vote_option").children(':last').hide();
      }
      $("#form_anonymous").attr({
        "onclick": "",
        "title": "此处不可修改"
      });
    }
  }
};


//检查是否已绑定过qq群
function checkIsBindQQGroup(){

    if(_post._qqGroupName != ""){
        $("#selectGroupBtn").remove();
        $("#selectedGroup img").attr("src", _post._qqGroupHeadImage);
        $("#selectedGroup span").html(_post._qqGroupName);
        $("#selectedGroup b").remove();
        $("#selectedGroup").show();
    }

}

if (_post._type == "party") {
  $(function($) {
    _gaode._init();

    function populate(container, count, offset) {
      var output = '';
      offset = isNaN(offset) ? 0 : offset;
      for (var i = 0; i < count; i++) {
        output += '<li>' + (offset + i) + '</li>';
      }
      return $(output).appendTo(container);
    }
    $(document).on('activated', function(event) {
      var $section = $(".scrollbox");
      var $frame = $section.find('.frame'),
        $ul = $frame.find('ul').eq(0),
        $scrollbar = $section.find('.scrollbar'),
        $buttons = $section.find('.controlbar [data-action]');
      populate($ul, 10);
      $buttons.on('click', function(e) {
        var action = $(this).data('action');
        switch (action) {}
      });
      $section.find(".slyWrap").each(function(i, e) {
        var cont = $(this),
          frame = cont.find(".sly"),
          slidee = frame.find("ul"),
          scrollbar = cont.find(".scrollbar"),
          options = frame.data("options"),
          controls = cont.find(".controls");
        options = $.extend({}, options, {
          scrollBar: scrollbar,
          disabledClass: 'btn-disabled'
        });
        frame.sly(options);
      });
    }).trigger('activated');
  });
} else if (_post._type == "post") {
  (function($) {
    if (!_user._login()) {
      $("#a_login").hide();
      $("#a_top_login").show();
      $("#a_top_register").show();
      return;
    } else {
      $("#a_top_register").hide();
      $("#a_top_login").hide();
      $("#a_login").show();
      return;
    }
  })(jQuery);
}

function editPrice() {
  _toast._show("已经有报名的收费项不能修改金额");
}

function _addPayItem(payItemId, isPla) {
  var _len = $("div[id^='" + payItemId + "_pay_item_']").length;
  var _index = _len + 1;
  if (_index >= 11) {
    $("#" + payItemId + "_post_option_cost_add a").hide();
    return;
  }
  var _html = " <div class=\"cost_content\" id=\"" + payItemId + "_pay_item_" + _index + "\" busId=\"\">"
+ "<div class=\"form_input_number\"></div>" + " <div class=\"form_input_cost form_input_cost_type\">"
+ "<input type=\"text\" oninput=\"_setTicket._init()\" onpropertychange=\"_setTicket._init()\" onchange=\"_setTicket._init()\" placeholder=\"费用名称" + _index + "\" maxlength=\"20\" class=\"input cost_name\" id=\"" + payItemId + "_pay_item_name_" + _index + "\"></div>"
+ "<div class=\"form_input_cost form_input_cost_money\">"
+ "<input type=\"text\" oninput=\"_setTicket._init()\" onpropertychange=\"_setTicket._init()\" onchange=\"_setTicket._init()\" placeholder=\"金额，免费请填0\" maxlength=\"7\" class=\"input\" id=\"" + payItemId + "_pay_item_price_" + _index + "\"></div>"
+ "<div class=\"form_input_cost form_input_cost_people\">"
+ "<input type=\"text\" oninput=\"_setTicket._init()\" onpropertychange=\"_setTicket._init()\" onchange=\"_setTicket._init()\" placeholder=\"人数，不填则无限制\" maxlength=\"7\" class=\"input\" id=\"" + payItemId + "_pay_item_num_" + _index + "\">"
+ "</div><a title=\"删除\" class=\"controlClear\" onclick=\"_partyPostPC._delItem(" + _index + ")\"></a></div>";

  $("#" + payItemId + "_post_option_cost_add").before(_html);
  if (isPla) {
    _placeholder._init(payItemId + "_pay_item_" + _index);
  }
  $(".cost_content").each(function() {
    var it = $(this).index();
    $(this).attr("id",'party_' + _post._tempId + '_pay_item_'+it);
    $(this).children(".form_input_number").html(it);
    $(this).find(".form_input_cost_type").children("input").attr({"id": 'party_' + _post._tempId + '_pay_item_name_'+it,"placeholder":"费用名称"+it});
    $(this).find(".form_input_cost_money").children("input").attr({"id": 'party_' + _post._tempId + '_pay_item_price_'+it});
    $(this).find(".form_input_cost_people").children(".input").attr({"id": 'party_' + _post._tempId + '_pay_item_num_'+it});
    if($(this).children(".controlClear").length!=0){
    	$(this).children(".controlClear").attr('onclick','_partyPostPC._delItem('+it+')');
    }
  });

  if(_index == 10){
      $("#" + payItemId + "_post_option_cost_add a").hide();
  }
  
  $(".form_input_cost input").focus(function(){
	  $(this).addClass("blue");
  }).blur(function(){
	  $(this).removeClass("blue");
  });
  
  $(".cost_content .controlClear").show();
}

function _initPayInfo(payItemId, isPla) {
  var _multiChargeObj = $("#payitemDiv").find("div[class=cost_content]");
  if (_multiChargeObj == undefined || _multiChargeObj == null || _multiChargeObj.length <= 0) {
    _addPayItem(payItemId, isPla);
  }
}

function _getPayItemInfo() {
  //选择收费按钮 输入费用 再切换回免费按钮 点击发布 发布的还是收费活动
  var _isPay = $('input:radio[name="fee"]:checked').val();
  if (_isPay == 0) {
    return null;
  }
  var paypro = "[";
  var _getTempId = _post._tempId;
  var _multiChargeObj = $("#payitemDiv").find("div[class=post_pay_item]");
  if (_multiChargeObj != undefined && _multiChargeObj != null && _multiChargeObj.length > 0) {
    var _payList = _multiChargeObj.find("div[class=cost_content]");
    if (_payList != undefined && _payList != null) {
      var _payNameArr = new Array();
      var _joinPayLen = _payList.length;
      var _mutliTotalPay = 0;
      var flag = true;
      var ispriceempty = false;
      _payList.each(function(i, item) {
        var num = i + 1;
        var _mutliId = _._trim($(this).attr("busId"));
        var _mutliName = _._trim($(this).find("#party_" + _getTempId + "_pay_item_name_" + num).val());

          _mutliName = _mutliName.replace(/\'/g, '');
          _mutliName = _mutliName.replace(/\"/g, '');

        var _mutliPrice = _._trim($(this).find("#party_" + _getTempId + "_pay_item_price_" + num).val());
        var _mutliLimit = _._trim($(this).find("#party_" + _getTempId + "_pay_item_num_" + num).val());
        var isautocreatefromfree = $(this).attr("isautocreatefromfree");
        if(isautocreatefromfree != undefined && isautocreatefromfree != null && isautocreatefromfree != "1"){
            isautocreatefromfree = "0";
        }
		var _mrmfgsf = $(this).attr("mrmfx");
		var _salenum = 0;
        if (_mutliName == "" && _mutliPrice == "") {
          return true;
        }
        if (_mutliPrice != undefined && _mutliPrice != "") {
          if (isNaN(_mutliPrice)) {
            _toast._show("费用必须是数字");
            flag = false;
            return flag;
          } else if (parseFloat(_mutliPrice) < 0) {
            _toast._show("费用必须大于等于0");
            flag = false;
            return flag;
          }
          ispriceempty = false;
        } else {
          _mutliPrice = "0";
          ispriceempty = true;
        }
        if (!ispriceempty && (_mutliName == undefined || _mutliName == "")) {
          _toast._show("请填写费用名称");
          flag = false;
          return flag;
        }
        if (ispriceempty && (_mutliName != undefined && _mutliName != "")) {
          _toast._show("请输入金额");
          flag = false;
          return flag;
        }
        if (_mutliLimit != undefined && _mutliLimit != "") {
          if (isNaN(_mutliLimit)) {
            _toast._show("人数上限必须是数字");
            flag = false;
            return flag;
          } else if (parseInt(_mutliLimit) < 0) {
            _toast._show("人数上限必须大于等于0");
            flag = false;
            return flag;
          }
        } else {
          _mutliLimit = 0;
        }
        if (_mutliName != undefined && _mutliName != "") {
          _mutliName = $.trim(_mutliName);
          var _len = _._len(_mutliName);
          if (_len > 40) {
            _toast._show("费用名称请在20个字以内");
            flag = false;
            return flag;
          }
        }
        if (_payNameArr.length > 0) {
          for (var m = 0; m < _payNameArr.length; m++) {
            if (_payNameArr[m] == _mutliName) {
              _toast._show("费用名称不能重复");
              flag = false;
              return flag;
            }
          }
        }
        _payNameArr.push(_mutliName);
        _mutliTotalPay += parseFloat(_mutliPrice);
        var _curpay = "{'id':'"+_mutliId+"','price':'"+_mutliPrice+"','inventory':'"+_mutliLimit+"','name':'"+_mutliName+"','sales':'"+_salenum+"', 'isAutoCreateFromFree':'"+isautocreatefromfree+"'}";
        paypro += _curpay;
        if (i != _joinPayLen - 1) {
          paypro += ",";
        }
      });
      if (!flag) {
        return "false";
      }
//      if (_mutliTotalPay > 10000) {
//        _toast._show("费用不能大于10000");
//        return "false";
//      }
    }
  } else {
    var _singlePriceObj = $("#party_pay_item_price_" + _getTempId);
    var _busId = _singlePriceObj.attr("busId");
    var _singleChargePrice = _singlePriceObj.val();
    var _singlePersonLimit = $("#post_party_limit_" + _getTempId).val();
    if (_singleChargePrice != undefined && _singleChargePrice != "") {
      if (isNaN(_singleChargePrice)) {
        _toast._show("费用必须是数字");
        return "false";
      } else if (parseFloat(_singleChargePrice) < 0) {
        _toast._show("费用必须大于等于0");
        return "false";
      } else if (parseFloat(_singleChargePrice) > 10000) {
        _toast._show("费用不能大于10000");
        return "false";
      }
    }
    var _curpay = "{'id':'" + _busId + "','price':'" + _singleChargePrice + "','inventory':'" + _singlePersonLimit + "','name':''}";
    paypro += _curpay;
  }
  paypro += "]";
  return eval(paypro);
}

function _getJoinOpt() {
  var joinpro = "[";
  var joinLi = $("#joinxx_px").find("li");
  var joinLen = 0;
  if (null != joinLi && joinLi != undefined) {
    var _joinNameArr = new Array();
    joinLen = joinLi.length;
    if (joinLen > 0) {
      var flag = true;
      var tip = "";
      joinLi.each(function(i, item) {
        var dataId = _._trim($(this).attr("businessid"));
        var dataType = _._trim($(this).attr("dataType"));
        var dataOrder = _._trim($(this).attr("sortid"));
        var dataName = "";
        var dataSelect = "2";
        var dataOption = "";
        var titleObj = $(this).find("input[dataTitle]");
        var title = titleObj.val();
        if (title != undefined && title != "") {
          title = $.trim(title);
          var _len = _._len(title);
          if (dataType == "single_vote" || dataType == "multi_vote") {
            if (_len > 60) {
              tip = "报名项名称请在30个字以内";
              flag = false;
              return flag;
            }
          } else {
            if (dataType == "text_long") {
              if (_len > 60) {
                tip = "多行文本报名项名称请在30个字以内";
                flag = false;
                return flag;
              }
            } else {
              if (_len > 20) {
                tip = "单行文本报名项名称请在10个字以内";
                flag = false;
                return flag;
              }
            }
          }
          dataName = title;
        } else {
          title = $(this).find("input[class=wek_gray]").val();
          if (title == undefined) {
            title = $(this).find("div[class=bdNr]").text();
          }
          dataName = title;
        }
        if (dataName != undefined && dataName != "") {
          if (dataName == "手机") {
            if ($(this).find("div[class=czQu] a").attr("class").indexOf("thisOver") > 0) {
              dataSelect = "1";
            } else {
              dataSelect = "2";
            }
          } else {
            dataSelect = "1";
          }
        }
        dataOption += "[";
        var optarr = new Array();
        if (dataType == "single_vote" || dataType == "multi_vote") {
          titleObj.parent().next().find("input[class=wek_gray2]").each(function(j, item) {
            var optval = $.trim($(this).val());
            if (optval != "") {
              if (_._len(optval) > 60) {
                tip = "“" + dataName + "”问题选项请在30个字以内";
                flag = false;
                return flag;
              }
              optarr.push("'" + optval + "'");
            }
          });
          if ($.trim(dataName) != "" && !flag) {
            if (tip != "") {
              _toast._show(tip);
            }
            return "false";
          }
          if ((dataName == undefined || $.trim(dataName) == "") && (optarr.length > 0 || !flag)) {
            if (dataType == "single_vote") {
              tip = "请输入单选问题题目";
            } else if (dataType == "multi_vote") {
              tip = "请输入多选问题题目";
            }
            flag = false;
            return flag;
          }
          if ($.trim(dataName) != "" && optarr.length == 0) {
            tip = "请输入“" + dataName + "”的选项";
            flag = false;
            return flag;
          }
          if ($.trim(dataName) != "" && optarr.length < 2) {
            tip = "“" + dataName + "”请至少设置2个以上选项";
            flag = false;
            return flag;
          }
        }
        dataOption += optarr;
        dataOption += "]";
        if (dataName == undefined || $.trim(dataName) == "") {
          if (joinpro != "" && joinLen != 1) {}
          return true;
        }
        if (_joinNameArr.length > 0) {
          for (var m = 0; m < _joinNameArr.length; m++) {
            if (_joinNameArr[m] == dataName) {
              tip = "报名项名称不能重复";
              flag = false;
              return flag;
            }
          }
        }
        _joinNameArr.push(dataName);
        var curpro = "{'property_id':'" + dataId + "','property_name':'" + _._htmlencode(dataName) + "','property_type':'" + dataType + "','property_option':" + dataOption + ",'property_selected':'" + dataSelect + "','property_order':'" + dataOrder + "'}";
        joinpro += curpro;
        if (i != joinLen - 1) {
          joinpro += ",";
        }
      });
      if (!flag) {
        if (tip != "") {
          _toast._show(tip);
        }
        return "false";
      }
    }
  }
  joinpro += "]";
  return eval(joinpro);
}

function initJoinPro(joinPropery) {
  if (null != joinPropery && joinPropery != "") {
    joinPropery = eval(joinPropery);
    $("#join_ol").html("");
    _addFill._sort = joinPropery.length;
    for (var i = 0; i < joinPropery.length; i++) {
      var proid = joinPropery[i].property_id;
      var proname = joinPropery[i].property_name;
      var protype = joinPropery[i].property_type;
      var prooption = joinPropery[i].property_option;
      var proselect = joinPropery[i].property_selected;
      var proorder = joinPropery[i].property_order;
      //text 单行文本 text_long 多行文本  image 图片 single_vote 单选 multi_vote
      if (protype == "text") {
        _addFill._danH(proid, proorder);
      } else if (protype == "text_long") {
        _addFill._duoH(proid, proorder);
      } else if (protype == "image") {
        _addFill._pic(proid, proorder);
      } else if (protype == "single_vote") {
        _addFill._danX(proid, proorder);
      } else if (protype == "multi_vote") {
        _addFill._duoX(proid, proorder);
      }
    }
  }
}

function displayTitle(str, len) {
  if (!str || !len) {
    return '';
  }
  len *= 2;
  // 预期计数：中文2字节，英文1字节
  var a = 0;
  // 循环计数
  var i = 0;
  // 临时字串
  var temp = '';
  var flag = false;
  for (i = 0; i < str.length; i++) {
    if (str.charCodeAt(i) > 255) {
      // 按照预期计数增加2
      a += 2;
    } else if (str.charCodeAt(i) >= 65 && str.charCodeAt(i) <= 90) {
      a += 1.5;
    } else {
      a++;
    }
    // 如果增加计数后长度大于限定长度，就直接返回临时字符串
    if (a > len) {
      //return temp + "...";
      flag = true;
      break;
    }
    // 将当前内容加到临时字符串
    temp += str.charAt(i);
  }
  if (flag) {
    return 'false';
  }
  // 如果全部是单字节字符，就直接返回源字符串
  return str;
}

var _xlk = {
  _down: function() {
    $(".mnxlkPC a").css({
      "display": "block"
    });
    $(".xlK_btn").css({
      "display": "none"
    });
    setTimeout(function() {
      $(".container").bind("click", function() {
        _xlk._upPC();
      });
    }, 200);
  },
  _upPC: function() {
    $(".xlK_btn").show();
    $(".mnxlkPC a").css({
      "display": "none"
    });
    $(".container").unbind("click");
  }
};

$(".k_sign").click(function(event) {
  event.stopPropagation();
  $(".k_sign_K").show();
  $(document).click(function() {
    $(".k_sign_K").hide();
  });
  $(".k_sign_K ul li").click(function(event) {
    event.stopPropagation();
    _html = $(this).html();
    if(_html=="不记名"){
    	_t._set("post_vote_jiming",0);
    }else if(_html=="记名"){
    	_t._set("post_vote_jiming",1);
    }
    $(".k_sign span").html(_html);
    $(".k_sign_K").hide();
  });
});

$(".k_time_hour").click(function(event) {
  var _date = $(this).prev(".k_time_date").children("input").val();
  if (_date != "") {
    event.stopPropagation();
    var _html = $(".time_Hour").prop("outerHTML");
    if($(this).attr('id')=="k_time_hout1"){
    	$("#k_time_hout1").addClass("blue");
        $(".k_time_date,#k_time_hout2,,#k_time_hout3").removeClass("blue");
        $(".k_time_hour .time_Hour").remove();
    }else if($(this).attr('id')=="k_time_hout2"){
    	$("#k_time_hout2").addClass("blue");
        $(".k_time_date,#k_time_hout1,#k_time_hout3").removeClass("blue");
        $(".k_time_hour .time_Hour").remove();
    }else if($(this).attr('id')=="k_time_hout3"){
    	$("#k_time_hout3").addClass("blue");
        $(".k_time_date,#k_time_hout1,#k_time_hout2").removeClass("blue");
        $(".k_time_hour .time_Hour").remove();
    }
    $("#sDateYMD,#eDateYMD,#endtimeYMD,#vote_end_ymd").parent().children(".date_selector").remove();
    $('.post_tiMe1,.post_tiMe2,.post_tiMe3').date_input();
    $(this).append(_html);
    $(document).click(function() {
      $(".k_time_hour .time_Hour").remove();
      $("#k_time_hout3,#k_time_hout2,#k_time_hout1,").removeClass("blue");
    });
    $(".date_selector").hide();
    $(".time_Hour ul li").click(function(event) {
      event.stopPropagation();
      _html = $(this).html();
      $(this).parent().parent().parent().children(".post_hoUr").val(_html);
      dochangeV_time($(this).parent().parent().parent().children(".post_hoUr").attr('id'));
      $(".k_time_hour .time_Hour").remove();
      $("#k_time_hout3").removeClass("blue");
      if (_post._type == "vote") {
    	  _votePostPC._btnShow();
          _checkRed._voteTime();
      }else if(_post._type == "party"){
    	  _checkRed._partyTime(); 
    	  _startdateChange();
      }
    });
  }
});

function _selectGroup(data){

    var json = eval("(" + data + ")");

    var state = json.state;
    var code = json.code;
    var thisTimestamp = json.timeStamp;//本次返回选群的时间戳 必须大于上次的时间戳和当前时间 才算是有效的


    if(thisTimestamp <= _post._qqSelectTimestamp){
        return false;
    }else if(thisTimestamp > _post._qqSelectTimestamp){
        //本次返回的数据和上一次的不一致 有效数据
        console.log(data);

        _post._qqSelectTimestamp = thisTimestamp;

        _post._isSelectGroup = "1";
        _post._qqNum = json.uin;
        _post._qqCode = json.code;
        _post._qqState = json.state;
        _post._qqToken = json.token;

        //用户选择的群 Array类型 目前只能选择一个群
        var _selectGroup = json.selectGroup[0];

        _post._qqGroupNum = _selectGroup.encryptgroupnum;
        _post._qqGroupName = _selectGroup.groupName;
        _post._qqGroupHeadImage = _selectGroup.gface;
        _post._qqGroupJoinUrlPc = _selectGroup.openKey;
        _post._qqGroupJoinUrlWap = _selectGroup.mobileOpenKey;

        $("#selectGroupBtn").hide();


        $("#selectedGroup").attr("href", "http://openapi.qzone.qq.com/oauth/show?which=ConfirmPage&display=pc&client_id=100570870&redirect_uri=http://qqweb.qq.com/qunactivity/selectgroup.html&response_type=code&state=2938bee27b474dd4c61bdb35a4d7df41&scope=all");
        $("#selectedGroup").attr("onclick", "if(typeof(_post) != 'undefined'){_post._qqSelectTimestamp = new Date().getTime()};qq_activity_selectGroup.getData(function(data){_selectGroup(data)})");
        $("#selectedGroup").attr("target", "_blank");

        $("#selectedGroup b").on("click", function(e){

            $("#selectedGroup").hide();
            $("#selectGroupBtn").show();
            _post._isSelectGroup = "0";

            return false;
        });

        $("#selectedGroup img").attr("src", _post._qqGroupHeadImage);
        $("#selectedGroup span").html(_post._qqGroupName);

        $("#selectedGroup").show();

        return false;

    }else{
        return false;
    }
}

function _removeGroup(){

    $("#selectedGroup").hide();
    _post._isSelectGroup = "0";
    $("#selectGroupBtn").show();

}

function dochangeV_time(id){//发布投票 截止时间 存cookie
	if(_post._id == ""){
		if(id=="vote_end_ymd"){//缓存投票截止日期
			_t._set("post_vote_end_ymdtime"+ _post._id, $("#vote_end_ymd").val());
		 }else if(id=="vote_end_hm"){//缓存投票截止小时
			_t._set("post_vote_end_hmtime"+ _post._id, $("#vote_end_hm").val());
		 }else if(id=="sDateYMD"){//缓存活动开始日期
			_t._set("post_party_sDateYMD_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#sDateYMD").val());
		 }else if(id=="sDateHM"){//缓存活动开始小时
			_t._set("post_party_sDateHM_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#sDateHM").val());
		 }else if(id=="eDateYMD"){//缓存活动结束日期
			_t._set("post_party_eDateYMD_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#eDateYMD").val());
		 }else if(id=="eDateHM"){//缓存活动结束小时
			_t._set("post_party_eDateHM_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#eDateHM").val());
		 }else if(id=="endtimeYMD"){//缓存活动报名截止日期
			_t._set("post_party_endtimeYMD_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#endtimeYMD").val());
		 }else if(id=="endtimeHM"){//缓存活动报名截止小时
			_t._set("post_party_endtimeHM_"+_post._tempId+"_"+_post._sceneId + _post._id, $("#endtimeHM").val());
		 }
	}
}

function dochangeTitle(id){
	_t._set("post_"+_post._type+"_title_"+_post._tempId+"_"+_post._sceneId+_post._id, $("#"+id).val());
}
function dochangepostContact(){
	_t._set("post_party_ContactMobile_" + _post._tempId + "_" + _post._sceneId + _post._id, $("#post_party_postContact_"+_post._tempId).val());
}

//TODO 发布活动 缓存报名填写信息
var _setJoinobj = {
	_join_obj : [],
	_init : function(){
		for(var i=0;i<$("#join_ol li").length;i++) {
		  var person = {};
		  if(i==0){_setJoinobj._join_obj.length=0}
		  //person.id = $("#join_ol li").eq(i).attr('id');
		  person.classN = $("#join_ol li").eq(i).attr('class').replace(/ thisOver/g, '');
		  //person.sortid = $("#join_ol li").eq(i).attr('sortid');
		  person.datatype = $("#join_ol li").eq(i).attr('datatype');
		  person.businessid = $("#join_ol li").eq(i).attr('businessid');
		  if(person.classN.indexOf('phone')!="-1"){
		    person.ifPhone = $("#join_ol li").eq(i).find('.czQu').children('a').attr('class');
		  }
		  if(person.classN.indexOf('name')!="-1" || person.classN.indexOf('phone')!="-1"){
		    person.title = $("#join_ol li").eq(i).find('.bdNr').html();
		  }else{
		    person.title = $("#join_ol li").eq(i).find('.wek_gray').val();
		  }

		  if(person.classN.indexOf('danX')!="-1" || person.classN.indexOf('duoX')!="-1"){
		    person.xuanXiang = [];
		    for(var y=0;y<$("#join_ol li").eq(i).find('.xuan_Li_P').length;y++){
		        person.xuanXiang[y] = $("#join_ol li").eq(i).find('.xuan_Li_P').eq(y).children('.wek_gray2').val();
		    }
		  }
		  _setJoinobj._join_obj.push(person);
		}
		_t._set("post_party_setJoinobj_"+_post._tempId+"_"+_post._sceneId+_post._id,JSON.stringify(_setJoinobj._join_obj));
	}
}

//TODO 发布活动 缓存活动费用列表
var _setTicket = {
	_ticket_obj : [],
	_init : function(){
		for(var i=0;i<$(".cost_content").length;i++) {
			var person = {};
			if(i==0){_setTicket._ticket_obj.length=0}
			person.name = $(".cost_content").eq(i).find(".form_input_cost_type").children("input").val();
			person.price = $(".cost_content").eq(i).find(".form_input_cost_money").children("input").val();
			person.limit = $(".cost_content").eq(i).find(".form_input_cost_people").children(".input").val();
			person.busid = $(".cost_content").eq(i).attr("busid");
			if($(".cost_content").eq(i).attr("mrmfx") == undefined || $(".cost_content").eq(i).attr("mrmfx") == ""){
				person.mrmfx = "";
			}else{
				person.mrmfx = "mrmfx";
			}
			if(person.name!=""||person.price!=""||person.limit!=""){
				_setTicket._ticket_obj.push(person);
			}
		}
		if(JSON.stringify(_setTicket._ticket_obj) == "[]"){
			_t._set("post_party_setTicket_"+_post._tempId+"_"+_post._sceneId+_post._id,'[{"name":"","price":"","limit":"","busid":""}]');
		}else{
			_t._set("post_party_setTicket_"+_post._tempId+"_"+_post._sceneId+_post._id,JSON.stringify(_setTicket._ticket_obj));
		}
	}
}

//TODO 检查提示红字
var _checkRed = {
	_title:function(){
		var l = _._len(_._trim($(".post_title").val()));
		if(l>70){
	        $("#post_main_r_K_title").find("p").children("span").html('标题请在35个字以内');
		}else if(l!=0){
			$("#post_main_r_K_title").attr("class","red_outK");
		}
	},
	_richText:function(){
		var editorText = editor.text();
		if (editorText != "") {
			$("#post_main_r_K_richtext").attr("class","red_outK");
		}
	},
	_voteTime:function(){
		var _votedate="",_voteYmd = $("#vote_end_ymd").val(),_voteHm = $("#vote_end_hm").val();
		_votedate = _voteYmd;
		if(_voteHm==""){
		    $("#post_main_r_K_voteTime").find(".post_main_note").children("p").children("span").html('截止时间得精确到时分');
		}else{
			_votedate += " " + _voteHm;
			if (_datePicker._earilier(_votedate)) {
				$("#post_main_r_K_voteTime").find(".post_main_note").children("p").children("span").html('截止时间应大于当前时间');
			}else{
				$("#post_main_r_K_voteTime").attr("class","red_outK");
			}
		}
	},
	_voteOption:function(){
		if (_optionPost._getOptions().indexOf("^") != -1) {
		  $("#post_vote_option_add").attr("class","");
	    }
	},
	_voteResult:function(){
		if (_._len($("#post_vote_result").val()) < 1501) {
	      $("#post_main_r_K_result").attr("class","red_outK");
	    }
	},
	_partyTime:function(){
		var _startymd = $("#sDateYMD").val(),_starthm = $("#sDateHM").val(),_overymd = $("#eDateYMD").val(),_overhm = $("#eDateHM").val(),_endymd = $("#endtimeYMD").val(),_endhm = $("#endtimeHM").val();
		if(_t._get("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id)!="1"){
	    	_endymd = "";
	        _endhm = "";
	    }
		if(_startymd==""){
	        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动开始时间');
	    }else if(_overymd==""){
	        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动结束时间');
	        _partyPostPC._ifTime1=false;
	    }else if(_starthm==""){
	        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动开始的具体时间');
	    }else if(_overhm==""){
	        $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('请设置活动结束的具体时间');
	    }else{
	    	_startdate = _startymd + " " + _starthm;
	    	_overdate = _overymd + " " + _overhm;
	    	if(new Date(_startdate.replace(/-/g,"/")).getTime()<new Date().getTime()){
	            $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('活动开始时间应大于当前时间');
	    	}else if(new Date(_overdate.replace(/-/g,"/")).getTime()<new Date(_startdate.replace(/-/g,"/")).getTime()){
	            $("#post_main_r_K_partyTime1").find(".post_main_note").children("p").children("span").html('活动结束时间应大于活动开始时间');
	    	}else{
	    		$("#post_main_r_K_partyTime1").attr("class","red_outK");
	    	}
	    }
		
		if(_endymd!=""){
			if(_endhm==""){
			    $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('请设置报名截止的具体时间');
			}else{
				_startdate = _startymd + " " + _starthm;
		    	_overdate = _overymd + " " + _overhm;
		    	_enddate = _endymd + " " + _endhm;
		    	if(new Date(_enddate.replace(/-/g,"/")).getTime()<new Date().getTime()){
		            $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('报名截止时间应大于当前时间');
		    	}else if(new Date(_overdate.replace(/-/g,"/")).getTime()<new Date(_enddate.replace(/-/g,"/")).getTime()){
		            $("#post_main_r_K_partyTime2").find(".post_main_note").children("p").children("span").html('报名截止时间应小于活动结束时间');
		    	}else{
		    		$("#post_main_r_K_partyTime2").attr("class","red_outK");
		    	}
			}
		}
	},
	_partyAddress:function(){
		var _addrCity = $(".post_siTe").val(),_addArea = $(".post_siTe2").val();
		if(_addrCity==""){
			$("#post_main_r_K_address").find(".post_main_note").children("p").children("span").html('请设置活动举办的地点');
		}else if(_addArea=="" && _addrCity!="线上活动"){
			$("#post_main_r_K_address").find(".post_main_note").children("p").children("span").html('请补充活动的具体位置');
		}else{
			$("#post_main_r_K_address").attr("class","red_outK");
		}
	},
	_endTime:function(){//活动结束之前均可报名 点击时缓存设置
		if($(".hdTime2").css("display")=="none"){
			_t._set("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id,"0");
		}else{
			_t._set("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id,"1");
		}
	},
	_contactTel:function(){
		var _partyContactMobile  = $("#post_party_postContact_" + _post._tempId).val()
		if(_partyContactMobile!=''&& !_partyContactMobile.match(/^[0-9+-]{0,20}$/)){
		}else{
			$("#post_main_r_K_contactTel").attr("class", "red_outK");
		}
	}
}

var _feeSet = {
  _click:function(id){
    if(id=='fee_1_A'){
      _partyPostPC._fetchPay(1);
      $("#fee_1").attr("checked","checked");
      $(".post_pay_item,.post_main_fee_K").show();
      $("#payitemDiv").slideDown(300);
    }else{
      _partyPostPC._fetchPay(0);
      $("#fee_0").attr("checked","checked");
      $("#payitemDiv").slideUp(300,function(){
    	  $(".post_pay_item,.post_main_fee_K").hide();
      });
    }
  },
  _meet:function(id){
    if(id=='meet_1_A'){
      $("#meetInput").attr("value",1);
      _t._set("post_party_meet_" + _post._tempId + "_" + _post._sceneId+_post._id,1);
      $(".post_main_meet_tel").slideUp(300);
    }else{
      $("#meetInput").attr("value",0);
      _t._set("post_party_meet_" + _post._tempId + "_" + _post._sceneId+_post._id,0);
      $(".post_main_meet_tel").slideDown(300);
    }
  }
}
//TODO 海报
/*海报*/
var _posterLoad = {
  _ok: function(json, code) {
    if (code == 200) {
      $(".post_poster_pic").val(json.img);
      $(".posterimg_add_btn").html("更换海报");
      $(".posterimg_del_btn").css("visibility","visible");
      $(".posterimg_outside .posterImg_pic").attr("src", json.img.replace('img2', 'cdn').replace("static.jootun.cn","cdn.hudongba.com"));
      _t._set("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id, json.img.replace('img2', 'cdn').replace("static.jootun.cn","cdn.hudongba.com"));
      _toast._show("海报上传成功");
      _loading._hide();
      _edit_pic_SafePoster._id = '';
    }
  },
  _getPic: function() {
    _loading._show('加载中...');
    if(_edit_pic_SafePoster._id=='getPicfile'){
      _tc._show('altContentoutside');
      $("#cover2").unbind("click");
      setTimeout(function() {
        xiuxiu.loadPhoto(_posterLoad._posterPhoteUrl);
        _loading._hide();
      }, 2000);
    }else if(_edit_pic_SafePoster._id=='getPicfileTc'){
      xiuxiu.loadPhoto(_posterLoad._posterPhoteUrl);
      _loading._hide();
    }
  },
  _posterPhoteUrl: '',
  _upBtn:'',
  _init: function() {
    _loading._show('加载中...');
    _tc._show('altContentoutside');
    $("#cover2").unbind("click");
    if ($(".post_poster_pic").val() != '') {
      setTimeout(function() {
        xiuxiu.loadPhoto($(".post_poster_pic").val().replace('img2', 'cdn'));
        _loading._hide();
      }, 2000);
    } else if (_post._poster_image != '') {
      setTimeout(function() {
        xiuxiu.loadPhoto(_post._poster_image.replace('img2', 'cdn'));
        _loading._hide();
      }, 2000);
    }
  },
  _del: function() {
    _t._set("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id, "");
    $(".posterimg_outside .posterImg_pic").attr("src", 'http://cdn.hudongba.com/static_v4/images/post/posterImg.png');
    $(".post_poster_pic").val('');
    $(".posterimg_add_btn").html('添加海报');
    $(".posterimg_del_btn").css("visibility","hidden");
    _edit_pic_SafePoster._clearFile();
  },
  _getFromRoom: function(){
	  var _url = $("#posterInputUrl").val().replace("static.jootun.cn","cdn.hudongba.com").replace("static.jootun.cn","cdn.hudongba.com");
	  $(".posterimg_outside .posterImg_pic").attr("src",_url);
	  _t._set("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id, _url);
	  $(".posterImg_pic").attr("src",_url);
	  $(".post_poster_pic").val(_url);
	  $(".posterimg_add_btn").html("更换海报");
	  $(".posterimg_del_btn").css("visibility","visible");
	  _tc._hide('tc_posterSec');
  }
}
var _edit_pic_SafePoster = {
  _id:'',
  _limit: function(path) {
	return path.match(/\.(gif|jpg|jpeg|png)$/i) == null;
  },
  _upload: function(id) {
	_tc._hide('tc_posterSec');
    _loading._show("上传中...");
    _edit_pic_SafePoster._id=id;
    _upload._ok = _edit_pic_SafePoster._uploadOk;
    var imgName = $("#"+id).val();
    if (_edit_pic_SafePoster._limit(imgName)) {
      _toast._show("只能选择图片文件");
      _loading._hide();
      _edit_pic_SafePoster._clearFile();
      return;
    }
    $("#image_upload").submit();
  },
  _uploadOk: function(state, error, saveUrl) {
    if (state != "0") {
      _toast._show(error);
      _loading._hide();
      return;
    }
    saveUrl = saveUrl.replace('img2','cdn');
    _posterLoad._posterPhoteUrl = saveUrl;
    _posterLoad._getPic();
    _edit_pic_SafePoster._clearFile();
  },
  _clearFile: function() {
    $(".getPicfileOutK").html("");
    $(".getPicfileOutK").html('<input type="file" onchange="_edit_pic_SafePoster._upload(\'getPicfile\')" title="上传海报" name="file" id="getPicfile">');
  }
};

//TODO 初始化 旧版本
$(document).ready(function() {

  //检查是否已绑定过qq群 已绑定的qq群不允许再次修改
  checkIsBindQQGroup();
  postJs();
  $(window).bind("resize", postJs);
  $(".post_note2").show();
  $("#sDateYMD,#endtimeYMD").blur(function() {
    if ($(this).val() != "") {
      $(this).parent().children(".qK").css("display", "block");
    }
  });
  //PC端初始化设置
  if (_post._type == "article") { //PC端发布文章初始化
    _placeholder._init("post_form");
    $("#post_article_title").keyup(function() {
      _articlePostPC._btnShow();
    });
    $(document).click(function() {
      _articlePostPC._btnShow();
    });
    _articlePostPC._btnShow();
    _richText._init("post_article_content", "", $('#post_article_content_t').html());
  } else if (_post._type == "party") { //PC端发布活动初始化
    setTimeout(function(){
      _modifyRecords._party();
    },2000);
    var _getTempId = _post._tempId;
    var _cacheTempId = _getTempId;
    _maxMoney._init();
    if (_post._id != "") {
      _cacheTempId += "_m";
      _t._set("party_pay_item_price_" + _cacheTempId, _post._singleMaxMoney);
      _t._set("party_" + _getTempId + "_post_join_item_m", _post._postJoinItem);
      _t._set("party_" + _getTempId + "_join_property_value_m", "");
      _t._set("party_" + _getTempId + "_pay_item_name_m", _post._payItemName);
      _t._set("party_" + _getTempId + "_pay_item_price_m", _post._payItemPrice);
      _t._set("party_" + _getTempId + "_pay_item_num_m", _post._payItemNum);
      _t._set("party_" + _getTempId + "_join_property_order_m", _post._joinPropertyOrder);
      $("#post_audit").html("");
      $("post_party_option_cost_add_icon").hide();
    }
    if (navigator.userAgent.indexOf("MSIE") > 0) { //是否是IE浏览器  ：navigator.userAgent是描述用户代理信息。ie11已经不支持了，ie11不在包含MSIE字段
      if (_post._id != "") {
        $("#post_party_title_" + _getTempId).val(_._htmlencode($('#post_party_title_t').html()));
        var ifpay = _post._isPay == "" ? "0" : _post._isPay;
        _partyPostPC._fetchPay(ifpay);
        if (_getTempId == "102" || _getTempId == "104") {
          var prices = _post._singleMaxMoney;
          if (prices != "") {
            prices = prices.substring(0, prices.length - 1);
          }
          $("#party_pay_item_price_" + _getTempId).val(prices);
        }
        $("#post_party_limit_" + _getTempId).val(_post._personLimit);
      }
    } else {
      var ifpay = _t._get("post_" + _post._type + "_pay_" + _post._tempId + "_" + _post._sceneId + _post._id) == "" ? "1" : _t._get("post_" + _post._type + "_pay_" + _post._tempId + "_" + _post._sceneId + _post._id);
      _partyPostPC._fetchPay(ifpay);
      if (_getTempId == "102" || _getTempId == "104") {
        var prices = _postTemp._get("party_" + _getTempId + "_pay_item_price");
        if (prices != "") {
          prices = prices.substring(0, prices.length - 1);
        }
        $("#party_pay_item_price_" + _getTempId).val(prices);
      }
      var perlim = _postTemp._get("post_party_limit_" + _getTempId);
      $("#post_party_limit_" + _getTempId).val(perlim);
    }
    _initPayInfo("party_" + _getTempId, true);
    _addFill._init(true);
    _datePicker._notSupport("post_party_date");
    _placeholder._init("post_form");
    document.onkeydown = function(e) {
      var ev = document.all ? window.event : e;
      if (ev.keyCode == 13) {
        $("#post_join_item_add").prev("li").children("input").blur();
      }
    };
    _joinLimit._init("party_" + _getTempId);
    if (_post._id != "") {
      $("#party_post_option_cost_add").hide();
    }
    $('.post_tiMe1').date_input();
    $('.post_tiMe2').date_input();
    $('.post_tiMe3').date_input();
    $("#post_party_title_" + _getTempId).change(function() {
      _partyPostPC._btnShow();
    });
    $(document).click(function() {
      _partyPostPC._btnShow();
    });
    _partyPostPC._btnShow();
    setTimeout(function() {
      $(".ke-outline").each(function() {
        var i = $(this).index();
        i > 4 ? $(this).hide() : "";
      });
    }, 200);
    $("body").bind("click", function() {
      $(".k_site_K,.k_site_K3,.k_site_K7").hide();
      $(".k_site").removeClass("blue");
    });
    $(".joinxx_px_list").sortable({
      cursor: "move",
      items: "li", //只是li可以拖动
      opacity: 0.6, //拖动时，透明度为0.6
      revert: true, //释放时，增加动画
      update: function(event, ui) { //更新排序之后
        _addFill._init();
        _addFill._setId();
        _setJoinobj._init();
      }
    });
    _map_set._h();
    if (_post._id != "" && _post._tempId == "102") {//单费用活动修改禁止免费收费转换
      $(".post_main_fee input").attr("disabled", "disabled");
      $(".post_main_fee2 a").removeClass("thisOver").attr("onclick","").unbind("click");
    }

    $("#post_party_place_site_" + _getTempId).val(_t._get("post_party_place_site_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#post_party_place_city_" + _getTempId).val(_t._get("post_party_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id));
    if($("#meetInput").attr("value")==1){
    	$("#meet_1_A").attr("class","thisOver");
    	$("#meet_0_A").attr("class","");
    }else{
    	$("#meet_0_A").attr("class","thisOver");
    	$("#meet_1_A").attr("class","");
    }
    _qkInput._show2();
    _qkInput._show3();
    _richText._init("post_party_content", "", $('#post_party_content_t').html());
    //setTimeout(function(){_placeSearch._init();},500);
  } else if (_post._type == "vote") { //PC端发布投票初始化
    if (_post._id != "") {
      _t._set("post_vote_option_m", $('#post_vote_option_t').html());
      _t._set("post_vote_result_m", $('#post_vote_result_t').html());
      _t._set("post_vote_kind_m", _post._kind);
      _t._set("post_vote_count_m", _post._count);
      _t._set("post_vote_anonymous_m", _post._isAnonymous);
    }
    var cacheCount = 1;
    var datecache = "";
    var ispub = "";
    var ifCheckName = "不记名";
    if (navigator.userAgent.indexOf("MSIE") > 0) {
      if (_post._id != "") {
        $("#post_vote_result").val($('#post_vote_result_t').html());
        _optionPost._init($('#post_vote_option_t').html());
      }
      ispub == "" ? 0 : ispub;
    } else {
      $("#post_vote_result").val(_postTemp._get("post_vote_result"));
      $("#post_vote_result").val(_._htmlencodeReturn($("#post_vote_result").val()));
      _optionPost._init(_postTemp._get("post_vote_option"));
      cacheCount = _postTemp._get("post_vote_count") == "" ? 1 : _postTemp._get("post_vote_count");
    }
    $("#ifRegister").text(ifCheckName);
    if (_post._id != "") {
      $("#post_vote_kind").val(cacheCount != 1 ? 0 : 1);
      $("#post_vote_count").val(cacheCount);
    } else {
      _votePostPC._kindPC(cacheCount, 1);
    }
    _datePicker._notSupport("post_vote_date");
    $('.post_tiMe3').date_input();
    _placeholder._init("post_form");
    $("#post_vote_title,.form_input input").keyup(function() {
      _votePostPC._btnShow();
    });
    $(document).click(function() {
      _votePostPC._btnShow();
    });
    _votePostPC._btnShow();
    _richText._init("post_vote_content", "", $('#post_vote_content_t').html());
  } else if (_post._type == "post") {
    _post_alert();
  }
});

//TODO 初始化 新版本
$(document).ready(function() {
  if (_post._id != "") { //修改已发布活动
    _t._set("post_" + _post._type + "_title_" + _post._tempId + "_" + _post._sceneId + _post._id, $("#post_" + _post._type + "_title_t").html());
    _t._set("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id, $("#post_" + _post._type + "_content_t").html());
    _t._set("post_" + _post._type + "_private_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._isPrivate);

    if (_post._type == "party") {
      _t._set("post_party_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._showCityinfo);
      _t._set("post_party_place_site_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._detailArea);
      _t._set("post_party_pay_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._isPay);
      _t._set("post_party_place_site_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._detailArea);
      
      _t._set("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._poster_image.replace('img2', 'cdn'));
      
      if (_post._bigCategoryId != "") {
        _t._set("post_" + _post._type + "_bigCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._bigCategoryId);
        _t._set("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._bigCategoryName);
        _t._set("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._smallCategoryId);
        _t._set("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._smallCategoryName);
      }
      _t._set("post_" + _post._type + "_meet_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._needPartySupport);
      _t._set("post_" + _post._type + "_meet_tel_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._partySupportMobile);
      _t._set("post_" + _post._type + "_pay_item_price_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._payItemPrice.replace(/\^/g, ''));
      _t._set("post_" + _post._type + "_limit_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._personLimit);
      var startDateCache = _post._startDate;
      if (startDateCache != "") {
        var ymd = startDateCache.split(",")[0];
        var hm = startDateCache.split(",")[1];
        _t._set("post_party_sDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ymd);
        _t._set("post_party_sDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id, hm);
      }
      var endDateCache = _post._endDate;
      if (endDateCache != "") {
        var ymd = endDateCache.split(",")[0];
        var hm = endDateCache.split(",")[1];
        _t._set("post_party_eDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ymd);
        _t._set("post_party_eDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id, hm);
      }
      var endtimeCache = _post._endTime;
      if (endtimeCache != "") {
        var ymd = endtimeCache.split(",")[0];
        var hm = endtimeCache.split(",")[1];
        _t._set("post_party_endtimeYMD_" + _post._tempId + "_" + _post._sceneId + _post._id, ymd);
        _t._set("post_party_endtimeHM_" + _post._tempId + "_" + _post._sceneId + _post._id, hm);
        _t._set("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id, 1);
      }
      if (_post._type == "party") {
    	  _t._set("post_party_ContactMobile_" + _post._tempId + "_" + _post._sceneId + _post._id, _post._contact_mobile);
      }
    } else if (_post._type == "vote") {
      var datecache = _post._endTime;
      if (datecache != "") {
        var ymd = datecache.split(",")[0];
        var hm = datecache.split(",")[1];
        _t._set("post_vote_end_ymdtime" + _post._id, ymd);
        _t._set("post_vote_end_hmtime" + _post._id, hm);
      }
    }

  }
  /*标题*/
  if (_t._get("post_" + _post._type + "_title_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined) {
    $(".post_title").val('');
  } else {
    $(".post_title").val(_t._get("post_" + _post._type + "_title_" + _post._tempId + "_" + _post._sceneId + _post._id));
  }

  /*活动详情*/
  if (_post._type != "post") {
    if (_t._get("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined || _t._get("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id) == "") {
      editor.html("");
    } else {
      editor.html(_t._get("post_" + _post._type + "_content_" + _post._tempId + "_" + _post._sceneId + _post._id));
      _richText._black();
    }
  }

  /*是否推荐*/
  if (_t._get("post_" + _post._type + "_private_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined || _t._get("post_" + _post._type + "_private_" + _post._tempId + "_" + _post._sceneId + _post._id) == "" || _t._get("post_" + _post._type + "_private_" + _post._tempId + "_" + _post._sceneId + _post._id) == "0") {
    $(".select_0").attr("checked", "checked");
  } else {
    $(".select_1").attr("checked", "checked");
  }

  if (_post._type == "vote") {
    if (_t._get("post_vote_jiming") == 0) {
      $("#ifRegister").html('不记名');
    } else if (_t._get("post_vote_jiming") == 1) {
      $("#ifRegister").html('记名');
    }
    $("#vote_end_ymd").val(_t._get("post_vote_end_ymdtime" + _post._id));
    $("#vote_end_hm").val(_t._get("post_vote_end_hmtime" + _post._id));
  }

  if (_post._type == "party") {
    /**城市**/
    $(".post_siTe").val(_t._get("post_" + _post._type + "_place_city_" + _post._tempId + "_" + _post._sceneId + _post._id));
    /**详细地址**/
    $(".post_siTe2").val(_t._get("post_" + _post._type + "_place_site_" + _post._tempId + "_" + _post._sceneId + _post._id));
    /**活动时间**/
    $("#sDateYMD").val(_t._get("post_party_sDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#sDateHM").val(_t._get("post_party_sDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#eDateYMD").val(_t._get("post_party_eDateYMD_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#eDateHM").val(_t._get("post_party_eDateHM_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#endtimeYMD").val(_t._get("post_party_endtimeYMD_" + _post._tempId + "_" + _post._sceneId + _post._id));
    $("#endtimeHM").val(_t._get("post_party_endtimeHM_" + _post._tempId + "_" + _post._sceneId + _post._id));
    /**活动类型**/
    if (_t._get("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id) != "" && _t._get("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id) != undefined) {
      $(".k_style input").val(_t._get("post_" + _post._type + "_bigCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id)).attr("category_id", _t._get("post_" + _post._type + "_bigCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id));
      if (_post._bigCategoryName == "") {
        $(".k_style input").attr("class", "");
        $("#qK6").show();
      } else {
        $(".k_style input").attr("class", "jiao");
        $("#qK6").hide();
      }
    }
    if (_t._get("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id) != "" && _t._get("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id) != undefined) {
      $(".post_style_K input").val(_t._get("post_" + _post._type + "_smallCategoryName_" + _post._tempId + "_" + _post._sceneId + _post._id)).attr("category_id", _t._get("post_" + _post._type + "_smallCategoryId_" + _post._tempId + "_" + _post._sceneId + _post._id));
      if (_post._bigCategoryName == "") {
        $(".post_style_K input").attr("class", "");
        $("#qK7").show();
      } else {
        $(".post_style_K input").attr("class", "jiao");
        $("#qK7").hide();
      }
    }

    /**是否收费**/
    if (_t._get("post_" + _post._type + "_pay_" + _post._tempId + "_" + _post._sceneId + _post._id) == "0") {
      $("#fee_0").attr("checked", "checked");
      $(".post_main_fee_K,.post_pay_item,#payitemDiv").hide();
      $(".hdnumLimit").show();
      $("#fee_1_A").attr("class", "");
      $("#fee_0_A").attr("class", "thisOver");
    } else {
      $("#fee_1").attr("checked", "checked");
      $(".post_main_fee_K,.post_pay_item,#payitemDiv").show();
      $(".hdnumLimit").hide();
      $("#fee_1_A").attr("class", "thisOver");
      $("#fee_0_A").attr("class", "");
    }
    /**会务支持**/
    if (_t._get("post_party_meet_" + _post._tempId + "_" + _post._sceneId + _post._id) == "0" || _t._get("post_party_meet_" + _post._tempId + "_" + _post._sceneId + _post._id) == "" || _t._get("post_party_meet_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined) {
      $("#meet_1_A").attr("class", "");
      $("#meet_0_A").attr("class", "thisOver");
      $("#meetInput").attr("value", 0);
      $(".post_main_meet_tel").show();
    } else {
      $("#meet_1_A").attr("class", "thisOver");
      $("#meet_0_A").attr("class", "");
      $("#meetInput").attr("value", 1);
      $(".post_main_meet_tel").hide();
    }
    /**会务--联系电话**/
    if (_t._get("post_party_meet_tel_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined) {
      $("#post_party_meet_tel").val('');
    } else {
      $("#post_party_meet_tel").val(_t._get("post_party_meet_tel_" + _post._tempId + "_" + _post._sceneId + _post._id));
    }
    
    /*活动海报*/
    if (_t._get("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined || _t._get("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id)=='') {
        $(".post_poster_pic").val('');
        $("#getPicfile").attr("title","添加海报");
        $(".posterimg_add_btn").html('添加海报');
        $(".posterimg_del_btn").css("visibility","hidden");
      } else {
        $(".post_poster_pic").val(_t._get("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id));
        $(".posterimg_add_btn").html("更换海报");
        $(".posterimg_del_btn").css("visibility","visible");
        $(".posterimg_outside .posterImg_pic").attr("src",_t._get("post_party_PosterImage_" + _post._tempId + "_" + _post._sceneId + _post._id).replace("static.jootun.cn","cdn.hudongba.com"));
      }
    /*主办方联系方式*/
    if (_t._get("post_party_ContactMobile_" + _post._tempId + "_" + _post._sceneId + _post._id) == undefined) {
        $("#post_party_postContact_"+_post._tempId).val('');
    } else {
    	$("#post_party_postContact_"+_post._tempId).val(_t._get("post_party_ContactMobile_" + _post._tempId + "_" + _post._sceneId + _post._id));
    }
    
    if (_t._get("post_party_limit_" + _post._tempId + "_" + _post._sceneId + _post._id) != "" && _t._get("post_party_limit_" + _post._tempId + "_" + _post._sceneId + _post._id) != 0) {
      $(".limitNum_k").hide().val(_t._get("post_party_limit_" + _post._tempId + "_" + _post._sceneId + _post._id));
      $(".limitNum_k").next("p").show().html('允许' + _t._get("post_party_limit_" + _post._tempId + "_" + _post._sceneId + _post._id) + '人报名');
    }
    if (_t._get("post_party_setJoinobj_" + _post._tempId + "_" + _post._sceneId + _post._id) != "") {
      var obj = JSON.parse(_t._get("post_party_setJoinobj_" + _post._tempId + "_" + _post._sceneId + _post._id));
      var _txxHtml = "";
      var _idFront = _post._tempId + 'pary_sort_';
      for (i = 0; i < obj.length; i++) {
        if (obj[i].classN.indexOf("name") != -1) { //姓名
          _txxHtml += '<li datatype="text" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div datatitle="" class="bdNr">姓名</div></div>'
          	+ '<div class="czQu2"><img src="http://img1.hudongba.com/static_v4/images/detail/subinfo_pic_check.png" alt="" /></div></div></li>';
        } else if (obj[i].classN.indexOf("phone") != -1) { //手机
          _txxHtml += '<li datatype="text" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div datatitle="" class="bdNr">手机</div></div>'
          	+ '<div class="czQu"><a onclick="isFetchJoinOpt(this);_setJoinobj._init();" class="' + obj[i].ifPhone + '" href="javascript:void(0)"></a></div></div></li>';
        } else if (obj[i].classN.indexOf("danH") != -1) { //单行文本
          _txxHtml += '<li datatype="text" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div class="bdNr"><div class="xuanTit">'
          	+ '<input name="" type="text" placeholder="单行文本标题" class="wek_gray" dataTitle="" maxlength="20" value="' + obj[i].title
          	+ '" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/></div></div><div class="tsIe" >单行文本标题</div></div>'
          	+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _idFront + '' + (i + 1) + '\')" title="删除"></a></div></div></li>';
        } else if (obj[i].classN.indexOf("duoH") != -1) { //多行文本
          _txxHtml += '<li datatype="' + obj[i].datatype + '" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div class="bdNr"><div class="xuanTit">'
          	+ '<input name="" type="text" placeholder="这是一个多行文本框" class="wek_gray" dataTitle=""  maxlength="20" value="' + obj[i].title
          	+ '" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/></div></div><div class="tsIe" >这是一个多行文本框</div></div>'
          	+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _idFront + '' + (i + 1) + '\')" title="删除"></a></div></div></li>';
        } else if (obj[i].classN.indexOf("danX") != -1) { //单选问题
          _txxHtml += '<li datatype="' + obj[i].datatype + '" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div class="bdNr"><div class="xuanTit">'
          	+ '<input name="" type="text" placeholder="这是一个单选问题" class="wek_gray" dataTitle=""  maxlength="30" value="' + obj[i].title +
          	'" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/></div><div class="xuan_Li">';
          for (y = 0; y < obj[i].xuanXiang.length; y++) {
            _txxHtml += '<p class="xuan_Li_P"><span>选项' + (y + 1) + '</span><input id="' + _idFront + '' + (i + 1) + '_dan_' + (y + 1) + '" value="' + obj[i].xuanXiang[y]
            	+ '" name="" type="text" placeholder="这是一个单选问题" class="wek_gray2" maxlength="50" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/>'
            	+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'' + _idFront + '' + (i + 1) + '_dan_' + (y + 1) + '\')">'
            	+ '<img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>';
          }
          _txxHtml += '</div><div class="addBtn"><a href="javascript:void(0)" onclick="_addFill._addXxdan(\''+_idFront+''+(i+1)+'\')" title="添加选项"></a></div></div><div class="tsIe">这是一个单选问题</div></div>'
          	+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _idFront + '' + (i + 1) + '\')" title="删除"></a></div></div></li>';
        } else if (obj[i].classN.indexOf("duoX") != -1) { //多选问题
          _txxHtml += '<li datatype="' + obj[i].datatype + '" sortid="' + (i + 1) + '" businessid="' + obj[i].businessid + '" id="' + _idFront + '' + (i + 1) + '" class="' + obj[i].classN + '">'
          	+ '<div class="joinxx_px_handle"><div class="yinyingQu"><span class="icon"></span><div class="bdNr"><div class="xuanTit">'
          	+ '<input name="" type="text" placeholder="这是一个多选问题" class="wek_gray" dataTitle=""  maxlength="30" value="' + obj[i].title
          	+ '" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/></div><div class="xuan_Li">';
          for (y = 0; y < obj[i].xuanXiang.length; y++) {
            _txxHtml += '<p class="xuan_Li_P"><span>选项' + (y + 1) + '</span><input id="' + _idFront + '' + (i + 1) + '_duo_' + (y + 1) + '" value="' + obj[i].xuanXiang[y]
            	+ '" name="" type="text" placeholder="这是一个多选问题" class="wek_gray2" maxlength="50" oninput="_setJoinobj._init()" onpropertychange="_setJoinobj._init()" onchange="_setJoinobj._init()"/>'
            	+ '<a href="javascript:void(0)" class="xuan_Li_P_A" onclick="_addFill._delxuanLi(\'' + _idFront + '' + (i + 1) + '_duo_' + (y + 1) + '\')">'
            	+ '<img src="http://img1.hudongba.com/static_v4/images/post/share_qr_close3_15.png" alt="" /></a></p>';
          }
          _txxHtml += '</div><div class="addBtn"><a href="javascript:void(0)" onclick="_addFill._addXxduo(\''+_idFront+''+(i+1)+'\')" title="添加选项"></a></div></div><div class="tsIe">这是一个多选问题</div></div>'
          	+ '<div class="czQu"><a href="javascript:void(0)" class="del" onclick="_addFill._del(\'' + _idFront + '' + (i + 1) + '\')" title="删除"></a></div></div></li>';
        }
      }
      if (_post._id == "") {
        $("#join_ol").html(_txxHtml);
      }

      _addFill._init();
    }
    if(_post._id == ""){
        if (_t._get("post_party_setTicket_" + _post._tempId + "_" + _post._sceneId + _post._id) != "") {
          var obj = JSON.parse(_t._get("post_party_setTicket_" + _post._tempId + "_" + _post._sceneId + _post._id));
          var _txxHtml = "";
          var _idFront = 'party_' + _post._tempId + '_pay_item_';
          for (i = 0; i < obj.length; i++) {
            _txxHtml += '<div busid="' + obj[i].busid + '" id="' + _idFront + (i + 1) + '" class="cost_content"';
            if (obj[i].mrmfx != "" && obj[i].mrmfx != undefined) {
              _txxHtml += ' mrmfx="mrmfx" isautocreatefromfree="1"';
            };
            _txxHtml += '><div class="form_input_number">' + (i + 1) + '</div>' + '<div class="form_input_cost form_input_cost_type">' + '<input type="text" id="' + _idFront + 'name_' + (i + 1) + '" class="input cost_name" maxlength="20" placeholder="费用名称' + (i + 1) + '"  oninput="_setTicket._init()" onpropertychange="_setTicket._init()" onchange="_setTicket._init()" value="' + obj[i].name + '"></div>' + '<div class="form_input_cost form_input_cost_money"><input type="text" ';
            if (obj[i].busid != "") {
              _txxHtml += ' onclick="editPrice()" readonly="true"';
            }
            _txxHtml += ' id="' + _idFront + 'price_' + (i + 1) + '" class="input" maxlength="7" placeholder="金额，免费请填0"  oninput="_setTicket._init()" onpropertychange="_setTicket._init()" onchange="_setTicket._init()" value="' + obj[i].price + '">' + '</div><div class="form_input_cost form_input_cost_people">' + '<input type="text" id="' + _idFront + 'num_' + (i + 1) + '" class="input" maxlength="7" placeholder="人数，不填则无限制"  oninput="_setTicket._init()" onpropertychange="_setTicket._init()" onchange="_setTicket._init()" value="' + obj[i].limit + '"></div>';
            if (obj[i].busid == "" && (obj[i].mrmfx != "" || obj[i].mrmfx != undefined)) {
              _txxHtml += '<a onclick="_partyPostPC._delItem(' + (i + 1) + ')" class="controlClear" title="删除"></a>';
            }
            _txxHtml += '</div>'
          }

          $(".cost_content").remove();
          $(".post_pay_item_top").after(_txxHtml);
        }
      }else{
      if(_post._isPay==1){
        var _txxHtml = "";
        var _idFront = 'party_' + _post._tempId + '_pay_item_';
        $(".cost_content").each(function(){
          var payItemId = $(this).attr("busId");
          $(this).find(".form_input_cost_type").find(".input").val($("#pay_name_"+payItemId).html());
          $(this).find(".form_input_cost_money").find(".input").val($("#pay_price_"+payItemId).html().replace(/,/g,""));
          $(this).find(".form_input_cost_people").find(".input").val($("#pay_inventory_"+payItemId).html().replace(/,/g,""));
        });

      }
    }


    if (_post._id != "" && _post._isautoPay == "false" && $(".cost_content").length == "1") {
      //添加默认的免费项
      var _paydiv = $(".cost_content");
      _paydiv.attr({
        "mrmfx": "mrmfx",
        "isAutoCreateFromFree": "1"
      });
      _paydiv.find("a").remove();
      $(".cost_content .form_input_cost_type .input").val("免费参加");
      $(".cost_content .form_input_cost_money .input").val("0");
      if(_post._joinPerson>0){
        $(".cost_content .form_input_cost_money .input").attr("readonly", "readonly").attr("onclick","editPrice()");
      }
      $(".cost_content .form_input_cost_num .input").val(_post._personLimit);
      //_post._isautoPay = "true";
    }

    checkIsPartySupport();

    if (_t._get("post_party_endtimePower_" + _post._tempId + "_" + _post._sceneId + _post._id) == "1") {
      $("#joinTime_control a").attr("class", "");
      $(".hdTime2").css("display", "block");
    } else {
      $("#joinTime_control a").attr("class", "thisOver");
      $(".hdTime2").css("display", "none");
    }

    $("#party_pay_item_price_" + _post._tempId).val(_t._get("post_" + _post._type + "_pay_item_price_" + _post._tempId + "_" + _post._sceneId + _post._id));
  }

  $("#joinTime_control a").click(function() {
    $(this).toggleClass("thisOver");
    $(".hdTime2").slideToggle(300,function(){
      _checkRed._endTime();
    });
  });

  $(".post_title,.post_yzm,.form_input input,.wek_gray,.form_input_cost input,#post_party_meet_tel,.post_main_fee_K input").focus(function() {
    $(this).addClass("blue");
  }).blur(function() {
    $(this).removeClass("blue");
  });

  $("#form_textarea textarea,.post_siTe2,.limitNum_k").focus(function() {
    $(this).parent().addClass("blue");
  }).blur(function() {
    $(this).parent().removeClass("blue");
  });

  $(".wek_gray2").focus(function() {
    $(".xuan_Li_P").removeClass("blue");
    $(this).parent().addClass("blue");
  }).blur(function() {
    $(".xuan_Li_P").removeClass("blue");
  });

  if (_post._id=="" && $(".cost_content").length == 1) {
    $(".cost_content .controlClear").hide();
  }

  if (_post._id != "" && _post._isPay == "1") { //单费用活动修改禁止免费收费转换
    $(".post_main_fee input").attr("disabled", "disabled");
    $(".post_main_fee2 a").attr("onclick", "").unbind("click");
    $("#fee_0_A").css("color", "#aaaaaa").attr("title", "设置了收费项不能改为免费活动哦");
  }

});
/*修改活动时间判断*/
var _startdateChange = function(){
	var startDateCache = _post._startDate;
	var _startdate = $("#sDateYMD").val()+" "+$("#sDateHM").val();
	if(_post._info_is_starting == '1'){
		if(startDateCache!=""&&startDateCache!=null&&startDateCache!=undefined){
			if(new Date(_startdate.replace(/-/g, "/")).getTime() < new Date().getTime() && new Date(_startdate.replace(/-/g, "/")).getTime()!=new Date(startDateCache.replace(/-/g, "/").replace(/,/g, " ")).getTime()) {
		        if($('#joinTime_control .time_txt').length == 0){
		        	var time_txt = '<p class="time_txt"><img alt="" src="http://cdn.hudongba.com/static_v4/images/post/tan_icon.png"><span>活动时间只能保持原状态或修改为大于当前时间</span></p>';
			        $('#joinTime_control').prepend(time_txt);
		        }else{
		        	$('#joinTime_control .time_txt').show();
		        }
		       // setTimeout(function(){
//			        $("#sDateYMD").val(startDateCache.split(",")[0]);
//			        $("#sDateHM").val(startDateCache.split(",")[1]);
			   // },0);
		        $("#sDateYMD").parent().attr("class","k_time_date red");
		        $("#k_time_hout1").attr("class","k_time_hour red");
			}else{
				$('#joinTime_control .time_txt').remove();
				$("#sDateYMD").parent().attr("class","k_time_date");
		        $("#k_time_hout1").attr("class","k_time_hour");
			}
		}
	}
	
};
 




